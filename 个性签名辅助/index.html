<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>渐变色个性签名生成器</title>
    
    <!-- ========== CSS样式开始 ========== -->
    <style>
        /* 重置和基础样式 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }

        /* 折叠按钮基础样式 */
        .toggle-code-btn {
            padding: 12px 16px;
            background: #3898ff;
            color: #fff;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background .2s;
            min-height: 42px;
            min-width: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 6px rgba(56, 152, 255, 0.3);
        }

        .toggle-code-btn:hover {
            background: #2d87e6;
        }

        /* 模式切换按钮样式 */
        .mode-toggle-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px 0;
        }

        .mode-toggle-btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, #3898ff, #2effa4);
            color: #fff;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(56, 152, 255, 0.3);
        }

        .mode-toggle-btn:hover {
            background: linear-gradient(135deg, #2d87e6, #2effa4);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(56, 152, 255, 0.4);
        }

        .mode-toggle-btn:active {
            transform: translateY(0);
        }
        
        /* 数字模式下的按钮样式 */
        .mode-toggle-btn.digital-mode {
            background: linear-gradient(135deg, #3898ff, #2effa4);
            box-shadow: 0 4px 15px rgba(56, 152, 255, 0.3);
        }
        
        .mode-toggle-btn.digital-mode:hover {
            background: linear-gradient(135deg, #2d87e6, #2effa4);
            box-shadow: 0 6px 20px rgba(56, 152, 255, 0.4);
        }
        
        /* 滑杆模式下的按钮样式 */
        .mode-toggle-btn.slider-mode {
            background: linear-gradient(135deg, #ff6b6b, #4ecdc4);
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        }
        
        .mode-toggle-btn.slider-mode:hover {
            background: linear-gradient(135deg, #ee5a5a, #4ecdc4);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
        }

        /* 代码区收起时的隐藏 */
        .code-block.hidden,
        .example-code.hidden {
            display: none;
        }

        /* 示例代码展开/收起按钮样式 */
        .toggle-example-code-btn {
            padding: 10px 16px;
            background: #3898ff;
            color: #fff;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background .2s;
            white-space: nowrap;
            min-height: 38px;
            min-width: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 6px rgba(56, 152, 255, 0.3);
        }

        .toggle-example-code-btn:hover {
            background: #2d87e6;
        }

        /* 手机端按钮略小 */
        @media (max-width: 768px) {
            .toggle-example-code-btn {
                padding: 6px 10px;
                font-size: 12px;
            }
            
            /* 模式切换按钮在小屏幕下缩小 */
            .mode-toggle-btn {
                padding: 6px 12px;
                font-size: 12px;
            }
            
            /* 滑杆 handle 在小屏幕下缩小 */
            .slider-range-handle {
                width: 16px;
                height: 16px;
                border-width: 1.5px;
            }
            
            /* 滑杆模式下改为每排1列，宽度铺满容器 */
            #mode2 .custom-color-row {
                flex: 0 0 100% !important; /* 100%宽度，铺满容器 */
                max-width: 100% !important;
            }
            
            /* 数字模式保持3列布局（不受小屏幕影响） */
            #mode1 .style-content .style-input-group {
                flex: 0 0 calc(33.333% - 6px);
            }
            
            /* 滑杆模式下样式输入组在小屏幕时改为1列布局 */
            #mode2 .style-content .style-input-group {
                flex: 0 0 100% !important;
            }
            
            /* 滑杆模式下渐变条容器改为每排1列，宽度铺满容器 */
            #mode2 .custom-gradient-section .gradient-bars .custom-color-row {
                flex: 0 0 100% !important; /* 100%宽度，铺满容器 */
                max-width: 100% !important;
            }
            
            /* 预览区域在小屏幕下缩小高度 */
            .preview-content {
                min-height: 50px !important;
                height: 40px !important;
                padding: 10px !important;
            }
        }

        /* 中屏幕设备（768px - 1024px）系统性布局对齐优化 */
        @media (min-width: 768px) and (max-width: 1024px) {
            /* 容器优化 - 确保内容居中且间距合理 */
            .container {
                max-width: 850px;
                padding: 22px;
                margin-left: auto;
                margin-right: auto;
            }

            /* 颜色输入区域优化 - 确保4列布局对齐 */
            .color-input {
                flex: 0 0 calc(25% - 11.25px) !important;
                max-width: calc(25% - 11.25px) !important;
                min-width: 140px;
            }

            .color-inputs {
                gap: 15px;
                justify-content: flex-start;
            }

            /* 颜色标签字体大小优化 */
            .color-label {
                font-size: 12px;
            }

            /* 色块容器优化 - 确保与标签对齐 */
            .color-swatch-container {
                gap: 10px;
                justify-content: flex-start;
            }

            .color-swatch {
                width: 24px;
                height: 24px;
            }

            /* 颜色代码输入框优化 */
            .color-code-input {
                width: 90px !important;
                height: 24px !important;
                font-size: 13px !important;
            }

            .color-code-prefix {
                font-size: 13px !important;
                min-width: 14px !important;
                height: 24px !important;
                line-height: 24px !important;
            }

            /* 设置行布局优化 - 确保间距一致 */
            .settings-row {
                gap: 12px;
                margin-bottom: 18px;
            }

            .font-settings-row {
                gap: 12px;
                margin-bottom: 18px;
            }

            /* 输入组优化 */
            .input-group {
                margin-bottom: 18px;
            }

            /* 按钮优化 - 确保尺寸统一 */
            .mode-toggle-btn {
                padding: 10px 20px;
                font-size: 14px;
            }

            /* 预览区域优化 */
            .preview-section {
                margin-bottom: 25px;
            }

            .preview-content {
                padding: 18px;
                min-height: 75px;
            }

            /* 字体大小输入框优化 */
            #fontSize {
                width: 75px;
                height: 42px;
                font-size: 14px;
            }

            /* 复选框组优化 */
            .style-checkboxes {
                gap: 12px;
            }

            /* 侧边栏优化 */
            .sidebar {
                left: -300px;
                width: 300px;
            }

            /* 历史记录按钮优化 */
            .history-action-btn {
                width: 34px;
                height: 34px;
                font-size: 11px;
            }

            .star-btn {
                width: 34px;
                height: 34px;
                font-size: 17px;
            }

            /* 滑杆模式下渐变条容器优化 */
            #mode2 .custom-gradient-section .gradient-bars .custom-color-row {
                flex: 0 0 calc(50% - 6px);
                max-width: calc(50% - 6px);
            }

            /* 确保所有文本元素对齐 */
            h1 {
                font-size: 2rem;
                margin-bottom: 8px;
            }

            .subtitle {
                font-size: 13px;
                margin-bottom: 22px;
            }

            /* 交换颜色按钮优化 */
            .swap-colors-btn {
                width: 38px;
                height: 38px;
                font-size: 17px;
            }

            /* 滑杆模式下样式输入组优化 */
            #mode2 .style-content .style-input-group {
                flex: 0 0 calc(50% - 6px);
            }

            /* 折叠按钮优化 */
            .toggle-code-btn {
                padding: 9px 11px;
                font-size: 15px;
            }

            /* 示例代码折叠按钮优化 */
            .toggle-example-code-btn {
                padding: 7px 11px;
                font-size: 13px;
            }

            /* 预览文本优化 */
            .preview-text {
                font-size: 16px;
            }

            /* 自定义颜色行线优化 */
            .custom-color-row-line {
                gap: 4px;
            }

            .custom-color-input-group {
                flex-direction: row;
                align-items: center;
                gap: 4px;
            }

            .custom-color-input-group.range-group {
                flex-direction: column;
                align-items: flex-start;
            }

            .custom-color-input-group label {
                font-size: 12px;
            }

            /* 自定义色块优化 */
            .custom-color-swatch {
                width: 38px;
                height: 38px;
            }

            /* 渐变条容器优化 */
            .gradient-bars {
                gap: 12px;
            }

            /* 更多颜色面板优化 */
            .more-colors-panel {
                top: 65px;
                gap: 7px;
            }

            /* 通知优化 */
            .notification {
                padding: 14px 18px;
                font-size: 14px;
            }

            /* 侧边栏内容优化 */
            .sidebar {
                padding: 22px;
            }

            /* 历史记录项目优化 */
            .history-item {
                padding: 12px;
                font-size: 13px;
            }

            /* 滑杆handle优化 */
            .slider-range-handle {
                width: 18px;
                height: 18px;
                border-width: 2px;
            }

            /* 输入框优化 */
            textarea, input[type="text"], input[type="number"], input[type="password"], select {
                padding: 11px;
                font-size: 15px;
                border-radius: 7px;
            }

            /* 复选框优化 */
            .checkbox-group input[type="checkbox"] {
                width: 17px;
                height: 17px;
            }

            /* 滚动条优化 */
            ::-webkit-scrollbar {
                width: 8px;
                height: 8px;
            }

            ::-webkit-scrollbar-track {
                background: rgba(30, 40, 50, 0.5);
            }

            ::-webkit-scrollbar-thumb {
                background: rgba(56, 152, 255, 0.5);
                border-radius: 4px;
            }

            ::-webkit-scrollbar-thumb:hover {
                background: rgba(56, 152, 255, 0.7);
            }
        }

        /* 大屏幕设备（992px及以上） */
        @media (min-width: 992px) {
            /* 滑杆模式下样式输入组保持3列布局 */
            #mode2 .style-content .style-input-group {
                flex: 0 0 calc(33.333% - 6px);
            }
        }

        /* 超小屏再压一点 */
        @media (max-width: 360px) {
            .toggle-code-btn {
                padding: 6px 8px;
                font-size: 13px;
            }
            
            /* 模式切换按钮在超小屏幕下进一步缩小 */
            .mode-toggle-btn {
                padding: 5px 10px;
                font-size: 10px;
            }
            
            /* 滑杆 handle 在超小屏幕下进一步缩小 */
            .slider-range-handle {
                width: 14px;
                height: 14px;
                border-width: 1px;
            }
        }
        
        /* 页面主体样式 */
        body {
            background: linear-gradient(135deg, #0f1a2a, #1a2a3a);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }
        
        .container {
            max-width: 900px;
            width: 100%;
            background: rgba(25, 35, 45, 0.85);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            margin-top: 20px;
            border: 1px solid rgba(56, 152, 255, 0.2);
            position: relative;
        }
        


        /* 标题样式 */
        h1 {
            text-align: center;
            margin-bottom: 10px;
            color: #2effa4;
            text-shadow: 0 0 10px rgba(46, 255, 164, 0.5);
            font-size: 2.2rem;
            position: relative;
            padding-bottom: 10px;
        }
        
        .subtitle {
            text-align: center;
            margin-bottom: 25px;
            color: #7a8a9a;
            font-size: 14px;
        }
        
        h1::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 25%;
            width: 50%;
            height: 3px;
            background: linear-gradient(to right, transparent, #2effa4, transparent);
        }
        
        /* 预览区域样式 */
        .preview-section {
            margin-bottom: 40px;
            background: linear-gradient(to right, #3E4862, #3A4860);
            padding: 10px;
            border-radius: 8px;
        }
        
        .preview-title {
            margin-bottom: 10px;
            font-weight: bold;
            color: #ffffff;
            text-align: left;
            padding: 4px 8px;
            border: none;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.2);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            height: 28px;
            min-height: 28px;
            max-height: 28px;
            box-sizing: border-box;
        }
        
        .preview-content {
            position: relative;
            text-align: center;
            padding: 0 15px;
            background: rgba(0, 0, 0, 0.25);
            border-radius: 8px;
            border: none;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: none;
            overflow: hidden;
        }
        
        .preview-text,
        .preview-content > div,
        .preview-content > div > span {
            display: inline-block;
            opacity: 1;
        }
        
        /* 悬浮预览窗口样式 */
        .floating-preview {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 300px;
            background: linear-gradient(to right, #3E4862, #3A4860);
            border: none;
            border-radius: 8px;
            box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.1), 0 4px 20px rgba(0, 0, 0, 0.5);
            z-index: 10000;
            display: none;
            overflow: hidden;
            transition: opacity 0.3s ease;
        }
        
        .floating-preview.visible {
            display: block;
        }
        
        .floating-preview.minimized {
            height: auto;
        }
        
        .floating-preview.minimized .floating-preview-content {
            display: none;
        }
        
        .floating-preview-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 15px;
            background: linear-gradient(to right, #3E4862, #3A4860);
            box-shadow: inset 0 -1px 0 rgba(255, 255, 255, 0.1);
            cursor: move;
            user-select: none;
        }
        
        .floating-preview-title {
            font-size: 14px;
            font-weight: bold;
            color: #ffffff;
        }
        
        .floating-preview-controls {
            display: flex;
            gap: 5px;
        }
        
        .floating-preview-btn {
            width: 24px !important;
            height: 24px !important;
            min-height: 24px !important;
            padding: 0 !important;
            border: none !important;
            background: rgba(255,255,255, 0.2) !important;
            color: #ffffff !important;
            border-radius: 4px !important;
            cursor: pointer;
            font-size: 14px !important;
            line-height: 24px !important;
            text-align: center !important;
            transition: background 0.2s !important;
            flex: none !important;
            box-shadow: none !important;
            transform: none !important;
        }
        
        .floating-preview-btn:hover {
            background: rgba(255,255,255, 0.4) !important;
            transform: none !important;
            box-shadow: none !important;
        }
        
        .floating-preview-btn:active {
            transform: none !important;
        }
        
        .floating-preview-content {
            position: relative;
            padding: 15px;
            min-height: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        
        .floating-preview-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.25);
            z-index: 1;
        }
        
        .floating-preview-text,
        .floating-preview-content > div {
            position: relative;
            z-index: 2;
            opacity: 1;
            mix-blend-mode: normal;
        }
        
        /* 调整大小手柄 */
        .resize-handle {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 20px;
            height: 20px;
            cursor: nwse-resize;
            background: linear-gradient(135deg, transparent 50%, rgba(56, 152, 255, 0.5) 50%);
            border-radius: 0 0 8px 0;
            z-index: 10;
        }
        
        .resize-handle:hover {
            background: linear-gradient(135deg, transparent 50%, rgba(56, 152, 255, 0.8) 50%);
        }
        
        .floating-preview.locked .resize-handle {
            display: none;
        }
        
        /* 输入框组样式 */
        .input-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #3898ff;
        }
        
        textarea, input[type="text"], input[type="number"], input[type="password"], select {
            width: 100%;
            padding: 12px;
            border: 2px solid #2a3a4a;
            border-radius: 8px;
            background: #1e2a35;
            color: #e0e0e0;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        textarea:focus, input[type="text"]:focus, input[type="number"]:focus, input[type="password"]:focus, select:focus {
            border-color: #3898ff;
            outline: none;
            box-shadow: 0 0 8px rgba(56, 152, 255, 0.5);
        }
        
        /* 字体大小输入框特殊样式 - 1:1比例 */
        #fontSize {
            width: 80px;
            height: 45px; /* 1:1比例，45px高对应45px宽 */
            text-align: center;
            padding: 12px 8px;
        }

        /* 颜色代码输入框样式 - 重新设计 */
        .color-code-input {
            width: 90px;
            height: 24px;
            padding: 2px 6px;
            text-align: center;
            font-size: 13px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            border: 2px solid #2a3a4a;
            border-radius: 4px;
            background: #1e2a35;
            color: #e0e0e0;
            transition: border-color 0.3s, box-shadow 0.3s;
            box-sizing: border-box;
        }

        .color-code-input:focus {
            border-color: #3898ff;
            box-shadow: 0 0 8px rgba(56, 152, 255, 0.5);
            outline: none;
        }

        /* 颜色代码组容器 */
        .color-code-group {
            display: flex;
            align-items: center;
            gap: 0;
            flex-shrink: 0;
        }

        /* 颜色代码前缀符号样式 */
        .color-code-prefix {
            font-size: 13px;
            font-weight: bold;
            color: #e0e0e0;
            font-family: 'Courier New', monospace;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 14px;
            height: 24px;
            line-height: 24px;
            user-select: none;
        }

        /* 响应式设计 - 手机布局 */
        @media (max-width: 768px) {
            #fontSize {
                width: 60px;
                height: 40px;
                padding: 10px 6px;
            }
            
            .color-swatch {
                width: 22px !important;
                height: 22px !important;
                min-width: 22px !important;
                max-width: 22px !important;
                min-height: 22px !important;
                max-height: 22px !important;
            }
            
            .custom-color-swatch {
                width: 22px !important;
                height: 22px !important;
                min-width: 22px !important;
                max-width: 22px !important;
                min-height: 22px !important;
                max-height: 22px !important;
            }
            
            .color-code-input {
                width: 80px !important;
                height: 22px !important;
                padding: 1px 5px !important;
                font-size: 12px !important;
            }
            
            .color-code-prefix {
                font-size: 12px !important;
                min-width: 12px !important;
                height: 22px !important;
                line-height: 22px !important;
            }
        }

        @media (max-width: 480px) {
            #fontSize {
                width: 50px;
                height: 35px;
                padding: 8px 4px;
                font-size: 14px;
            }
            
            .color-swatch {
                width: 20px !important;
                height: 20px !important;
                min-width: 20px !important;
                max-width: 20px !important;
                min-height: 20px !important;
                max-height: 20px !important;
            }
            
            .custom-color-swatch {
                width: 20px !important;
                height: 20px !important;
                min-width: 20px !important;
                max-width: 20px !important;
                min-height: 20px !important;
                max-height: 20px !important;
            }
            
            .color-code-input {
                width: 70px !important;
                height: 20px !important;
                padding: 1px 4px !important;
                font-size: 11px !important;
            }
            
            .color-code-prefix {
                font-size: 11px !important;
                min-width: 10px !important;
                height: 20px !important;
                line-height: 20px !important;
            }
            
            /* 确保自定义范围布局保持一致 */
            .custom-color-row-line {
                flex-direction: row;
            }
            
            .custom-color-input-group {
                flex-direction: row;
                align-items: center;
                gap: 4px;
            }

            .custom-color-input-group.range-group {
                flex-direction: column;
                align-items: flex-start;
            }

            /* 滑杆模式下颜色设置水平布局 - 超小屏幕 */
            #mode2 .custom-color-row-line.horizontal-layout {
                flex-direction: column;
                align-items: stretch;
                gap: 5px;
            }
            
            /* 滑杆模式下范围输入框样式 */
            #mode2 .custom-color-row-line .range-input-group {
                width: 100%;
            }
            
            #mode2 .custom-color-row-line .range-input-group .style-range-input {
                width: 100%;
                min-height: 35px;
                max-height: 100px;
                resize: vertical;
            }
            
            #mode2 .custom-color-row-line.horizontal-layout .custom-color-input-group {
                flex-direction: row;
                align-items: center;
            }

            #mode2 .custom-color-row-line.horizontal-layout .custom-color-input-group.range-group {
                flex-direction: column;
                align-items: flex-start;
            }

            #mode2 .custom-color-row-line.horizontal-layout .color-swatch-container {
                flex: 0 0 auto;
                min-width: auto;
            }

        }

        @media (max-width: 360px) {
            #fontSize {
                width: 50px;
                height: 35px;
                padding: 6px 4px;
                font-size: 13px;
            }
            
            .color-swatch {
                width: 18px !important;
                height: 18px !important;
                min-width: 18px !important;
                max-width: 18px !important;
                min-height: 18px !important;
                max-height: 18px !important;
            }
            
            .custom-color-swatch {
                width: 18px !important;
                height: 18px !important;
                min-width: 18px !important;
                max-width: 18px !important;
                min-height: 18px !important;
                max-height: 18px !important;
            }
            
            .color-code-input {
                width: 60px !important;
                height: 18px !important;
                padding: 1px 3px !important;
                font-size: 10px !important;
            }
            
            .color-code-prefix {
                font-size: 10px !important;
                min-width: 8px !important;
                height: 18px !important;
                line-height: 18px !important;
            }
            
            .color-swatch-container {
                gap: 5px !important;
            }
            
            /* 确保自定义范围布局保持一致 */
            .custom-color-row-line {
                flex-direction: row;
            }
            
            .custom-color-input-group {
                flex-direction: row;
                align-items: center;
                min-width: 0;
            }

            .custom-color-input-group.range-group {
                flex-direction: column;
                align-items: flex-start;
            }

            .custom-color-input-group label {
                font-size: 11px;
            }

        }
        
        /* 设置行布局 */
        .settings-row {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        /* 字体设置行样式 */
        .font-settings-row {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            align-items: flex-end;
        }

        .font-size-group {
            flex: 1;
        }

        .font-size-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #3898ff;
        }
        
        .settings-group {
            flex: 1;
        }
        
        /* 样式复选框 */
        .style-checkboxes {
            display: flex;
            flex-direction: row;
            gap: 15px;
            margin-bottom: 0;
            align-items: center;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
        }
        
        /* 颜色输入区域 */
        .color-inputs {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            align-items: flex-start;
            flex-wrap: wrap;
            justify-content: flex-start;
        }
        
        .color-input-row {
            display: flex;
            gap: 15px;
            width: 100%;
            margin-bottom: 10px;
            align-items: flex-start;
            flex-wrap: wrap;
            justify-content: flex-start;
        }
        
        /* 大屏幕模式下每排4列 */
        .color-input {
            flex: 0 0 calc(25% - 11.25px);
            max-width: calc(25% - 11.25px);
            min-width: 150px;
        }
        
        /* 确保在大屏幕下至少显示4列 */
        @media (min-width: 769px) {
            .color-input {
                flex: 0 0 calc(25% - 11.25px) !important;
                max-width: calc(25% - 11.25px) !important;
            }
        }
        
        /* 二色模式下的布局 - 使label、button、label相加的宽度铺满 */
        .color-inputs:has(.swap-colors-container) {
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .color-inputs:has(.swap-colors-container) .color-input {
            flex: 1 !important;
            max-width: none !important;
            min-width: 0 !important;
            display: flex;
            align-items: flex-start;
        }
        
        .color-inputs:has(.swap-colors-container) .color-label {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
            text-align: left;
        }
        
        .swap-colors-container {
            display: flex;
            align-items: flex-start;
            margin-top: 0;
            padding-top: 0;
        }
        
        .swap-colors-container .swap-colors-btn {
            margin-top: 0;
            margin-bottom: 0;
        }
        
        .swap-colors-btn {
            width: 40px !important;
            height: 40px !important;
            min-width: 40px !important;
            max-width: 40px !important;
            min-height: 40px !important;
            max-height: 40px !important;
            border-radius: 5px;
            background: #3898ff;
            color: white;
            border: none;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            box-sizing: border-box;
        }
        
        /* 二色模式下的布局 - 使label、button、label相加的宽度铺满 */
        .color-inputs:has(.swap-colors-container) {
            justify-content: space-between;
        }
        
        .color-inputs:has(.swap-colors-container) .color-input {
            flex: 1;
            min-width: 0;
        }
        
        .swap-colors-container {
            display: flex;
            align-items: flex-start;
            margin-top: 5px;
        }
        
        .swap-colors-btn {
            width: 40px;
            height: 40px;
            border-radius: 5px;
            background: #3898ff;
            color: white;
            border: none;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .color-input-group {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-top: 5px;
        }
        
        /* 颜色色块样式 */
        .color-swatch {
            width: 24px;
            height: 24px;
            min-width: 24px;
            max-width: 24px;
            min-height: 24px;
            max-height: 24px;
            border-radius: 4px;
            border: 2px solid #2a3a4a;
            flex-shrink: 0;
            cursor: pointer;
            position: relative;
            box-sizing: border-box;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        .color-swatch:hover {
            border-color: #3898ff;
            box-shadow: 0 0 8px rgba(56, 152, 255, 0.5);
        }

        /* 自定义颜色色块样式 */
        .custom-color-swatch {
            width: 24px;
            height: 24px;
            min-width: 24px;
            max-width: 24px;
            min-height: 24px;
            max-height: 24px;
            border-radius: 4px;
            border: 2px solid #2a3a4a;
            cursor: pointer;
            position: relative;
            box-sizing: border-box;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        .custom-color-swatch:hover {
            border-color: #3898ff;
            box-shadow: 0 0 8px rgba(56, 152, 255, 0.5);
        }

        /* 颜色代码输入框样式 - 重新设计 */
        .color-code-input {
            width: 90px !important;
            height: 24px !important;
            padding: 2px 6px !important;
            text-align: center !important;
            font-size: 13px !important;
            font-family: 'Courier New', monospace !important;
            font-weight: bold !important;
            border: 2px solid #2a3a4a !important;
            border-radius: 4px !important;
            background: #1e2a35 !important;
            color: #e0e0e0 !important;
            transition: border-color 0.3s, box-shadow 0.3s !important;
            box-sizing: border-box !important;
        }

        .color-code-input:focus {
            border-color: #3898ff !important;
            box-shadow: 0 0 8px rgba(56, 152, 255, 0.5) !important;
            outline: none !important;
        }

        /* 颜色色块容器样式 - 重新设计 */
        .color-swatch-container {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 4px 0;
        }

        /* 颜色代码组容器 - 重新设计 */
        .color-code-group {
            display: flex;
            align-items: center;
            gap: 0;
            flex-shrink: 0;
        }

        /* 颜色代码前缀符号样式 - 重新设计 */
        .color-code-prefix {
            font-size: 13px;
            font-weight: bold;
            color: #e0e0e0;
            font-family: 'Courier New', monospace;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 14px;
            height: 24px;
            line-height: 24px;
            user-select: none;
        }
        
        /* 响应式设计 - 手机布局 */
        @media (max-width: 768px) {
            .color-swatch {
                width: 22px !important;
                height: 22px !important;
                min-width: 22px !important;
                max-width: 22px !important;
                min-height: 22px !important;
                max-height: 22px !important;
            }
            
            .custom-color-swatch {
                width: 22px !important;
                height: 22px !important;
                min-width: 22px !important;
                max-width: 22px !important;
                min-height: 22px !important;
                max-height: 22px !important;
            }
            
            .color-code-input {
                width: 80px !important;
                height: 22px !important;
                padding: 1px 5px !important;
                font-size: 12px !important;
            }
            
            .color-code-prefix {
                font-size: 12px !important;
                min-width: 12px !important;
                height: 22px !important;
                line-height: 22px !important;
            }
            
            .color-swatch-container {
                gap: 8px !important;
            }
        }
        
        @media (max-width: 480px) {
            .color-swatch {
                width: 20px !important;
                height: 20px !important;
                min-width: 20px !important;
                max-width: 20px !important;
                min-height: 20px !important;
                max-height: 20px !important;
            }
            
            .custom-color-swatch {
                width: 20px !important;
                height: 20px !important;
                min-width: 20px !important;
                max-width: 20px !important;
                min-height: 20px !important;
                max-height: 20px !important;
            }
            
            .color-code-input {
                width: 70px !important;
                height: 20px !important;
                padding: 1px 4px !important;
                font-size: 11px !important;
            }
            
            .color-code-prefix {
                font-size: 11px !important;
                min-width: 10px !important;
                height: 20px !important;
                line-height: 20px !important;
            }
            
            .color-swatch-container {
                gap: 6px !important;
            }
        }
        
        /* 颜色标签样式 */
        .color-label {
            display: flex;
            flex-direction: column;
            gap: 8px;
            width: 100%;
            padding: 0;
            margin: 0;
            position: relative;
            font-weight: bold;
            font-size: 13px;
            line-height: 1.2;
            text-align: left !important;
            align-items: flex-start !important;
            justify-content: flex-start !important;
        }
        
        /* 确保小标题左上角对齐 */
        .color-label {
            white-space: nowrap;
            overflow: visible;
        }
        
        /* 确保在不同屏幕尺寸下保持左上角对齐 */
        @media (max-width: 768px) {
            .color-label {
                align-items: flex-start !important;
                justify-content: flex-start !important;
                text-align: left !important;
                font-size: 12px;
            }
        }
        
        @media (max-width: 480px) {
            .color-label {
                align-items: flex-start !important;
                justify-content: flex-start !important;
                text-align: left !important;
                font-size: 11px;
            }
        }
        
        @media (max-width: 360px) {
            .color-label {
                align-items: flex-start !important;
                justify-content: flex-start !important;
                text-align: left !important;
                font-size: 10px;
            }
        }
        
        /* 确保所有标题文本向左对齐 */
        .color-label {
            text-align: left !important;
        }
        
        /* 确保父元素不会影响对齐 */
        .color-input {
            text-align: left !important;
        }
        
        /* 确保容器不会影响对齐 */
        .color-inputs {
            text-align: left !important;
        }
        
        /* 颜色色块容器样式 */
        .color-swatch-container {
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: flex-start;
            padding: 0;
            margin: 0;
        }
        
        /* 确保色块左边缘与小标题对齐 */
        .color-swatch {
            width: 24px;
            height: 24px;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            position: relative;
        }
        
        /* 确保label内的文本与色块左边缘对齐 */
        .color-label {
            white-space: nowrap;
        }
        
        /* 确保整个结构左对齐 */
        .color-input {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            padding: 0;
            margin: 0;
        }
        
        /* 确保色块div与小标题对齐 */
        .color-swatch {
            margin: 0;
            padding: 0;
            vertical-align: top;
            width: 24px;
            height: 24px;
            box-sizing: border-box;
            position: relative;
        }
        
        /* 确保input与色块对齐 */
        .color-swatch input[type="color"] {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
            margin: 0;
            padding: 0;
        }
        
        /* 响应式设计 - 确保在不同屏幕尺寸下对齐 */
        @media (max-width: 768px) {
            .color-label {
                text-align: left;
                font-size: 12px;
            }
            
            .color-swatch-container {
                justify-content: flex-start;
            }
        }
        
        @media (max-width: 480px) {
            .color-label {
                text-align: left;
                font-size: 11px;
            }
            
            .color-swatch-container {
                justify-content: flex-start;
            }
        }
        
        /* 颜色代码输入样式 - 重新设计 */
        .color-code-input {
            width: 90px !important;
            height: 24px !important;
            padding: 2px 6px !important;
            text-align: center !important;
            font-size: 13px !important;
            font-family: 'Courier New', monospace !important;
            font-weight: bold !important;
            border: 2px solid #2a3a4a !important;
            border-radius: 4px !important;
            background: #1e2a35 !important;
            color: #e0e0e0 !important;
            transition: border-color 0.3s, box-shadow 0.3s !important;
            box-sizing: border-box !important;
        }

        .color-code-input:focus {
            border-color: #3898ff !important;
            box-shadow: 0 0 8px rgba(56, 152, 255, 0.5) !important;
            outline: none !important;
        }
        
        /* 响应式设计 - 小屏幕适配 */
        @media (max-width: 768px) {
            .color-inputs {
                gap: 10px;
            }
            
            .color-input-row {
                gap: 10px;
            }
            
            .color-input {
                min-width: 120px;
            }
            
            .color-swatch {
                width: 24px;
                height: 24px;
            }
        }
        
        /* 响应式设计 - 平板适配 */
        @media (max-width: 480px) {
            .color-inputs {
                gap: 8px;
            }
            
            .color-input-row {
                gap: 8px;
            }
            
            .color-input {
                flex: 0 0 calc(33.333% - 5.333px);
                min-width: auto;
                max-width: calc(33.333% - 5.333px);
            }
            
            .color-swatch {
                width: 20px;
                height: 20px;
            }
            
            .color-swatch-container {
                gap: 6px;
            }
            
            /* 渐变数量按钮响应式调整 - 小屏幕 */
            .gradient-count-btn {
                padding: 6px 10px;
                font-size: 11px;
                min-width: 50px;
            }
            
            .gradient-count-buttons {
                gap: 6px;
            }
        }
        
        .color-swatch input[type="color"] {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }
        
        .color-label {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* 颜色互换按钮样式 */
        .swap-colors-btn {
            width: 40px !important;
            height: 40px !important;
            min-width: 40px !important;
            max-width: 40px !important;
            min-height: 40px !important;
            max-height: 40px !important;
            border-radius: 5px;
            background: #3898ff;
            color: white;
            border: none;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 5px;
            box-sizing: border-box;
        }
        
        .swap-colors-btn:hover {
            background: #2d87e6;
            transform: scale(1.05);
        }
        
        /* 颜色预览区域 */
        .color-preview {
            height: 60px;
            border-radius: 8px;
            margin-bottom: 20px;
            background: linear-gradient(to right, #2effa4, #3898ff);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }
        
        /* 按钮组 */
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        button {
            flex: 1;
            padding: 16px;
            border: none;
            border-radius: 8px;
            background: linear-gradient(to right, #2effa4, #3898ff);
            color: #0d1b2a;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
        }
        
        button:active {
            transform: translateY(1px);
        }
        
        /* 输出区域 */
        .output {
            margin-top: 30px;
            background: #1a2530;
            border-radius: 8px;
            padding: 20px;
            position: relative;
            border: 1px solid rgba(56, 152, 255, 0.3);
        }
        
        .output-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .output-title {
            font-weight: bold;
            color: #2effa4;
            font-size: 14px;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        #codeCharCount {
            color: #3898ff;
            font-weight: bold;
            padding: 2px 6px;
            background: rgba(56, 152, 255, 0.1);
            border-radius: 3px;
            font-size: 13px;
        }
        
        .code-status {
            margin-left: 0;
            font-size: 12px;
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: normal;
        }
        
        .code-status.needs-update {
            color: #ff6b6b;
            background: rgba(255, 107, 107, 0.1);
            border: 1px solid #ff6b6b;
        }
        
        .code-status.up-to-date {
            color: #2effa4;
            background: rgba(46, 255, 164, 0.1);
            border: 1px solid #2effa4;
        }
        
        .output-buttons {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        .copy-btn, .favorite-btn {
            padding: 12px 20px;
            background: #3898ff;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
            min-height: 42px;
            min-width: 120px;
            justify-content: center;
            box-shadow: 0 2px 6px rgba(56, 152, 255, 0.3);
        }
        
        .copy-btn:hover, .favorite-btn:hover {
            background: #2d87e6;
        }
        
        .copy-btn.copied {
            background: #2effa4;
            color: #0d1b2a;
        }
        
        .favorite-btn.favorited {
            background: #ffd700;
            color: #0d1b2a;
        }
        
        /* 代码块样式 */
        .code-block {
            background: #0f161f;
            padding: 12px;
            border-radius: 4px;
            overflow-x: auto;
            white-space: pre-wrap;
            word-break: break-all;
            font-family: 'Courier New', monospace;
            color: #2effa4;
            border: 1px solid rgba(46, 255, 164, 0.2);
            cursor: text;
            user-select: text;
            font-size: 11px;
            line-height: 1.4;
        }
        
        .code-block.selected {
            background: rgba(46, 255, 164, 0.1);
        }
        
        /* 示例区域样式 */
        .examples {
            margin-top: 30px;
            background: rgba(30, 40, 50, 0.6);
            border-radius: 8px;
            padding: 20px;
            border: 1px solid rgba(56, 152, 255, 0.2);
            position: relative;
        }
        
        .examples-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .examples-title {
            font-weight: bold;
            color: #2effa4;
        }
        
        .examples-style-checkboxes {
            display: flex;
            gap: 15px;
        }
        
        .example-item {
            margin-bottom: 25px;
            padding: 15px;
            background: rgba(20, 30, 40, 0.7);
            border-radius: 8px;
            border-left: 3px solid #3898ff;
        }
        
        .example-preview {
            position: relative;
            text-align: center;
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .example-preview::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.25);
            z-index: 1;
        }
        
        .example-preview-content {
            position: relative;
            z-index: 2;
            opacity: 1;
            mix-blend-mode: normal;
        }
        
        .example-controls {
            display: flex;
            gap: 12px;
            margin-bottom: 10px;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
        }
        
        .example-text-input {
            flex: 1;
            min-width: 200px;
            padding: 10px 12px;
            border: 2px solid #2a3a4a;
            border-radius: 6px;
            background: #1e2a35;
            color: #e0e0e0;
            font-size: 14px;
        }
        
        .example-buttons {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .example-btn {
            padding: 10px 16px;
            background: #3898ff;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
            min-height: 38px;
            min-width: 85px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 6px rgba(56, 152, 255, 0.3);
        }
        
        .example-btn:hover {
            background: #2d87e6;
        }
        
        .example-code {
            background: #0f161f;
            padding: 12px;
            border-radius: 4px;
            overflow-x: auto;
            white-space: pre-wrap;
            word-break: break-all;
            font-family: 'Courier New', monospace;
            color: #2effa4;
            border: 1px solid rgba(46, 255, 164, 0.2);
            margin-top: 10px;
            font-size: 11px;
            line-height: 1.4;
            cursor: text;
            user-select: text;
        }
        
        .example-code.selected {
            background: rgba(46, 255, 164, 0.1);
        }
        
        /* 页脚样式 */
        .footer {
            margin-top: 30px;
            text-align: center;
            color: #7a8a9a;
            font-size: 14px;
            line-height: 1.5;
        }
        
        /* 通知提示样式 - 修改为更小尺寸和渐隐效果 */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 6px 12px; /* 减小内边距 */
            background: #2effa4;
            color: #0d1b2a;
            border-radius: 3px; /* 减小圆角 */
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2); /* 减小阴影 */
            font-weight: normal;
            font-size: 12px; /* 减小字体 */
            opacity: 0;
            transform: translateX(150%);
            transition: transform 0.3s ease, opacity 0.3s ease;
            z-index: 1000;
        }
        
        .notification.show {
            opacity: 1;
            transform: translateX(0);
        }
        
        .notification.hide {
            opacity: 0; /* 仅使用透明度变化实现渐隐效果 */
            transform: translateX(0); /* 保持在原位渐隐 */
        }
        
        .size-info {
            font-size: 12px;
            color: #7a8a9a;
            margin-top: 5px;
        }
        
        /* 菜单按钮和侧边栏样式 - 现代化简约设计 */
        .menu-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(25, 35, 45, 0.95);
            border: 1px solid rgba(56, 152, 255, 0.2);
            border-radius: 12px;
            color: #e0e0e0;
            padding: 12px 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            z-index: 100;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(255, 255, 255, 0.05);
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            min-height: 44px;
            min-width: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
        }
        
        .menu-btn:hover {
            background: rgba(35, 45, 55, 0.95);
            border-color: rgba(56, 152, 255, 0.4);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2), 0 0 0 1px rgba(56, 152, 255, 0.3);
            transform: translateY(-1px);
        }
        
        .menu-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
        }
        
        /* 更多颜色模式按钮样式 - 现代化简约设计 */
        .more-colors-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(25, 35, 45, 0.95);
            border: 1px solid rgba(56, 152, 255, 0.2);
            border-radius: 12px;
            color: #e0e0e0;
            padding: 12px 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            z-index: 100;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(255, 255, 255, 0.05);
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            white-space: nowrap;
            min-height: 44px;
            min-width: 110px;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
        }
        
        .more-colors-btn:hover {
            background: rgba(35, 45, 55, 0.95);
            border-color: rgba(56, 152, 255, 0.4);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2), 0 0 0 1px rgba(56, 152, 255, 0.3);
            transform: translateY(-1px);
        }
        
        .more-colors-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
        }
        
        /* 分享按钮样式 - 现代化简约设计 */
        .share-btn {
            position: fixed;
            top: 20px;
            left: 130px;
            background: rgba(25, 35, 45, 0.95);
            border: 1px solid rgba(56, 152, 255, 0.2);
            border-radius: 12px;
            color: #e0e0e0;
            padding: 12px 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            z-index: 100;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(255, 255, 255, 0.05);
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            min-height: 44px;
            min-width: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
        }
        
        .share-btn:hover {
            background: rgba(35, 45, 55, 0.95);
            border-color: rgba(56, 152, 255, 0.4);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2), 0 0 0 1px rgba(56, 152, 255, 0.3);
            transform: translateY(-1px);
        }
        
        .share-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
        }
        
        /* 响应式布局优化 - 确保按钮在不同屏幕尺寸下不重叠 */
        
        /* 平板设备 (768px - 1024px) */
        @media (min-width: 769px) and (max-width: 1024px) {
            .menu-btn, .share-btn, .more-colors-btn {
                padding: 11px 18px;
                font-size: 13px;
                min-height: 44px;
            }
            
            .menu-btn {
                left: 15px;
                min-width: 95px;
            }
            
            .share-btn {
                left: 120px;
                min-width: 95px;
            }
            
            .more-colors-btn {
                right: 15px;
                min-width: 105px;
            }
        }
        
        /* 移动设备 (≤768px) */
        @media (max-width: 768px) {
            .menu-btn, .share-btn, .more-colors-btn {
                padding: 10px 16px;
                font-size: 13px;
                box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
                min-height: 44px;
            }
            
            .menu-btn {
                left: 12px;
                min-width: 90px;
            }
            
            .share-btn {
                left: 112px;
                min-width: 90px;
            }
            
            .more-colors-btn {
                right: 12px;
                min-width: 100px;
            }
        }
        
        /* 小屏手机 (≤480px) */
        @media (max-width: 480px) {
            .menu-btn, .share-btn, .more-colors-btn {
                padding: 9px 14px;
                font-size: 12px;
                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.12);
                min-height: 44px;
            }
            
            .menu-btn {
                left: 10px;
                min-width: 80px;
            }
            
            .share-btn {
                left: 100px;
                min-width: 80px;
            }
            
            .more-colors-btn {
                right: 10px;
                min-width: 90px;
            }
        }
        
        /* 超小屏手机 (≤360px) */
        @media (max-width: 360px) {
            .menu-btn, .share-btn, .more-colors-btn {
                padding: 8px 12px;
                font-size: 11px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                min-height: 44px;
            }
            
            .menu-btn {
                left: 8px;
                min-width: 70px;
            }
            
            .share-btn {
                left: 88px;
                min-width: 70px;
            }
            
            .more-colors-btn {
                right: 8px;
                min-width: 80px;
            }
        }
        
        /* 更多颜色模式面板样式 - 只保留按钮 */
        .more-colors-panel {
            position: fixed;
            top: 75px;
            right: 20px;
            background: transparent; /* 去掉背景 */
            border-radius: 0;
            padding: 0;
            display: none;
            flex-direction: column;
            gap: 8px;
            z-index: 101; /* 提高z-index确保显示在侧边栏上方 */
            box-shadow: none; /* 去掉阴影 */
            border: none; /* 去掉边框 */
            backdrop-filter: none; /* 去掉背景模糊 */
            align-items: flex-end;
        }
        
        .more-colors-panel.show {
            display: flex;
        }
        
        .more-colors-panel-btn {
            padding: 8px 14px;
            background: rgba(25, 35, 45, 0.95);
            border: 1px solid rgba(56, 152, 255, 0.2);
            border-radius: 10px;
            color: #e0e0e0;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            z-index: 100;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.12), 0 0 0 1px rgba(255, 255, 255, 0.05);
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: center;
            min-width: auto;
            min-height: 36px;
            white-space: nowrap;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
            /* 初始状态：在按钮上方不可见 */
            opacity: 0;
            transform: translateY(-20px);
            animation: btnSlideDown 0.35s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }
        
        /* 响应式样式：确保所有屏幕尺寸保持相同布局，仅相对缩小 */
        
        /* 平板设备 (768px - 1024px) */
        @media (min-width: 769px) and (max-width: 1024px) {
            .more-colors-panel {
                top: 70px;
                gap: 6px;
            }
            
            .more-colors-panel-btn {
                padding: 7px 12px;
                font-size: 11px;
                min-height: 34px;
            }
        }
        
        /* 移动设备 (≤768px) */
        @media (max-width: 768px) {
            .more-colors-panel {
                top: 80px;
                flex-direction: column;
                gap: 5px;
            }
            
            .more-colors-panel-btn {
                padding: 6px 11px;
                font-size: 11px;
                min-height: 32px;
                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            }
        }
        
        @media (max-width: 480px) {
            .more-colors-panel {
                top: 75px;
                gap: 4px;
            }
            
            .more-colors-panel-btn {
                padding: 5px 10px;
                font-size: 10px;
                min-height: 30px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
            }
        }
        
        @media (max-width: 360px) {
            .more-colors-panel {
                top: 70px;
                gap: 3px;
            }
            
            .more-colors-panel-btn {
                padding: 4px 9px;
                font-size: 9px;
                min-height: 28px;
                box-shadow: 0 2px 3px rgba(0, 0, 0, 0.06);
            }
        }
        
        @keyframes btnSlideDown {
            0% {
                opacity: 0;
                transform: translateY(-20px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .more-colors-panel-btn:hover {
            background: rgba(35, 45, 55, 0.95);
            border-color: rgba(56, 152, 255, 0.4);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(56, 152, 255, 0.3);
            transform: translateY(-1px);
        }
        
        .more-colors-panel-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .more-colors-panel-btn.active {
            background: rgba(35, 45, 55, 0.95);
            border-color: rgba(46, 255, 164, 0.4);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(46, 255, 164, 0.3);
            color: #2effa4;
        }
        

        
        /* 自定义范围按钮样式 */
        .custom-btn {
            position: fixed;
            top: 20px;
            right: 120px;
            background: rgba(25, 35, 45, 0.9);
            border: none;
            border-radius: 8px;
            color: #e0e0e0;
            padding: 10px 15px;
            cursor: pointer;
            font-size: 16px;
            z-index: 100;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            transition: all 0.3s;
        }
        
        .custom-btn:hover {
            background: rgba(35, 45, 55, 0.9);
        }
        
        /* 侧边栏样式 */
        .sidebar {
            position: fixed;
            top: 0;
            left: -75%;
            width: 75%;
            height: 100vh;
            background: rgba(20, 30, 40, 0.95);
            padding: 15px;
            overflow-y: auto;
            transition: left 0.3s ease;
            z-index: 99;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.5);
        }
        
        .sidebar.open {
            left: 0;
        }
        
        /* 中屏幕侧边栏样式 */
        @media (min-width: 768px) {
            .sidebar {
                left: -320px;
                width: 320px;
            }
        }
        
        /* 大屏幕侧边栏样式 - 与1.1.8.html保持一致 */
        @media (min-width: 1200px) {
            .sidebar {
                left: -400px;
                width: 380px;
            }
        }
        
        /* 大屏幕设备（≥992px）按钮样式 */
        @media (min-width: 992px) {
            .history-action-btn {
                width: 36px;
                height: 36px;
                font-size: 12px;
            }
            
            .star-btn {
                width: 36px;
                height: 36px;
                font-size: 18px;
            }
        }
        
        /* 小屏幕设备侧边栏UI优化 */
        @media (max-width: 767px) {
            .sidebar {
                width: 65%;
                padding: 8px;
            }
            
            .sidebar-header {
                margin-bottom: 10px;
                padding-bottom: 5px;
                border-bottom: 1px solid rgba(56, 152, 255, 0.3);
                padding-top: 55px;
            }
            
            .sidebar-title {
                font-size: 1rem;
                color: #2effa4;
            }
            
            .back-btn {
                background: rgba(56, 152, 255, 0.2);
                border: none;
                color: #e0e0e0;
                width: 32px !important;
                height: 32px !important;
                padding: 0 !important;
                border-radius: 3px;
                cursor: pointer;
                font-size: 10px;
                transition: all 0.2s;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                flex-shrink: 0 !important;
            }
            
            .menu-item {
                background: rgba(30, 40, 50, 0.7);
                border-radius: 5px;
                padding: 8px;
                margin-bottom: 6px;
                border-left: 2px solid #3898ff;
                cursor: pointer;
                transition: all 0.2s;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            
            .menu-item-text {
                font-weight: 600;
                font-size: 12px;
            }
            
            .menu-item-arrow {
                color: #7a8a9a;
                font-size: 13px;
            }
            
            /* 历史记录和收藏项目样式 */
            .history-item, .favorite-item {
                background: rgba(30, 40, 50, 0.7);
                border-radius: 4px;
                padding: 6px;
                margin-bottom: 5px;
                border-left: 1.5px solid #3898ff;
            }
            
            .history-preview {
                margin-bottom: 4px;
                padding: 3px;
                border-radius: 2px;
            }
            
            .history-info {
                margin-top: 4px;
            }
            
            .history-text {
                font-size: 10px;
                color: #7a8a9a;
            }
            
            .history-color {
                width: 10px;
                height: 10px;
                border-radius: 2px;
            }
            
            .history-actions {
                gap: 4px;
                margin-top: 4px;
            }
            
            .history-action-btn {
                padding: 2px 5px;
                border-radius: 2px;
                font-size: 9px;
                width: 28px;
                height: 28px;
            }
            
            .star-btn {
                width: 28px;
                height: 28px;
                font-size: 14px;
            }
            
            /* 游戏装扮子菜单优化 */
            .dress-line {
                gap: 4px;
                margin-bottom: 5px;
                padding: 4px;
                border-left-width: 2px;
            }
            
            #dressDetailOutputArea .import-textarea {
                height: 24px;
                padding: 2px 4px;
                font-size: 10px;
                margin-bottom: 4px;
            }
            
            .dress-copy {
                padding: 2px 6px;
                font-size: 9px;
            }
            
            /* 装扮详情标题和选择器优化 */
            #dressDetailOutputArea label {
                font-size: 11px;
            }
            
            #dressDetailModeSelect {
                padding: 4px;
                font-size: 11px;
                margin-bottom: 5px;
            }
            
            /* 导入菜单优化 */
            .import-section {
                margin-top: 10px;
                padding: 8px;
            }
            
            .import-title {
                margin-bottom: 5px;
                font-size: 12px;
            }
            
            .import-textarea {
                height: 90px;
                padding: 4px 6px;
                font-size: 11px;
                margin-bottom: 5px;
            }
            
            .import-mode-selector {
                margin-bottom: 8px;
            }
            
            .import-mode-selector label {
                margin-bottom: 4px;
                font-size: 11px;
            }
            
            .import-mode-buttons {
                gap: 5px;
            }
            
            .import-mode-btn {
                padding: 4px 7px;
                font-size: 11px;
            }
            
            .import-btn {
                padding: 4px 8px;
                font-size: 11px;
            }
            
            /* 颜色选择器优化 */
            .color-swatch {
                width: 22px;
                height: 22px;
                border-width: 1.5px;
            }
            
            .custom-color-swatch {
                width: 22px;
                height: 22px;
                border-width: 1.5px;
            }
            
            /* 颜色代码输入框优化 - 使用统一的3:2宽高比 */
            .color-code-input {
                width: 80px !important;
                height: 22px !important;
                padding: 1px 5px !important;
                font-size: 12px !important;
            }
            
            /* 颜色代码前缀优化 */
            .color-code-prefix {
                font-size: 12px !important;
                min-width: 12px !important;
                height: 22px !important;
                line-height: 22px !important;
            }
            
            /* 颜色选择器容器优化 */
            .color-swatch-container {
                gap: 5px;
            }
            
            /* 颜色代码组优化 */
            .color-code-group {
                gap: 0;
                margin-top: 0;
            }
        }
        
        .sidebar-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(56, 152, 255, 0.3);
            padding-top: 60px; /* 增加顶部内边距，避免被菜单按钮遮挡 */
        }
        
        .sidebar-header .back-btn {
            margin-right: 10px;
        }
        
        .sidebar-title {
            font-size: 1.5rem;
            color: #2effa4;
        }
        
        .back-btn {
            background: rgba(56, 152, 255, 0.2);
            border: none;
            color: #e0e0e0;
            width: 40px !important;
            height: 40px !important;
            padding: 0 !important;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            flex-shrink: 0 !important;
        }
        
        .back-btn:hover {
            background: rgba(56, 152, 255, 0.4);
        }
        
        .sidebar-content {
            display: none;
        }
        
        .sidebar-content.active {
            display: block;
        }
        
        .menu-item {
            background: rgba(30, 40, 50, 0.7);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 3px solid #3898ff;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .menu-item:hover {
            background: rgba(35, 45, 55, 0.9);
            transform: translateX(5px);
        }
        
        .menu-item-text {
            font-weight: bold;
            font-size: 16px;
        }
        
        .menu-item-arrow {
            color: #7a8a9a;
            font-size: 18px;
        }
        
        /* 历史记录和收藏项目样式 */
        .history-item, .favorite-item {
            background: rgba(30, 40, 50, 0.7);
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 10px;
            border-left: 2px solid #3898ff;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        
        .history-item:hover, .favorite-item:hover {
            background: rgba(35, 45, 55, 0.9);
            transform: translateX(3px);
        }
        
        .history-preview {
            position: relative;
            text-align: center;
            margin-bottom: 8px;
            padding: 6px;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .history-preview::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 20, 30, 0.5);
            z-index: 1;
        }
        
        .history-preview-content {
            position: relative;
            z-index: 2;
            opacity: 1;
            mix-blend-mode: normal;
        }
        
        .history-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 8px;
        }
        
        .history-text {
            font-size: 13px;
            color: #7a8a9a;
        }
        
        .history-colors {
            display: flex;
            gap: 4px;
        }
        
        .history-color {
            width: 16px;
            height: 16px;
            border-radius: 2px;
            border: 1px solid #2a3a4a;
        }
        
        .history-actions {
            display: flex;
            gap: 8px;
            margin-top: 8px;
            justify-content: flex-end;
            flex-shrink: 0;
        }
        
        .history-action-btn {
            background: rgba(56, 152, 255, 0.3);
            border: none;
            color: #e0e0e0;
            width: 36px;
            height: 36px;
            padding: 0;
            border-radius: 2px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .history-action-btn:hover {
            background: rgba(56, 152, 255, 0.5);
        }
        
        .star-btn {
            background: none;
            border: none;
            color: #7a8a9a;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.2s;
            width: 36px;
            height: 36px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .star-btn.favorited {
            color: #ffd700;
        }
        
        .empty-message {
            text-align: center;
            color: #7a8a9a;
            padding: 20px;
        }
        
        /* 遮罩层样式 */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 98;
            display: none;
        }
        
        .overlay.show {
            display: block;
        }
        
        /* 导入区域样式 - 修改输入框比例 */
        .import-section {
            margin-top: 20px;
            padding: 15px;
            background: rgba(30, 40, 50, 0.7);
            border-radius: 8px;
        }
        
        .import-title {
            margin-bottom: 10px;
            font-weight: bold;
            color: #2effa4;
        }
        
        .import-textarea {
            width: 100%;
            height: 150px; /* 5:5比例，150px高对应150px宽 */
            padding: 8px 10px;
            border-radius: 5px;
            background: #1e2a35;
            color: #e0e0e0;
            border: 1px solid #2a3a4a;
            resize: vertical;
            margin-bottom: 10px;
            font-size: 14px;
        }
        
        /* 导入模式选择器 */
        .import-mode-selector {
            margin-bottom: 15px;
        }
        
        .import-mode-selector label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #3898ff;
        }
        
        .import-mode-buttons {
            display: flex;
            gap: 10px;
        }
        
        .import-mode-btn {
            flex: 1;
            padding: 8px 12px;
            background: rgba(56, 152, 255, 0.2);
            border: 1px solid rgba(56, 152, 255, 0.3);
            border-radius: 5px;
            color: #e0e0e0;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            text-align: center;
        }
        
        .import-mode-btn:hover {
            background: rgba(56, 152, 255, 0.3);
        }
        
        .import-mode-btn.active {
            background: rgba(46, 255, 164, 0.3);
            color: #2effa4;
            border-color: rgba(46, 255, 164, 0.5);
        }
        
        .import-btn {
            background: #3898ff;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .import-btn:hover {
            background: #2d87e6;
        }
        
        /* 清空按钮样式 */
        .clear-history-btn, .clear-favorites-btn {
            background: rgba(255, 77, 77, 0.3);
            color: #e0e0e0;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            margin-top: 10px;
            width: 100%;
        }
        
        .clear-history-btn:hover, .clear-favorites-btn:hover {
            background: rgba(255, 77, 77, 0.5);
        }
        
        .author-info {
            text-align: center;
            margin-top: 5px;
            color: #7a8a9a;
            font-size: 12px;
        }

        /* 游戏代码样式 */
        .dress-character-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .dress-line {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
            align-items: center;
            padding: 8px;
            background: rgba(30, 40, 50, 0.7);
            border-radius: 5px;
            border-left: 3px solid #3898ff;
        }

        .dress-line input {
            flex: 1;
            min-width: 0;
        }

        #dressDetailOutputArea .import-textarea {
            height: 32px;
            padding: 6px 8px;
            font-size: 13px;  
            margin-bottom: 8px; 
        }

        .dress-copy {
            background: #3898ff;
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            white-space: nowrap;
            transition: background 0.2s;
        }

        .dress-copy:hover {
            background: #2d87e6;
        }

        /* 模式切换按钮样式 */
        .mode-switch-btn {
            flex: 1;
            padding: 8px 12px;
            background: rgba(56, 152, 255, 0.2);
            border: 1px solid rgba(56, 152, 255, 0.3);
            border-radius: 5px;
            color: #e0e0e0;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
            text-align: center;
        }

        .mode-switch-btn:hover {
            background: rgba(56, 152, 255, 0.3);
        }

        .mode-switch-btn.active {
            background: rgba(46, 255, 164, 0.3);
            color: #2effa4;
            border-color: rgba(46, 255, 164, 0.5);
        }

        /* 随机模式选择器样式 */
        .random-mode-selector {
            margin-top: 10px;
        }

        .random-mode-selector label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #3898ff;
        }

        /* 自定义范围模式样式 */
        .custom-color-selector {
            margin-top: 10px;
        }

        .custom-color-selector label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #3898ff;
        }

        .custom-color-rows {
            margin-top: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }

        .custom-color-row {
            display: flex;
            flex-direction: column;
            gap: 6px;
            flex: 0 0 calc(33.333% - 10px);
            min-width: 0; /* 移除最小宽度限制，确保能保持3列布局 */
            background: rgba(30, 40, 50, 0.6);
            padding: 6px;
            border-radius: 8px;
            border: 1px solid #2a3a4a;
            transition: all 0.3s ease;
        }
        
        /* 中屏幕设备 - 两列布局 */
        @media (max-width: 768px) {
            .custom-color-row {
                flex: 0 0 calc(50% - 7.5px); /* 50%宽度减去一半间距 */
                max-width: calc(50% - 7.5px);
            }
        }
        
        /* 小屏幕设备 - 两列布局 */
        @media (max-width: 480px) {
            .custom-color-row {
                flex: 0 0 calc(50% - 7.5px); /* 小屏幕上仍然显示为两列 */
                max-width: calc(50% - 7.5px);
                padding: 8px;
                gap: 8px;
            }
            
            .custom-color-row-line {
                gap: 5px;
            }
            
            .custom-color-input-group {
                gap: 6px;
            }
            
            /* 颜色代码输入框 - 使用统一的3:2宽高比样式 */
        }

        .custom-color-row-line {
            display: flex;
            flex-direction: column;
            gap: 3px;
            align-items: stretch;
        }

        .range-input-group {
            display: flex;
            width: 100%;
        }

        .range-input-group .style-range-input {
            width: 100%;
            min-height: 35px;
            max-height: 100px;
            resize: vertical;
        }

        .custom-color-input-group {
            display: flex;
            align-items: center;
            gap: 5px;
            min-width: 0;
        }

        .custom-color-input-group.range-group {
            flex-direction: column;
            align-items: flex-start;
        }

        .custom-color-input-group label {
            font-size: 13px;
            color: #7a8a9a;
            white-space: normal;
            word-break: break-word;
        }

        .input-hint {
            font-size: 10px;
            color: #6a7a8a;
            margin-top: 2px;
        }
        
        /* 模式切换的平滑过渡效果 */
        #mode1, #mode2 {
            transition: opacity 0.1s ease, visibility 0.1s ease;
            opacity: 1;
            visibility: visible;
        }

        /* 自定义颜色行中的字体大小输入框 - 与字数长度匹配 */
        /* 隐藏默认的数字输入框上下箭头 */
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type="number"] {
            -moz-appearance: textfield;
            /* 添加对IE11的支持 */
            -ms-appearance: textfield;
            /* 标准属性（目前浏览器支持有限） */
            appearance: textfield;
        }

        /* 字体大小输入框基础样式 - 3:2 宽高比 */
        .font-size-input {
            width: 80px;
            height: 40px;
            text-align: center;
            padding: 10px 5px;
            border: 1px solid #2a3a4a;
            border-radius: 5px;
            background: #1e2a35;
            color: #e0e0e0;
            font-size: 14px;
            outline: none;
            transition: border-color 0.3s;
        }

        /* 自定义字体大小输入框特殊样式 - 3:2 宽高比 */
        .custom-font-size-input {
            width: 80px;
            height: 40px;
            text-align: center;
            padding: 10px 5px;
            border: 1px solid #2a3a4a;
            border-radius: 5px;
            background: #1e2a35;
            color: #e0e0e0;
            font-size: 14px;
            outline: none;
            transition: border-color 0.3s;
        }

        /* 输入框获得焦点时的样式 */
        .font-size-input:focus,
        .custom-font-size-input:focus {
            border-color: #3898ff;
        }

        /* 字体大小输入框组容器 */
        .font-size-input-group {
            display: flex;
            align-items: center;
        }

        .custom-color-swatch {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            border: 2px solid #2a3a4a;
            cursor: pointer;
            position: relative;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        
        .custom-color-swatch:hover {
            border-color: #3898ff;
            box-shadow: 0 0 8px rgba(56, 152, 255, 0.5);
        }

        .custom-color-swatch input[type="color"] {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }

        .custom-color-count-selector {
            margin-top: 15px;
            background: rgba(30, 40, 50, 0.6);
            padding: 15px;
            border-radius: 8px;
            border-left: 3px solid #3898ff;
        }

        .custom-color-count-selector label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: #3898ff;
        }

        .custom-color-count-buttons {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .custom-color-count-btn {
            padding: 10px 16px;
            background: rgba(56, 152, 255, 0.2);
            border: 2px solid rgba(56, 152, 255, 0.3);
            border-radius: 6px;
            color: #e0e0e0;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.2s ease;
            min-width: 60px;
        }

        .custom-color-count-btn:hover {
            background: rgba(56, 152, 255, 0.3);
            transform: translateY(-2px);
        }

        .custom-color-count-btn.active {
            background: rgba(46, 255, 164, 0.3);
            color: #2effa4;
            border-color: rgba(46, 255, 164, 0.5);
            box-shadow: 0 2px 8px rgba(46, 255, 164, 0.3);
        }

        /* 自定义样式输入区域 */
        .custom-style-section {
            margin-top: 15px;
            background: rgba(30, 40, 50, 0.6);
            padding: 10px;
            border-radius: 8px;
            border-left: 3px solid #3898ff;
        }

        .style-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        /* 切换样式按钮样式 - 保持1:1比例 */
        .style-header .toggle-style-btn, #toggleStyleBtn {
            width: 50px !important;
            height: 50px !important;
            padding: 0 !important;
            background: rgba(56, 152, 255, 0.2);
            border: 2px solid rgba(56, 152, 255, 0.3);
            border-radius: 8px;
            color: #e0e0e0;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-sizing: border-box;
            min-width: 50px !important;
            max-width: 50px !important;
            min-height: 50px !important;
            max-height: 50px !important;
        }

        .toggle-style-btn:hover {
            background: rgba(56, 152, 255, 0.3);
            transform: translateY(-2px);
        }

        .style-content {
            margin-top: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .custom-style-inputs {
            margin-top: 15px;
            background: rgba(30, 40, 50, 0.6);
            padding: 10px;
            border-radius: 8px;
            border-left: 3px solid #3898ff;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .style-content .style-input-group {
            flex: 0 0 calc(33.333% - 6px);
            margin-bottom: 0;
            padding: 8px;
            background: rgba(25, 35, 45, 0.6);
            border-radius: 6px;
        }

        .style-content .style-input-group:last-child {
            margin-bottom: 0;
        }

        .style-content .checkbox-group {
            margin-bottom: 5px;
        }

        .style-content .style-range-input {
            width: 100%;
            padding: 8px;
            border: 1px solid #2a3a4a;
            border-radius: 5px;
            background: #1e2a35;
            color: #e0e0e0;
            font-size: 14px;
            min-height: 35px;
            max-height: 100px;
            resize: vertical;
            box-sizing: border-box;
        }
        
        /* 滑杆模式下隐藏范围输入框 */
        #mode2 .style-content .style-range-input {
            display: none;
        }
        
        /* 数字模式在所有屏幕尺寸下保持3列布局 */
        #mode1 .style-content .style-input-group {
            flex: 0 0 calc(33.333% - 6px);
        }
        
        /* 数字模式下显示范围输入框 */
        #mode1 .style-content .style-range-input {
            display: block;
        }

        .style-content .input-hint {
            font-size: 10px;
            color: #6a7a8a;
            margin-top: 3px;
        }

        /* 渐变功能样式 */
        .custom-gradient-section {
            margin-top: 15px;
            background: rgba(30, 40, 50, 0.6);
            padding: 10px;
            border-radius: 8px;
            border-left: 3px solid #3898ff;
        }

        .gradient-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        /* 切换渐变按钮样式 - 保持1:1比例 */
        .gradient-header .toggle-gradient-btn, #toggleGradientBtn {
            width: 50px !important;
            height: 50px !important;
            padding: 0 !important;
            background: rgba(56, 152, 255, 0.2);
            border: 2px solid rgba(56, 152, 255, 0.3);
            border-radius: 8px;
            color: #e0e0e0;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-sizing: border-box;
            min-width: 50px !important;
            max-width: 50px !important;
            min-height: 50px !important;
            max-height: 50px !important;
        }

        .toggle-gradient-btn:hover {
            background: rgba(56, 152, 255, 0.3);
            transform: translateY(-2px);
        }

        .gradient-content {
            margin-top: 10px;
        }

        .gradient-count-selector {
            margin-bottom: 15px;
        }

        .gradient-count-selector label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: #3898ff;
        }

        .gradient-count-buttons {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .gradient-count-btn {
            padding: 10px 16px;
            background: rgba(56, 152, 255, 0.2);
            border: 2px solid rgba(56, 152, 255, 0.3);
            border-radius: 6px;
            color: #e0e0e0;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.2s ease;
            min-width: 80px;
        }

        .gradient-count-btn:hover {
            background: rgba(56, 152, 255, 0.3);
            transform: translateY(-2px);
        }

        .gradient-count-btn.active {
            background: rgba(46, 255, 164, 0.3);
            color: #2effa4;
            border-color: rgba(46, 255, 164, 0.5);
            box-shadow: 0 2px 8px rgba(46, 255, 164, 0.3);
        }

        /* 渐变提醒文本 */
        .gradient-reminder {
            font-size: 10px !important;
            color: #999 !important;
            margin-top: 5px !important;
            margin-bottom: 10px !important;
            text-align: left !important;
            line-height: 1.2 !important;
        }

        .gradient-bars {
            margin-top: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        /* 渐变条容器中的颜色行 - 两列布局 */
        .custom-gradient-section .gradient-bars .custom-color-row {
            flex: 0 0 calc(50% - 7.5px) !important; /* 50%宽度减去一半间距 */
            max-width: calc(50% - 7.5px) !important;
            box-sizing: border-box !important;
        }
        
        /* 1渐变模式中的颜色行 - 宽度铺满，起始和末尾颜色并列 */
        .custom-gradient-section .gradient-bars .custom-color-row.full-width {
            flex: 0 0 100% !important;
            max-width: 100% !important;
            box-sizing: border-box !important;
        }
        
        /* 1渐变模式中的颜色输入组 - 并列显示 */
        .custom-color-row.full-width .color-inputs-row {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }
        
        .custom-color-row.full-width .color-inputs-row .custom-color-input-group {
            flex: 1;
        }
        
        /* 大屏幕模式下渐变功能的起始和末尾色块水平排列 */
        @media (min-width: 769px) {
            .custom-color-row:not(.full-width) .custom-color-row-line:nth-child(3),
            .custom-color-row:not(.full-width) .custom-color-row-line:nth-child(4) {
                display: inline-block;
                width: calc(50% - 5px);
                vertical-align: top;
            }
            
            .custom-color-row:not(.full-width) .custom-color-row-line:nth-child(3) {
                margin-right: 10px;
            }
        }
        
        /* 确保在小屏幕上仍然保持两列布局 */
        @media (max-width: 480px) {
            .custom-gradient-section .gradient-bars {
                gap: 10px;
            }
            
            .custom-gradient-section .gradient-bars .custom-color-row {
                flex: 0 0 calc(50% - 5px) !important; /* 小屏幕上仍然显示为两列 */
                max-width: calc(50% - 5px) !important;
                padding: 8px !important;
                gap: 8px !important;
            }
            
            .custom-gradient-section .gradient-bars .color-code-input {
                width: 70px !important;
                height: 20px !important;
                padding: 1px 4px !important;
                font-size: 11px !important;
            }
            
            .custom-gradient-section .gradient-bars .color-code-prefix {
                font-size: 11px !important;
                min-width: 10px !important;
                height: 20px !important;
                line-height: 20px !important;
            }
            
            .custom-gradient-section .gradient-bars .color-swatch {
                width: 20px !important;
                height: 20px !important;
                min-width: 20px !important;
                max-width: 20px !important;
                min-height: 20px !important;
                max-height: 20px !important;
            }
            
            .custom-gradient-section .gradient-bars .custom-color-swatch {
                width: 20px !important;
                height: 20px !important;
                min-width: 20px !important;
                max-width: 20px !important;
                min-height: 20px !important;
                max-height: 20px !important;
            }
        }
        
        /* 超小屏幕手机适配 */
        @media (max-width: 360px) {
            .custom-gradient-section .gradient-bars {
                gap: 8px;
            }
            
            .custom-gradient-section .gradient-bars .custom-color-row {
                flex: 0 0 calc(50% - 4px) !important; /* 超小屏幕上仍然显示为两列 */
                max-width: calc(50% - 4px) !important;
                padding: 6px !important;
                gap: 6px !important;
            }
        }
        
        /* 渐变条预览样式 */
        .gradient-preview-container {
            width: 100%;
            margin-bottom: 5px;
        }
        
        .gradient-preview-bar {
            width: 100%;
            height: 10px;
            border-radius: 5px;
            border: 1px solid #2a3a4a;
            background: linear-gradient(to right, #2effa4, #3898ff);
            margin-bottom: 5px;
        }
        
        /* 渐变颜色数量选择器样式 */
        .gradient-color-count-selector {
            margin: 15px 0;
            background: rgba(30, 40, 50, 0.6);
            padding: 10px;
            border-radius: 8px;
            border-left: 3px solid #3898ff;
        }
        
        .gradient-color-count-selector label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: #3898ff;
        }
        
        .gradient-color-count-buttons {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .gradient-color-count-btn {
            width: 40px !important;
            height: 40px !important;
            padding: 0 !important;
            background: rgba(56, 152, 255, 0.2);
            border: 2px solid rgba(56, 152, 255, 0.3);
            border-radius: 6px;
            color: #e0e0e0;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-sizing: border-box;
        }
        
        .gradient-color-count-btn:hover {
            background: rgba(56, 152, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .gradient-color-count-btn.active {
            background: rgba(46, 255, 164, 0.3);
            color: #2effa4;
            border-color: rgba(46, 255, 164, 0.5);
            box-shadow: 0 2px 8px rgba(46, 255, 164, 0.3);
        }

        /* 自定义范围模式的全局字体设置 */
        .custom-global-settings {
            margin-top: 15px;
            background: rgba(30, 40, 50, 0.6);
            padding: 10px;
            border-radius: 8px;
            border-left: 3px solid #3898ff;
        }

        .custom-global-settings .font-settings-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            align-items: center;
            justify-content: space-between;
        }



        .custom-global-settings .style-checkboxes {
            display: flex;
            gap: 15px;
        }

        .color-swatch-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* 响应式设计 - 手机适配 */
        @media (max-width: 768px) {
            body {
                padding: 8px;
                min-height: 100vh;
            }
            
            #fontSize {
                width: 60px;
                height: 40px;
                padding: 8px 4px;
                font-size: 14px;
            }
            
            /* 颜色代码输入框 - 使用统一的3:2宽高比样式 */



            .font-settings-row {
                flex-direction: row;
                gap: 10px;
                margin-bottom: 15px;
                align-items: center;
            }

            .font-size-group {
                flex: 1;
            }

            .style-checkboxes {
                flex-direction: row;
                gap: 15px;
                margin-left: 10px;
                margin-bottom: 0;
            }

            .size-info {
                margin-top: 5px;
                margin-bottom: 15px;
            }

            .container {
                max-width: 100%;
                padding: 12px;
                margin-top: 80px;
                border-radius: 8px;
            }
            
            h1 {
                font-size: 1.6rem;
                padding-bottom: 6px;
                margin-bottom: 5px;
            }
            
            .subtitle {
                font-size: 11px;
                margin-bottom: 15px;
            }
            
            h1::after {
                left: 20%;
                width: 60%;
            }
            
            .preview-section {
                margin-bottom: 20px;
            }
            
            .preview-title {
                margin-bottom: 10px;
                font-size: 14px;
            }
            
            .preview-content {
                padding: 12px !important;
                min-height: 50px !important;
                height: 40px !important;
                border-radius: 6px;
            }
            
            .input-group {
                margin-bottom: 15px;
            }
            
            label {
                font-size: 14px;
                margin-bottom: 6px;
            }
            
            textarea, input[type="text"], input[type="number"], input[type="password"], select {
                padding: 10px;
                font-size: 14px;
                border-radius: 6px;
            }
            
            .settings-row {
                flex-direction: row;
                gap: 8px;
                margin-bottom: 15px;
            }
            
            .size-info {
                font-size: 11px;
            }
            
            .style-checkboxes {
                flex-direction: row;
                gap: 10px;
                margin-bottom: 15px;
            }
            
            .color-inputs {
                flex-direction: row;
                gap: 8px;
                margin-bottom: 15px;
            }
            
            .color-input-row {
                flex-direction: row;
                gap: 8px;
            }
            
            .color-input-group {
                flex-direction: row;
                align-items: center;
                gap: 8px;
            }
            
            .color-swatch {
                width: 22px;
                height: 22px;
            }
            
            /* 手机端互换按钮样式 */
            .swap-colors-btn {
                width: 28px;
                height: 28px;
                font-size: 14px;
            }
            
            .color-preview {
                height: 50px;
                margin-bottom: 15px;
                border-radius: 6px;
            }
            
            .button-group {
                flex-direction: row;
                gap: 8px;
                margin-top: 15px;
            }
            
            button {
                padding: 12px;
                font-size: 14px;
                border-radius: 6px;
            }
            
            .output {
                margin-top: 20px;
                padding: 15px;
                border-radius: 6px;
            }
            
            .output-header {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
                gap: 10px;
                margin-bottom: 12px;
            }
            
            .output-buttons {
                flex-direction: row;
                gap: 6px;
                width: 100%;
            }
            
            .copy-btn, .favorite-btn {
                flex: 1;
                justify-content: center;
                padding: 10px;
                font-size: 13px;
            }
            
            .code-block {
                padding: 12px;
                font-size: 11px;
                border-radius: 4px;
                white-space: pre-wrap;
                word-break: break-all;
                line-height: 1.4;
            }
            
            .examples {
                margin-top: 20px;
                padding: 15px;
                border-radius: 6px;
            }
            
            .examples-header {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
                gap: 8px;
                margin-bottom: 12px;
            }
            
            .examples-title {
                font-size: 14px;
            }
            
            .examples-style-checkboxes {
                flex-direction: row;
                gap: 8px;
                width: 100%;
            }
            
            .example-item {
                margin-bottom: 20px;
                padding: 12px;
                border-radius: 6px;
            }
            
            .example-preview {
                padding: 8px;
                margin-bottom: 12px;
                border-radius: 4px;
            }
            
            .example-controls {
                flex-direction: row;
                gap: 6px;
                margin-bottom: 8px;
                flex-wrap: wrap;
            }
            
            .example-text-input {
                min-width: 100%;
            }
            
            .example-buttons {
                width: 100%;
            }
            
            .example-btn {
                flex: 1;
                padding: 8px 10px;
                font-size: 13px;
            }
            
            .example-code {
                padding: 8px;
                font-size: 11px;
                border-radius: 4px;
                white-space: pre-wrap;
                word-break: break-all;
                line-height: 1.4;
            }
            
            .footer {
                margin-top: 20px;
                font-size: 12px;
            }
            
            /* 手机端更多颜色面板位置调整 */
            .more-colors-panel {
                top: 80px;
                right: 20px;
            }
            
            .sidebar {
                padding: 20px;
            }
            
            .sidebar.open {
                left: 0;
            }
            
            .sidebar-header {
                padding-top: 60px;
                margin-bottom: 20px;
            }
            
            .sidebar-title {
                font-size: 1.5rem;
            }
            
            .back-btn {
                width: 40px;
                height: 40px;
                padding: 0;
                font-size: 13px;
                display: flex;
                align-items: center;
                justify-content: center;
                margin-right: auto;
            }
            
            .menu-item {
                padding: 12px;
                margin-bottom: 10px;
                border-radius: 6px;
            }
            
            .menu-item-text {
                font-size: 14px;
            }
            
            .history-item, .favorite-item {
                padding: 10px;
                margin-bottom: 8px;
                border-radius: 5px;
                border-left: 2px solid #3898ff;
            }
            
            .history-preview {
                padding: 5px;
                margin-bottom: 6px;
                border-radius: 3px;
            }
            
            .history-info {
                flex-direction: column;
                align-items: flex-start;
                gap: 6px;
            }
            
            .history-actions {
                flex-direction: row;
                align-items: center;
                gap: 6px;
                margin-top: 8px;
                justify-content: flex-end;
                flex-shrink: 0;
            }
            
            .history-action-btn {
                width: 36px;
                height: 36px;
                text-align: center;
                padding: 0;
                font-size: 11px;
                display: flex;
                align-items: center;
                justify-content: center;
                flex-shrink: 0;
            }
            
            .star-btn {
                width: 36px;
                height: 36px;
                padding: 0;
                display: flex;
                align-items: center;
                justify-content: center;
                flex-shrink: 0;
            }
            
            .import-section {
                margin-top: 15px;
                padding: 12px;
                border-radius: 6px;
            }
            
            .import-textarea {
                height: 120px; /* 5:5比例，手机端调整 */
                padding: 8px;
                font-size: 13px;
            }
            
            .import-btn {
                padding: 8px 12px;
                font-size: 13px;
            }
            
            .clear-history-btn, .clear-favorites-btn {
                padding: 8px 12px;
                font-size: 13px;
                margin-top: 8px;
            }
            
            /* 自定义范围在中等屏幕下保持3列布局 */
            @media (min-width: 481px) {
                .custom-color-row {
                    flex: 0 0 calc(33.333% - 10px) !important;
                    min-width: 0 !important;
                    padding: 8px;
                    gap: 8px;
                }
            }
            
            /* 自定义范围在小屏幕下保持2列布局 */
            @media (max-width: 480px) {
                .custom-color-row {
                    flex: 0 0 calc(50% - 7.5px) !important;
                    min-width: 0 !important;
                    padding: 8px;
                    gap: 8px;
                }
                
                /* 滑杆模式下颜色设置水平布局 */
                #mode2 .custom-color-row-line.horizontal-layout {
                    flex-direction: row;
                    flex-wrap: wrap;
                    align-items: center;
                    gap: 8px;
                }
                
                #mode2 .custom-color-row-line.horizontal-layout .custom-color-input-group {
                    flex: 1;
                    min-width: 0;
                }

                #mode2 .custom-color-row-line.horizontal-layout .custom-color-input-group.range-group {
                    flex-direction: column;
                    align-items: flex-start;
                }
                
                #mode2 .custom-color-row-line.horizontal-layout .custom-color-input-group label {
                    white-space: nowrap;
                }
                
                #mode2 .custom-color-row-line.horizontal-layout .color-swatch-container {
                    display: flex;
                    align-items: center;
                    gap: 5px;
                    min-width: auto;
                }
                
                #mode2 .custom-color-row-line.horizontal-layout .color-code-input {
                    width: 70px !important;
                    height: 20px !important;
                    padding: 1px 4px !important;
                    font-size: 11px !important;
                    flex: 0 0 auto;
                    min-width: 0;
                }
                
                #mode2 .custom-color-row-line.horizontal-layout .color-code-prefix {
                    font-size: 11px !important;
                    min-width: 10px !important;
                    height: 20px !important;
                    line-height: 20px !important;
                }
                
                #mode2 .custom-color-row-line.horizontal-layout .color-swatch {
                    width: 20px !important;
                    height: 20px !important;
                    min-width: 20px !important;
                    max-width: 20px !important;
                    min-height: 20px !important;
                    max-height: 20px !important;
                }
                
                #mode2 .custom-color-row-line.horizontal-layout .custom-color-swatch {
                    width: 20px !important;
                    height: 20px !important;
                    min-width: 20px !important;
                    max-width: 20px !important;
                    min-height: 20px !important;
                    max-height: 20px !important;
                }
            }
            
            .custom-color-row-line {
                gap: 10px;
            }
            
            .custom-color-input-group {
                gap: 5px;
            }
            
            /* 渐变数量按钮响应式调整 */
            .gradient-count-btn {
                padding: 8px 12px;
                font-size: 12px;
                min-width: 60px;
            }
            
            .gradient-count-buttons {
                gap: 8px;
            }
            
            .custom-color-input-group label {
                font-size: 12px;
            }
            
            .custom-font-size-input,
            .color-code-input {
                padding: 8px;
                font-size: 12px;
            }
            
            .custom-color-swatch {
                width: 24px;
                height: 24px;
            }
            
            .custom-color-count-buttons {
                gap: 5px;
                justify-content: center;
            }
            
            .custom-color-count-btn {
                padding: 6px 10px;
                font-size: 12px;
                min-width: 40px;
                text-align: center;
            }

            /* 手机端自定义字体大小输入框 - 4:2 宽高比 */
            .custom-font-size-input {
                width: 80px;
                height: 40px;
                padding: 8px 4px;
                font-size: 14px;
            }

            /* 手机端颜色代码输入框 - 使用统一的3:2宽高比样式 */

            .color-swatch-container {
                gap: 6px;
            }
        }

        /* 小屏幕手机适配 */
        @media (max-width: 480px) {
            body {
                padding: 5px;
            }

            .font-settings-row {
                gap: 8px;
            }

            .font-size-group label {
                font-size: 13px;
                margin-bottom: 5px;
            }

            .style-checkboxes {
                gap: 10px;
                margin-left: 8px;
            }
            
            .container {
                padding: 8px;
            }
            
            h1 {
                font-size: 1.4rem;
            }
            
            .subtitle {
                font-size: 10px;
            }
            
            .preview-content {
                padding: 8px !important;
                min-height: 45px !important;
                height: 35px !important;
            }
            
            textarea, input[type="text"], input[type="number"], input[type="password"], select {
                padding: 8px;
                font-size: 13px;
            }
            
            .style-checkboxes, .examples-style-checkboxes {
                gap: 6px;
                flex-direction: row;
            }
            
            .checkbox-group {
                gap: 6px;
            }
            
            .checkbox-group input[type="checkbox"] {
                width: 16px;
                height: 16px;
            }
            
            .color-swatch {
                width: 25px;
                height: 25px;
            }
            
            /* 小屏幕互换按钮样式 */
            .swap-colors-btn {
                width: 25px;
                height: 25px;
                font-size: 12px;
            }
            
            .color-preview {
                height: 45px;
            }
            
            button {
                padding: 10px;
                font-size: 13px;
            }
            
            /* 小屏幕切换渐变按钮样式 - 保持1:1比例 */
            .gradient-header .toggle-gradient-btn, #toggleGradientBtn {
                width: 50px !important;
                height: 50px !important;
                padding: 0 !important;
                font-size: 18px;
                display: flex;
                align-items: center;
                justify-content: center;
                box-sizing: border-box;
                min-width: 50px !important;
                max-width: 50px !important;
                min-height: 50px !important;
                max-height: 50px !important;
            }

            /* 小屏幕切换样式按钮样式 - 保持1:1比例 */
            .style-header .toggle-style-btn, #toggleStyleBtn {
                width: 50px !important;
                height: 50px !important;
                padding: 0 !important;
                font-size: 18px;
                display: flex;
                align-items: center;
                justify-content: center;
                box-sizing: border-box;
                min-width: 50px !important;
                max-width: 50px !important;
                min-height: 50px !important;
                max-height: 50px !important;
            }
            
            .code-block, .example-code {
                font-size: 10px;
                padding: 8px;
            }
            
            .more-colors-panel {
                top: 75px;
                right: 10px;
            }
            
            .notification {
                top: 15px;
                right: 15px;
                padding: 12px 16px;
                font-size: 13px;
            }
            
            .sidebar {
                padding: 20px;
            }
            
            .sidebar-header {
                padding-top: 60px;
                margin-bottom: 20px;
                display: flex;
                align-items: center;
            }
            
            .sidebar-header .back-btn {
                margin-right: 10px;
            }
            
            .author-info {
                font-size: 11px;
            }

            /* 小屏幕自定义范围保持2列布局 */
            .custom-color-row {
                flex: 0 0 calc(50% - 7.5px) !important;
                min-width: 0 !important;
            }
            
            /* 小屏幕自定义字体大小输入框 - 4:2 宽高比 */
            .custom-font-size-input {
                width: 70px;
                height: 35px;
                padding: 6px 4px;
                font-size: 13px;
            }

            /* 小屏幕颜色代码输入框 - 重新设计 */
            .color-code-input {
                width: 70px !important;
                height: 20px !important;
                padding: 1px 4px !important;
                font-size: 11px !important;
            }
            
            .color-code-prefix {
                font-size: 11px !important;
                min-width: 10px !important;
                height: 20px !important;
                line-height: 20px !important;
            }
            
            .color-swatch {
                width: 20px !important;
                height: 20px !important;
                min-width: 20px !important;
                max-width: 20px !important;
                min-height: 20px !important;
                max-height: 20px !important;
            }
            
            .custom-color-swatch {
                width: 20px !important;
                height: 20px !important;
                min-width: 20px !important;
                max-width: 20px !important;
                min-height: 20px !important;
                max-height: 20px !important;
            }


        }

        /* 超小屏幕手机适配 */
        @media (max-width: 360px) {
            body {
                padding: 3px;
            }
            
            .preview-header {
                flex-wrap: wrap;
                gap: 5px;
            }
            
            .preview-controls {
                flex-shrink: 0;
            }
            
            #fontSize {
                width: 50px;
                height: 35px;
                padding: 6px 3px;
                font-size: 13px;
            }

            .font-settings-row {
                gap: 6px;
            }

            .font-size-group label {
                font-size: 12px;
            }

            .style-checkboxes {
                gap: 8px;
                margin-left: 6px;
            }
            .container {
                padding: 6px;
            }
            
            h1 {
                font-size: 1.3rem;
            }
            
            .preview-content {
                padding: 6px;
                min-height: 40px;
            }
            
            textarea, input[type="text"], input[type="number"], input[type="password"], select {
                padding: 6px;
                font-size: 12px;
            }
            
            /* 超小屏幕互换按钮样式 */
            .swap-colors-btn {
                width: 22px;
                height: 22px;
                font-size: 11px;
            }
            
            .align-btn {
                width: 24px;
                height: 24px;
                min-height: 24px;
                max-height: 24px;
            }
            
            .left-align-btn::before {
                width: 10px;
                top: 7px;
                left: 7px;
            }
            
            .left-align-btn::after {
                width: 6px;
                top: 12px;
                left: 7px;
                box-shadow: 0 3px 0 currentColor;
            }
            
            .center-align-btn::before {
                width: 10px;
                top: 7px;
                left: 7px;
            }
            
            .center-align-btn::after {
                width: 6px;
                top: 12px;
                left: 9px;
                box-shadow: 0 3px 0 currentColor;
            }
            
            button {
                padding: 8px;
                font-size: 12px;
            }
            
            .more-colors-panel {
                top: 70px;
                right: 10px;
            }

            /* 超小屏幕自定义范围保持2列布局 */
            .custom-color-row {
                flex: 0 0 calc(50% - 7.5px) !important;
                min-width: 0 !important;
            }
            
            /* 超小屏幕自定义字体大小输入框 - 4:2 宽高比 */
            .custom-font-size-input {
                width: 60px;
                height: 30px;
                padding: 5px 3px;
                font-size: 12px;
            }

            /* 超小屏幕颜色代码输入框 - 重新设计 */
            .color-code-input {
                width: 60px !important;
                height: 18px !important;
                padding: 1px 3px !important;
                font-size: 10px !important;
            }
            
            .color-code-prefix {
                font-size: 10px !important;
                min-width: 8px !important;
                height: 18px !important;
                line-height: 18px !important;
            }
            
            .color-swatch {
                width: 18px !important;
                height: 18px !important;
                min-width: 18px !important;
                max-width: 18px !important;
                min-height: 18px !important;
                max-height: 18px !important;
            }
            
            .custom-color-swatch {
                width: 18px !important;
                height: 18px !important;
                min-width: 18px !important;
                max-width: 18px !important;
                min-height: 18px !important;
                max-height: 18px !important;
            }
            
            /* 渐变数量按钮响应式调整 - 超小屏幕 */
            .gradient-count-btn {
                padding: 4px 8px;
                font-size: 10px;
                min-width: 40px;
            }
            
            .gradient-count-buttons {
                gap: 4px;
            }
        }

        /* 大屏幕适配 */
        @media (min-width: 1200px) {
            .container {
                max-width: 1000px;
            }
            
            /* 大屏幕侧边栏样式 - 与1.1.8.html保持一致 */
            .sidebar {
                left: -400px;
                width: 380px;
            }
        }
        
        /* 横屏手机适配 */
        @media (max-height: 500px) and (orientation: landscape) {
            body {
                padding: 5px;
            }
    
            .container {
                padding: 10px;
            }
    
            .preview-section {
                margin-bottom: 15px;
            }
    
            .input-group {
                margin-bottom: 15px;
            }
    
            .button-group {
                margin-top: 15px;
            }
    
            .output {
                margin-top: 20px;
            }
    
            .examples {
                margin-top: 20px;
            }
        }

        /* ========== 滑动范围选择器样式 ========== */
        .slider-range-container {
            margin: 15px 0;
            padding: 15px;
            background: #1e2a35;
            border-radius: 8px;
            border: 2px solid #2a3a4a;
        }

        .slider-range-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .slider-range-title {
            font-weight: bold;
            color: #e0e0e0;
            font-size: 14px;
        }

        .slider-range-controls {
            display: flex;
            gap: 8px;
        }

        .slider-range-btn, .style-input-group .slider-range-btn {
            width: 28px !important;
            height: 28px !important;
            border-radius: 4px !important;
            border: none !important;
            background: #3898ff !important;
            color: #fff !important;
            font-size: 14px !important;
            font-weight: bold !important;
            cursor: pointer !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            transition: all 0.3s ease !important;
            padding: 0 !important;
            min-height: 28px !important;
            max-height: 28px !important;
            line-height: 1 !important;
        }

        .slider-range-btn:hover {
            background: #2d87e6;
        }

        .slider-range-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .slider-range-track-container {
            position: relative;
            height: 40px;
            margin: 10px 0;
        }

        .slider-range-track {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 10px;
            background: #2a3a4a;
            border-radius: 10px;
            transform: translateY(-50%);
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.3);
        }

        .slider-range-segment {
            position: absolute;
            height: 10px;
            background: linear-gradient(135deg, #3898ff, #2d87e6);
            border-radius: 10px;
            transition: none;
            box-shadow: 0 0 8px rgba(56, 152, 255, 0.4);
        }

        .slider-range-handle {
            position: absolute;
            top: 50%;
            width: 22px;
            height: 22px;
            background: #1e2a35;
            border: 3px solid #3898ff;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            cursor: grab;
            transition: transform 0.15s ease, box-shadow 0.15s ease, border-color 0.15s ease;
            z-index: 10;
        }
        
        .slider-range-handle.dragging {
            cursor: grabbing;
            transition: none;
        }

        .slider-range-handle:hover {
            transform: translate(-50%, -50%) scale(1.1);
            box-shadow: 0 0 12px rgba(56, 152, 255, 0.6);
            border-color: #5ab0ff;
        }

        .slider-range-handle:active {
            transform: translate(-50%, -50%) scale(1.15);
            box-shadow: 0 4px 16px rgba(56, 152, 255, 0.7);
            border-color: #5ab0ff;
        }

        .slider-range-handle.dragging {
            transform: translate(-50%, -50%) scale(1.2);
            box-shadow: 0 6px 20px rgba(56, 152, 255, 0.8);
            border-color: #5ab0ff;
        }

        @media (max-width: 768px) {
            .slider-range-handle {
                width: 18px;
                height: 18px;
                border-width: 2.5px;
            }

            .slider-range-handle:hover {
                transform: translate(-50%, -50%) scale(1.08);
            }

            .slider-range-handle:active {
                transform: translate(-50%, -50%) scale(1.12);
            }

            .slider-range-handle.dragging {
                transform: translate(-50%, -50%) scale(1.15);
            }
        }

        .slider-range-scale {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            height: 50px;
            display: flex;
            align-items: flex-start;
            padding: 10px 15px 0;
            font-size: 12px;
            color: #7a8a9a;
            box-sizing: border-box;
            overflow: visible;
        }

        .slider-range-scale-item {
            position: absolute;
            width: 1px;
            background: #4a5a6a;
            transition: all 0.3s ease;
            transform: translateX(-50%);
        }

        .slider-range-scale-item.char-boundary {
            height: 8px;
            background: #5a6a7a;
        }

        .slider-range-scale-item.char-boundary.major {
            height: 18px;
            background: #3898ff;
        }

        .slider-range-scale-item.char-boundary.major.with-number::before {
            content: attr(data-value);
            position: absolute;
            top: 24px;
            left: 50%;
            transform: translateX(-50%);
            white-space: nowrap;
            color: #e0e0e0;
            font-size: 12px;
            font-weight: 600;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }

        .slider-range-scale-item.major {
            height: 14px;
            background: #3898ff;
        }

        .slider-range-scale-item.major::before {
            content: attr(data-value);
            position: absolute;
            top: 18px;
            left: 50%;
            transform: translateX(-50%);
            white-space: nowrap;
            color: #e0e0e0;
            font-size: 11px;
            font-weight: 600;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }

        @media (max-width: 768px) {
            .slider-range-scale {
                height: 45px;
                padding: 8px 10px 0;
            }

            .slider-range-scale-item.char-boundary {
                height: 6px;
            }

            .slider-range-scale-item.char-boundary.major {
                height: 16px;
            }

            .slider-range-scale-item.char-boundary.major.with-number::before {
                font-size: 10px;
                top: 20px;
            }

            .slider-range-scale-item.major::before {
                font-size: 10px;
                top: 16px;
            }
        }

        .slider-range-values {
            display: none;
        }

        .slider-range-value-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .slider-range-value-item:last-child {
            margin-bottom: 0;
        }

        .slider-range-value-label {
            min-width: 60px;
            font-size: 13px;
            color: #666;
            margin-right: 10px;
        }

        .slider-range-value-input {
            flex: 1;
            padding: 6px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            color: #333;
            transition: border-color 0.3s ease;
        }

        .slider-range-value-input:focus {
            outline: none;
            border-color: #3898ff;
            box-shadow: 0 0 0 3px rgba(56, 152, 255, 0.1);
        }

        .slider-range-value-input::placeholder {
            color: #ccc;
        }

        /* 只在非自定义范围模式下隐藏原始的textarea输入框 */
        .custom-mode-selector:not(.active) + .random-mode-selector + .custom-color-selector + .custom-style-section .style-content .style-input-group .style-range-input,
        .custom-mode-selector:not(.active) + .random-mode-selector + .custom-color-selector + .custom-style-section .style-content .style-input-group .input-hint {
            display: none;
        }
        
        /* 在自定义范围模式下显示原始的textarea输入框，并隐藏滑动范围选择器 */
        .custom-mode-selector.active + .random-mode-selector + .custom-color-selector + .custom-style-section .style-content .style-input-group .style-range-input,
        .custom-mode-selector.active + .random-mode-selector + .custom-color-selector + .custom-style-section .style-content .style-input-group .input-hint {
            display: block;
        }
        
        /* 在自定义范围模式下隐藏滑动范围选择器 */
        .custom-mode-selector.active + .random-mode-selector + .custom-color-selector + .custom-style-section .style-content .style-input-group .slider-range-container {
            display: none;
        }
        
        /* 在非自定义范围模式下显示滑动范围选择器 */
        .custom-mode-selector:not(.active) + .random-mode-selector + .custom-color-selector + .custom-style-section .style-content .style-input-group .slider-range-container {
            display: block;
        }

        /* 滑动范围选择器在样式输入组中的样式 */
        .style-input-group .slider-range-container {
            margin: 10px 0;
            padding: 12px;
            background: #1e2a35;
            border-radius: 8px;
            border: 2px solid #2a3a4a;
        }

        .style-input-group .slider-range-title {
            font-size: 13px;
            color: #e0e0e0;
        }

        .style-input-group .slider-range-track-container {
            height: 40px;
        }

        .style-input-group .slider-range-handle {
            width: 20px;
            height: 20px;
            background: #1e2a35;
            border: 2px solid #3898ff;
        }
        
        /* 预览区域样式扩展 */
        /* 预览区域样式1 */
        .preview-section.style1 {
            background: linear-gradient(to right, #30233F, #482766);
        }
        
        /* 小窗口标题栏样式1 */
        .floating-preview-header.style1 {
            background: linear-gradient(to right, #30233F, #482766);
        }
        
        /* 预览区域样式2 */
        .preview-section.style2 {
            background: linear-gradient(to right, #8C407A, #A64E8F);
        }
        
        /* 小窗口标题栏样式2 */
        .floating-preview-header.style2 {
            background: linear-gradient(to right, #8C407A, #A64E8F);
        }
        
        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .preview-controls {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-shrink: 0;
        }
        
        /* 对齐按钮图标 - 三线风格 */
        .align-btn {
            position: relative;
            width: 28px;
            height: 28px;
            min-height: 28px;
            max-height: 28px;
            flex: none;
            border: none;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.2);
            color: #ffffff;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            padding: 0;
            box-sizing: border-box;
        }
        
        .align-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* 左对齐图标：三条线左对齐，中间那条短 */
        .left-align-btn::before {
            content: '';
            position: absolute;
            width: 14px;
            height: 2px;
            background-color: currentColor;
            border-radius: 1px;
            top: 8px;
            left: 7px;
        }
        .left-align-btn::after {
            content: '';
            position: absolute;
            width: 10px;
            height: 2px;
            background-color: currentColor;
            border-radius: 1px;
            top: 13px;
            left: 7px;
            box-shadow: 0 4px 0 currentColor;
        }

        /* 居中对齐图标：三条线居中，中间那条短 */
        .center-align-btn::before {
            content: '';
            position: absolute;
            width: 14px;
            height: 2px;
            background-color: currentColor;
            border-radius: 1px;
            top: 8px;
            left: 7px;
        }
        .center-align-btn::after {
            content: '';
            position: absolute;
            width: 10px;
            height: 2px;
            background-color: currentColor;
            border-radius: 1px;
            top: 13px;
            left: 9px;
            box-shadow: 0 4px 0 currentColor;
        }
        
        .dropdown-container {
            position: relative;
        }
        
        .dropdown-btn {
            width: 100px;
            flex: none;
            padding: 4px 8px;
            border: none;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.2);
            color: #ffffff;
            font-size: 12px;
            cursor: pointer;
            box-shadow: none;
            height: 28px;
            min-height: 28px;
            max-height: 28px;
            display: flex;
            align-items: center;
            box-sizing: border-box;
        }
        
        .dropdown-panel {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 4px;
            background: rgba(30, 40, 50, 0.95);
            border: 1px solid rgba(56, 152, 255, 0.3);
            border-radius: 4px;
            display: none;
            z-index: 1000;
            width: 100px;
            min-width: 100px;
            flex-direction: column;
        }
        
        .dropdown-panel.show {
            display: block;
        }
        
        .dropdown-item {
            width: 100px;
            flex: none;
            height: 28px;
            min-height: 28px;
            max-height: 28px;
            padding: 4px 8px;
            border: none;
            background: transparent;
            color: #ffffff;
            font-size: 12px;
            text-align: left;
            cursor: pointer;
            display: flex;
            align-items: center;
            box-sizing: border-box;
        }
        
        /* 响应式设计：小屏幕下按钮等比放大 */
        @media (max-width: 768px) {
            .preview-header {
                flex-wrap: wrap;
                gap: 8px;
            }
            
            .preview-controls {
                flex-shrink: 0;
            }
            
            .align-btn {
                width: 32px;
                height: 32px;
                min-height: 32px;
                max-height: 32px;
            }
            
            .left-align-btn::before {
                width: 14px;
                top: 9px;
                left: 9px;
            }
            
            .left-align-btn::after {
                width: 10px;
                top: 14px;
                left: 9px;
                box-shadow: 0 4px 0 currentColor;
            }
            
            .center-align-btn::before {
                width: 14px;
                top: 9px;
                left: 9px;
            }
            
            .center-align-btn::after {
                width: 10px;
                top: 14px;
                left: 11px;
                box-shadow: 0 4px 0 currentColor;
            }
            
            .dropdown-btn {
                width: 100px;
                flex: none;
                height: 32px;
                min-height: 32px;
                max-height: 32px;
                padding: 4px 8px;
                font-size: 12px;
            }
            
            .preview-title {
                padding: 4px 8px;
                font-size: 12px;
                height: 32px;
                min-height: 32px;
                max-height: 32px;
            }
            
            .dropdown-item {
                width: 100px;
                flex: none;
                height: 32px;
                min-height: 32px;
                max-height: 32px;
                padding: 4px 8px;
                font-size: 12px;
            }
            
            .dropdown-panel {
                width: 100px;
                min-width: 100px;
            }
            
            /* 预览内容区域响应式高度 */
            .preview-content {
                height: 45px;
                padding: 0 12px;
            }
            
            /* 输出标题区域响应式优化 */
            .output-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }
            
            .output-title {
                font-size: 13px;
                width: 100%;
            }
            
            .output-buttons {
                width: 100%;
                justify-content: space-between;
                gap: 10px;
            }
            
            .favorite-btn,
            .copy-btn,
            .toggle-code-btn {
                flex: 1;
                min-width: 85px;
                padding: 11px 18px;
                font-size: 13px;
                min-height: 40px;
            }
        }
        
        @media (max-width: 480px) {
            .preview-header {
                flex-wrap: wrap;
                gap: 6px;
            }
            
            .preview-controls {
                flex-shrink: 0;
            }
            
            .align-btn {
                width: 28px;
                height: 28px;
                min-height: 28px;
                max-height: 28px;
            }
            
            .left-align-btn::before {
                width: 12px;
                top: 8px;
                left: 8px;
            }
            
            .left-align-btn::after {
                width: 8px;
                top: 13px;
                left: 8px;
                box-shadow: 0 3px 0 currentColor;
            }
            
            .center-align-btn::before {
                width: 12px;
                top: 8px;
                left: 8px;
            }
            
            .center-align-btn::after {
                width: 8px;
                top: 13px;
                left: 10px;
                box-shadow: 0 3px 0 currentColor;
            }
            
            .dropdown-btn {
                width: 100px;
                flex: none;
                height: 28px;
                min-height: 28px;
                max-height: 28px;
                padding: 3px 6px;
                font-size: 11px;
            }
            
            .preview-title {
                padding: 3px 6px;
                font-size: 11px;
                height: 28px;
                min-height: 28px;
                max-height: 28px;
            }
            
            .dropdown-item {
                width: 100px;
                flex: none;
                height: 28px;
                min-height: 28px;
                max-height: 28px;
                padding: 3px 6px;
                font-size: 11px;
            }
            
            .dropdown-panel {
                width: 100px;
                min-width: 100px;
            }
            
            /* 预览内容区域响应式高度 */
            .preview-content {
                height: 40px;
                padding: 0 10px;
            }
            
            /* 输出标题区域响应式优化 */
            .output-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .output-title {
                font-size: 12px;
                width: 100%;
            }
            
            .output-buttons {
                width: 100%;
                justify-content: space-between;
                gap: 8px;
            }
            
            .favorite-btn,
            .copy-btn,
            .toggle-code-btn {
                flex: 1;
                min-width: 75px;
                padding: 10px 14px;
                font-size: 12px;
                min-height: 38px;
            }
            
            #codeCharCount {
                font-size: 12px;
                padding: 2px 4px;
            }
            
            .code-status {
                font-size: 11px;
                padding: 2px 6px;
            }
        }
    </style>
    <!-- ========== CSS样式结束 ========== -->
    <base target="_blank">
</head>

<body>
    <!-- 通知提示框 -->
    <div class="notification" id="notification">渐变代码已生成！</div>
    
    <!-- 顶部按钮区域 - 修改后 -->
    <button class="menu-btn" id="menuBtn">☰ 菜单</button>
    <button class="more-colors-btn" id="moreColorsBtn">更多颜色</button>
    <button class="share-btn" id="shareBtn">分享</button>
    
    <!-- 更多颜色模式面板 -->
    <div class="more-colors-panel" id="moreColorsPanel">
        <button class="more-colors-panel-btn active" data-mode="home">颜色渐变</button>
        <button class="more-colors-panel-btn" data-mode="custom">自定义范围</button>
    </div>
    
    <!-- 遮罩层 -->
    <div class="overlay" id="overlay"></div>
    
    <!-- ========== 侧边栏菜单系统 ========== -->
    <div class="sidebar" id="sidebar">
        <!-- 主菜单 -->
        <div class="sidebar-content active" id="mainMenu">
            <div class="sidebar-header">
                <h2 class="sidebar-title">菜单</h2>
            </div>
            
            <div class="menu-item" data-target="historyMenu">
                <div class="menu-item-text">历史颜色</div>
                <div class="menu-item-arrow">→</div>
            </div>
            
            <div class="menu-item" data-target="favoritesMenu">
                <div class="menu-item-text">收藏夹</div>
                <div class="menu-item-arrow">→</div>
            </div>
            
            <div class="menu-item" data-target="importMenu">
                <div class="menu-item-text">导入颜色代码</div>
                <div class="menu-item-arrow">→</div>
            </div>
            <!-- 游戏代码入口 -->
             <div class="menu-item" data-target="gameCodeMenu">
                <div class="menu-item-text">游戏代码</div>
                <div class="menu-item-arrow">→</div>
            </div>
            
            <!-- 公告内容 -->
            <div class="announcement-container" style="margin-top: 20px; border-radius: 8px; border-left: 3px solid #3898ff; overflow: hidden; background: rgba(30, 40, 50, 0.7);">
                <!-- 公告标题栏 -->
                <div class="announcement-header" style="padding: 10px 15px; background: rgba(56, 152, 255, 0.1); border-bottom: 1px solid rgba(56, 152, 255, 0.2); font-weight: bold; color: #e0e0e0;">
                    🔔 公告更新
                </div>
                <!-- 公告内容区域（带滚动功能） -->
                <div class="announcement-content" style="padding: 15px; font-size: 14px; line-height: 1.5; color: #e0e0e0; max-height: 250px; overflow-y: auto;">
                    <div class="announcement-item">
                        <strong>2.4更新：</strong>
                        <ul style="margin: 8px 0 12px 20px; padding: 0;">
                            <li>修复【自定义范围】中无法输入bug</li>
                            <li>优化了生成代码格式，修复了部分已知bug</li>
                        </ul>
                        <strong>1.31更新：</strong>
                        <ul style="margin: 8px 0 12px 20px; padding: 0;">
                            <li>在【自定义范围】中增加【滑杆模式】模式页面；</li>
                            <li>针对布局与悬浮球进行了优化，增加了预览小窗口相关功能；</li>
                            <li>预览效果中增加了对应游戏中的背景样式</li>
                            <li>优化了生成代码格式，修复了部分已知bug</li>
                        </ul>
                    </div>
                    <div class="announcement-item">
                        <strong>1.24更新：</strong>
                        <ul style="margin: 8px 0 12px 20px; padding: 0;">
                            <li>在【自定义范围】中增加【渐变颜色范围】功能</li>
                            <li>针对历史和收藏颜色栏修复bug并优化使用</li>
                            <li>但代码导入功能目前还未成功修复到预期效果，请酌情考虑使用</li>
                        </ul>
                    </div>
                    <div class="announcement-item">
                        <strong>1.16更新：</strong>
                        <ul style="margin: 8px 0 12px 20px; padding: 0;">
                            <li>已修复【自定义范围】中，生成的代码字体大小没有变化的bug</li>
                        </ul>
                    </div>
                </div>
                <div class="announcement-contact" style="margin-top: 15px; padding-top: 10px; border-top: 1px solid rgba(56, 152, 255, 0.2);">
                    <strong>bug可反馈邮箱：</strong>
                    <span style="color: #2effa4;">mobinsll1024@gmail.com</span>
                    <button id="copyEmailBtn" style="margin-left: 8px; background: rgba(56, 152, 255, 0.2); border: none; color: #e0e0e0; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px;">复制</button>
                </div>
            </div>
            
            <!-- 公告组件样式 -->
            <style>
                .announcement-container {
                    margin-top: 20px;
                    border-radius: 8px;
                    border-left: 3px solid #3898ff;
                    overflow: hidden;
                    background: rgba(30, 40, 50, 0.7);
                    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
                }
                
                .announcement-header {
                    padding: 10px 15px;
                    background: rgba(56, 152, 255, 0.1);
                    border-bottom: 1px solid rgba(56, 152, 255, 0.2);
                    font-weight: bold;
                    color: #e0e0e0;
                    font-size: 14px;
                }
                
                .announcement-content {
                    padding: 15px;
                    font-size: 14px;
                    line-height: 1.5;
                    color: #e0e0e0;
                    max-height: 250px;
                    overflow-y: auto;
                }
                
                .announcement-content::-webkit-scrollbar {
                    width: 6px;
                }
                
                .announcement-content::-webkit-scrollbar-track {
                    background: rgba(56, 152, 255, 0.1);
                    border-radius: 3px;
                }
                
                .announcement-content::-webkit-scrollbar-thumb {
                    background: rgba(56, 152, 255, 0.5);
                    border-radius: 3px;
                }
                
                .announcement-content::-webkit-scrollbar-thumb:hover {
                    background: rgba(56, 152, 255, 0.7);
                }
                
                .announcement-item {
                    margin-bottom: 12px;
                }
                
                .announcement-item ul {
                    margin: 8px 0 12px 20px;
                    padding: 0;
                }
                
                .announcement-item li {
                    margin-bottom: 4px;
                }
                
                .announcement-contact {
                    margin-top: 15px;
                    padding-top: 10px;
                    border-top: 1px solid rgba(56, 152, 255, 0.2);
                }
                
                /* 响应式设计 */
                @media (max-width: 768px) {
                    .announcement-container {
                        margin-top: 15px;
                    }
                    
                    .announcement-header {
                        padding: 8px 12px;
                        font-size: 13px;
                    }
                    
                    .announcement-content {
                        padding: 12px;
                        font-size: 13px;
                        max-height: 200px;
                    }
                }
                
                @media (max-width: 480px) {
                    .announcement-content {
                        max-height: 180px;
                    }
                }
            </style>
            
            <!-- 公告内容已优化 -->
        </div>

        <!-- 游戏代码主菜单 -->
        <div class="sidebar-content" id="gameCodeMenu">
            <div class="sidebar-header">
                <button class="back-btn" data-target="mainMenu" style="width: 40px; height: 40px; padding: 0; display: flex; align-items: center; justify-content: center;">← 返回</button>
                <h2 class="sidebar-title">游戏代码</h2>
            </div>
            
            <div class="menu-item" data-target="dressMenu">
                <div class="menu-item-text">角色装扮</div>
                <div class="menu-item-arrow">→</div>
            </div>
            
            <div class="menu-item" data-target="danMenu">
                <div class="menu-item-text">丹药</div>
                <div class="menu-item-arrow">→</div>
            </div>
            
            <div class="menu-item" data-target="propMenu">
                <div class="menu-item-text">娱乐道具</div>
                <div class="menu-item-arrow">→</div>
            </div>
        </div>

        <!-- 历史颜色菜单 -->
        <div class="sidebar-content" id="historyMenu">
            <div class="sidebar-header">
                <button class="back-btn" data-target="mainMenu" style="width: 40px; height: 40px; padding: 0; display: flex; align-items: center; justify-content: center;">← 返回</button>
                <h2 class="sidebar-title">历史颜色</h2>
            </div>
            
            <div id="historyList"></div>
            <button class="clear-history-btn" id="clearHistoryBtn">清空历史记录</button>
        </div>
        
        <!-- 收藏夹菜单 -->
        <div class="sidebar-content" id="favoritesMenu">
            <div class="sidebar-header">
                <button class="back-btn" data-target="mainMenu" style="width: 40px; height: 40px; padding: 0; display: flex; align-items: center; justify-content: center;">← 返回</button>
                <h2 class="sidebar-title">收藏夹</h2>
            </div>
            
            <div id="favoritesList"></div>
            <button class="clear-favorites-btn" id="clearFavoritesBtn">清空收藏夹</button>
        </div>
        
        <!-- 导入代码菜单 - 修改后 -->
        <div class="sidebar-content" id="importMenu">
            <div class="sidebar-header">
                <button class="back-btn" data-target="mainMenu" style="width: 40px; height: 40px; padding: 0; display: flex; align-items: center; justify-content: center;">← 返回</button>
                <h2 class="sidebar-title">导入颜色代码</h2>
            </div>
            
            <div class="import-section">
                <div class="import-title">导入颜色代码</div>
                
                <!-- 导入模式选择器 -->
                <div class="import-mode-selector">
                    <label>选择导入模式：</label>
                    <div class="import-mode-buttons">
                        <button class="import-mode-btn active" data-mode="gradient">渐变代码</button>
                        <button class="import-mode-btn" data-mode="custom">自定义范围代码</button>
                    </div>
                </div>
                
                <textarea class="import-textarea" id="importTextarea" placeholder="请粘贴游戏代码，例如：&#10;&lt;size=16&gt;&lt;color=#FF3842&gt;做&lt;/color&gt;&lt;color=#FF6834&gt;一&lt;/color&gt;&lt;color=#FF9834&gt;场&lt;/color&gt;&lt;/size&gt;&#10;&#10;或CSS渐变：linear-gradient(90deg, #FF3842, #FF6834, #FF9834)"></textarea>
                <button class="import-btn" id="importBtn">导入代码</button>
            </div>
        </div>

        <!-- 游戏装扮子菜单（角色详情） -->
        <div class="sidebar-content" id="dressDetailMenu">
            <div class="sidebar-header">
                <button class="back-btn" data-target="dressMenu" style="width: 40px; height: 40px; padding: 0; display: flex; align-items: center; justify-content: center;">← 返回</button>
                <h2 class="sidebar-title" id="dressDetailTitle">角色装扮</h2>
            </div>
            <label style="color:#3898ff;font-size:14px;">选择模式：</label>
            <select id="dressDetailModeSelect" class="import-textarea" style="height:auto;padding:8px;margin-bottom:10px;"></select>
            <div id="dressDetailOutputArea" style="margin-top:15px;">
                <!-- 普通角色显示三个输入框 -->
                <div id="normalCharacterOutput" style="display:none;">
                    <label style="color:#3898ff;font-size:14px;">头发</label>
                    <div class="dress-line">
                        <input class="import-textarea" id="dressDetailHair" readonly>
                        <button class="dress-copy" data-target="dressDetailHair">复制</button>
                    </div>
                    <label style="color:#3898ff;font-size:14px;">脸妆</label>
                    <div class="dress-line">
                        <input class="import-textarea" id="dressDetailFace" readonly>
                        <button class="dress-copy" data-target="dressDetailFace">复制</button>
                    </div>
                    <label style="color:#3898ff;font-size:14px;">衣服</label>
                    <div class="dress-line">
                        <input class="import-textarea" id="dressDetailCloth" readonly>
                        <button class="dress-copy" data-target="dressDetailCloth">复制</button>
                    </div>
                </div>
                
                <!-- 娱乐道具显示一个输入框 -->
                <div id="propCharacterOutput" style="display:none;">
                    <label style="color:#3898ff;font-size:14px;">道具代码</label>
                    <div class="dress-line">
                        <input class="import-textarea" id="dressDetailProp" readonly>
                        <button class="dress-copy" data-target="dressDetailProp">复制</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 游戏装扮主菜单 -->
        <div class="sidebar-content" id="dressMenu">
            <div class="sidebar-header">
                <button class="back-btn" data-target="gameCodeMenu" style="width: 40px; height: 40px; padding: 0; display: flex; align-items: center; justify-content: center;">← 返回</button>
                <h2 class="sidebar-title">角色装扮</h2>
            </div>

            <!-- 角色选择 -->
            <div class="dress-character-list">
                <div class="menu-item" data-character="xiaohuang">小黄</div>
                <div class="menu-item" data-character="ailisi">爱丽丝</div>
                <div class="menu-item" data-character="ling">零</div>
                <div class="menu-item" data-character="anian">阿念</div>
                <div class="menu-item" data-character="xiaoyao">逍遥</div>
                <div class="menu-item" data-character="weiweian">微微安</div>
                <div class="menu-item" data-character="wulinger">巫灵儿</div>
                <div class="menu-item" data-character="lili">莉莉</div>
                <div class="menu-item" data-character="ailun">艾伦</div>
                <div class="menu-item" data-character="aidewa">爱德华</div>
                <div class="menu-item" data-character="lan">兰</div>
            </div>
        </div>

        <!-- 丹药菜单 -->
        <div class="sidebar-content" id="danMenu">
            <div class="sidebar-header">
                <button class="back-btn" data-target="gameCodeMenu" style="width: 40px; height: 40px; padding: 0; display: flex; align-items: center; justify-content: center;">← 返回</button>
                <h2 class="sidebar-title">丹药</h2>
            </div>

            <!-- 模式切换器 -->
            <div style="margin-bottom: 15px; padding: 0 10px;">
                <label style="color:#3898ff;font-size:14px; display:block; margin-bottom:8px;">选择模式：</label>
                <div style="display: flex; gap: 10px;">
                    <button class="mode-switch-btn active" data-mode="out">局外代码</button>
                    <button class="mode-switch-btn" data-mode="in">局内代码</button>
                </div>
            </div>
            
            <div class="dress-character-list" id="danList">
                <!-- 丹药列表将通过JavaScript动态生成 -->
            </div>
        </div>

        <!-- 娱乐道具菜单 -->
        <div class="sidebar-content" id="propMenu">
            <div class="sidebar-header">
                <button class="back-btn" data-target="gameCodeMenu" style="width: 40px; height: 40px; padding: 0; display: flex; align-items: center; justify-content: center;">← 返回</button>
                <h2 class="sidebar-title">娱乐道具</h2>
            </div>

            <!-- 模式切换器 -->
            <div style="margin-bottom: 15px; padding: 0 10px;">
                <label style="color:#3898ff;font-size:14px; display:block; margin-bottom:8px;">选择模式：</label>
                <div style="display: flex; gap: 10px;">
                    <button class="mode-switch-btn active" data-mode="out">局外代码</button>
                    <button class="mode-switch-btn" data-mode="in">局内代码</button>
                </div>
            </div>
            
            <div class="dress-character-list" id="propList">
                <!-- 娱乐道具列表将通过JavaScript动态生成 -->
            </div>
        </div>
    </div>
    
    <!-- ========== 主内容区域 ========== -->
    <div class="container">
        <h1 id="pageTitle">渐变色个性签名生成器</h1>
        <div class="subtitle" id="pageSubtitle">仅用于《超自然行动组》游戏个性标签</div>
        
        <!-- 预览区域 -->
        <div class="preview-section" id="previewSection">
            <div class="preview-header">
                <div class="preview-title">预览效果：</div>
                <div class="preview-controls">
                    <button class="align-btn left-align-btn" id="leftAlignBtn" title="左对齐"></button>
                    <button class="align-btn center-align-btn" id="centerAlignBtn" title="居中对齐"></button>
                    <div class="dropdown-container">
                        <button class="dropdown-btn" id="backgroundStyleBtn">默认背景 ▼</button>
                        <div class="dropdown-panel" id="backgroundStylePanel">
                            <button class="dropdown-item" data-style="default">默认背景</button>
                            <button class="dropdown-item" data-style="style1">虚镜回廊</button>
                            <button class="dropdown-item" data-style="style2">樱落金笺</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="preview-content">
                <div id="previewOutput">等待生成...</div>
            </div>
        </div>
        
        <!-- 悬浮预览窗口 -->
        <div class="floating-preview" id="floatingPreview">
            <div class="floating-preview-header">
                <span class="floating-preview-title">预览效果</span>
                <div class="floating-preview-controls">
                    <button class="floating-preview-btn lock-btn" id="lockBtn" title="锁定大小">🔓</button>
                    <button class="floating-preview-btn reset-btn" id="resetSizeBtn" title="重置大小">↺</button>
                    <button class="floating-preview-btn minimize-btn" id="minimizeBtn" title="最小化">−</button>
                    <button class="floating-preview-btn close-btn" id="closeFloatingBtn" title="关闭">×</button>
                </div>
            </div>
            <div class="floating-preview-content" id="floatingPreviewContent">
                <div id="floatingPreviewOutput">等待生成...</div>
            </div>
            <div class="resize-handle" id="resizeHandle" title="拖动调整大小"></div>
        </div>
        
        <!-- 文案输入区域 -->
        <div class="input-group">
            <label for="textInput">输入个性签名文案：</label>
            <textarea id="textInput" rows="3" placeholder="请输入您的个性签名...">幸福飘忽不定，痛苦如影随形</textarea>
        </div>
        
        <!-- 模式切换按钮（仅在自定义范围模式下显示） -->
        <div class="mode-toggle-container" id="modeToggleContainer" style="display: none; margin-bottom: 20px;">
            <button class="mode-toggle-btn digital-mode" id="modeToggleBtn">切换到滑杆模式</button>
        </div>
        
        <!-- 渐变模式的字体设置行 -->
        <div class="font-settings-row" id="gradientFontSettings">
            <div class="font-size">
                <label for="fontSize">字体大小：</label>
                <div class="font-size-input-group">
                    <input type="number" id="fontSize" min="10" max="30" value="16" class="font-size-input">
                </div>
            </div>
            <div class="style-checkboxes">
                <div class="checkbox-group">
                    <input type="checkbox" id="boldCheckbox">
                    <label for="boldCheckbox" style="font-weight: bold;">粗体</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="italicCheckbox">
                    <label for="italicCheckbox" style="font-style: italic;">斜体</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="underlineCheckbox">
                    <label for="underlineCheckbox" style="text-decoration: underline;">下划线</label>
                </div>
            </div>
        </div>
        
        <!-- 渐变颜色数量选择器 -->
        <div class="gradient-color-count-selector" id="gradientColorCountSelector">
            <label>选择渐变颜色数量：</label>
            <div class="gradient-color-count-buttons">
                <button class="gradient-color-count-btn active" data-count="2">二色</button>
                <button class="gradient-color-count-btn" data-count="3">三色</button>
                <button class="gradient-color-count-btn" data-count="4">四色</button>
                <button class="gradient-color-count-btn" data-count="5">五色</button>
                <button class="gradient-color-count-btn" data-count="6">六色</button>
                <button class="gradient-color-count-btn" data-count="7">七色</button>
            </div>
        </div>
        
        <!-- 颜色输入区域 - 动态生成 -->
        <div id="colorInputsContainer">
            <div class="color-inputs">
                <div class="color-input">
                    <div class="color-label">
                        起始：
                        <div class="color-swatch-container">
                            <div class="color-swatch" id="color1Swatch" style="background-color: #2effa4;">
                                <input type="color" id="color1" value="#2effa4">
                            </div>
                            <div class="color-code-group">
                    <span class="color-code-prefix">#</span>
                    <input type="text" class="color-code-input" id="color1Code" value="2effa4" maxlength="6">
                </div>
                        </div>
                    </div>
                </div>
                
                <!-- 颜色互换按钮 -->
                <div class="swap-colors-container">
                    <button class="swap-colors-btn" id="swapColorsBtn" title="互换起始和末尾">⇆</button>
                </div>
                
                <div class="color-input">
                    <div class="color-label">
                        末尾：
                        <div class="color-swatch-container">
                            <div class="color-swatch" id="color2Swatch" style="background-color: #3898ff;">
                                <input type="color" id="color2" value="#3898ff">
                            </div>
                            <div class="color-code-group">
                    <span class="color-code-prefix">#</span>
                    <input type="text" class="color-code-input" id="color2Code" value="3898ff" maxlength="6">
                </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 颜色预览 -->
        <div class="color-preview" id="colorPreview"></div>
        
        <!-- 自定义范围模式内容（初始隐藏） -->
        <div id="customModeContent" style="display: none;">
            
            <!-- 数字模式 -->
            <div id="mode1" style="display: block;">
                <!-- 统一颜色设置容器 -->
                <div class="custom-gradient-section">
                    <div class="gradient-header">
                        <div class="checkbox-group">
                            <input type="checkbox" id="customColorCheckbox" checked>
                            <label for="customColorCheckbox">颜色设置</label>
                        </div>
                        <button class="toggle-gradient-btn" id="toggleColorBtn">▼</button>
                    </div>
                    <div class="gradient-reminder">
                        【游戏签名有可输入上限，请酌情考虑】
                    </div>
                    <div class="gradient-content" id="colorContent" style="display: block;">
                        <!-- 颜色数量选择器 -->
                        <!-- 颜色数量选择器 -->
                        <label>选择颜色数量：</label>
                        <div class="custom-color-count-buttons">
                            <button class="custom-color-count-btn" data-count="2">2色</button>
                            <button class="custom-color-count-btn active" data-count="3">3色</button>
                            <button class="custom-color-count-btn" data-count="4">4色</button>
                            <button class="custom-color-count-btn" data-count="5">5色</button>
                            <button class="custom-color-count-btn" data-count="6">6色</button>
                            <button class="custom-color-count-btn" data-count="7">7色</button>
                        </div>
                        
                        <!-- 颜色输入行 -->
                        <div class="custom-color-rows" id="customColorRows">
                            <!-- 颜色行将通过JavaScript动态生成 -->
                        </div>
                    </div>
                </div>
                
                <!-- 样式输入区域 -->
                <div class="custom-style-section">
                    <div class="style-header">
                        <div class="checkbox-group">
                            <label>样式功能</label>
                        </div>
                        <button class="toggle-style-btn" id="toggleStyleBtn">▼</button>
                    </div>
                    <div class="style-content" id="styleContent">
                        <!-- 粗体输入 -->
                        <div class="style-input-group">
                            <div class="checkbox-group">
                                <input type="checkbox" id="customBoldCheckbox">
                                <label for="customBoldCheckbox" style="font-weight: bold;">粗体</label>
                            </div>
                            <textarea class="style-range-input" id="customBoldInput" placeholder="例如：1-3,5-8" rows="2"></textarea>
                            <div class="input-hint">例如：1-3,5-8</div>
                        </div>
                        
                        <!-- 斜体输入 -->
                        <div class="style-input-group">
                            <div class="checkbox-group">
                                <input type="checkbox" id="customItalicCheckbox">
                                <label for="customItalicCheckbox" style="font-style: italic;">斜体</label>
                            </div>
                            <textarea class="style-range-input" id="customItalicInput" placeholder="例如：1-3,5-8" rows="2"></textarea>
                            <div class="input-hint">例如：1-3,5-8</div>
                        </div>
                        
                        <!-- 下划线输入 -->
                        <div class="style-input-group">
                            <div class="checkbox-group">
                                <input type="checkbox" id="customUnderlineCheckbox">
                                <label for="customUnderlineCheckbox" style="text-decoration: underline;">下划线</label>
                            </div>
                            <textarea class="style-range-input" id="customUnderlineInput" placeholder="例如：1-3,5-8" rows="2"></textarea>
                            <div class="input-hint">例如：1-3,5-8</div>
                        </div>
                    </div>
                </div>
                
                <!-- 渐变功能 -->
                <div class="custom-gradient-section">
                    <div class="gradient-header">
                        <div class="checkbox-group">
                            <input type="checkbox" id="customGradientCheckbox">
                            <label for="customGradientCheckbox">渐变功能</label>
                        </div>
                        <button class="toggle-gradient-btn" id="toggleGradientBtn">▲</button>
                    </div>
                    <div class="gradient-reminder">
                        【游戏签名有可输入上限，请酌情考虑】
                    </div>
                    <div class="gradient-content" id="gradientContent" style="display: none;">
                        <!-- 渐变数量选择器 -->
                        <div class="gradient-count-selector">
                            <label>选择渐变数量：</label>
                            <div class="gradient-count-buttons">
                                <button class="gradient-count-btn active" data-count="1">1渐变</button>
                                <button class="gradient-count-btn" data-count="2">2渐变</button>
                            </div>
                        </div>
                        
                        <!-- 渐变栏容器 -->
                        <div class="gradient-bars" id="gradientBars">
                            <!-- 渐变栏将通过JavaScript动态生成 -->
                        </div>
                    </div>
                </div>
                
                <!-- 全局字体设置 -->
                <div class="custom-global-settings">
                    <div class="font-settings-row">
                        <div class="style-checkboxes">
                            <div class="checkbox-group">
                                <input type="checkbox" id="customGlobalBoldCheckbox">
                                <label for="customGlobalBoldCheckbox" style="font-weight: bold;">全局粗体</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="customGlobalItalicCheckbox">
                                <label for="customGlobalItalicCheckbox" style="font-style: italic;">全局斜体</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="customGlobalUnderlineCheckbox">
                                <label for="customGlobalUnderlineCheckbox" style="text-decoration: underline;">全局下划线</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 滑杆模式 -->
            <div id="mode2" style="display: none;">
                <!-- 统一颜色设置容器 -->
                <div class="custom-gradient-section">
                    <div class="gradient-header">
                        <div class="checkbox-group">
                            <input type="checkbox" id="customColorCheckbox2" checked>
                            <label for="customColorCheckbox2">颜色设置</label>
                        </div>
                        <button class="toggle-gradient-btn" id="toggleColorBtn2">▼</button>
                    </div>
                    <div class="gradient-reminder">
                        【游戏签名有可输入上限，请酌情考虑】
                    </div>
                    <div class="gradient-content" id="colorContent2" style="display: block;">
                        <!-- 颜色数量选择器 -->
                        <!-- 颜色数量选择器 -->
                        <label>选择颜色数量：</label>
                        <div class="custom-color-count-buttons">
                            <button class="custom-color-count-btn" data-count="2">2色</button>
                            <button class="custom-color-count-btn active" data-count="3">3色</button>
                            <button class="custom-color-count-btn" data-count="4">4色</button>
                            <button class="custom-color-count-btn" data-count="5">5色</button>
                            <button class="custom-color-count-btn" data-count="6">6色</button>
                            <button class="custom-color-count-btn" data-count="7">7色</button>
                        </div>
                        
                        <!-- 颜色输入行 -->
                        <div class="custom-color-rows" id="customColorRows2">
                            <!-- 颜色行将通过JavaScript动态生成 -->
                        </div>
                    </div>
                </div>
                
                <!-- 样式输入区域 -->
                <div class="custom-style-section">
                    <div class="style-header">
                        <div class="checkbox-group">
                            <label>样式功能</label>
                        </div>
                        <button class="toggle-style-btn" id="toggleStyleBtn2">▼</button>
                    </div>
                    <div class="style-content" id="styleContent2">
                        <!-- 粗体输入 -->
                        <div class="style-input-group">
                            <div class="checkbox-group">
                                <input type="checkbox" id="customBoldCheckbox2">
                                <label for="customBoldCheckbox2" style="font-weight: bold;">粗体</label>
                            </div>
                            <div class="slider-range-container" id="boldSlider2"></div>
                            <div class="input-hint">例如：1-3,5-8</div>
                        </div>
                        
                        <!-- 斜体输入 -->
                        <div class="style-input-group">
                            <div class="checkbox-group">
                                <input type="checkbox" id="customItalicCheckbox2">
                                <label for="customItalicCheckbox2" style="font-style: italic;">斜体</label>
                            </div>
                            <div class="slider-range-container" id="italicSlider2"></div>
                            <div class="input-hint">例如：1-3,5-8</div>
                        </div>
                        
                        <!-- 下划线输入 -->
                        <div class="style-input-group">
                            <div class="checkbox-group">
                                <input type="checkbox" id="customUnderlineCheckbox2">
                                <label for="customUnderlineCheckbox2" style="text-decoration: underline;">下划线</label>
                            </div>
                            <div class="slider-range-container" id="underlineSlider2"></div>
                            <div class="input-hint">例如：1-3,5-8</div>
                        </div>
                    </div>
                </div>
                
                <!-- 渐变功能 -->
                <div class="custom-gradient-section">
                    <div class="gradient-header">
                        <div class="checkbox-group">
                            <input type="checkbox" id="customGradientCheckbox2">
                            <label for="customGradientCheckbox2">渐变功能</label>
                        </div>
                        <button class="toggle-gradient-btn" id="toggleGradientBtn2">▲</button>
                    </div>
                    <div class="gradient-reminder">
                        【游戏签名有可输入上限，请酌情考虑】
                    </div>
                    <div class="gradient-content" id="gradientContent2" style="display: none;">
                        <!-- 渐变数量选择器 -->
                        <div class="gradient-count-selector">
                            <label>选择渐变数量：</label>
                            <div class="gradient-count-buttons">
                                <button class="gradient-count-btn active" data-count="1">1渐变</button>
                                <button class="gradient-count-btn" data-count="2">2渐变</button>
                            </div>
                        </div>
                        
                        <!-- 渐变栏容器 -->
                        <div class="gradient-bars" id="gradientBars2">
                            <!-- 渐变栏将通过JavaScript动态生成 -->
                        </div>
                    </div>
                </div>
                
                <!-- 全局字体设置 -->
                <div class="custom-global-settings">
                    <div class="font-settings-row">
                        <div class="style-checkboxes">
                            <div class="checkbox-group">
                                <input type="checkbox" id="customGlobalBoldCheckbox2">
                                <label for="customGlobalBoldCheckbox2" style="font-weight: bold;">全局粗体</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="customGlobalItalicCheckbox2">
                                <label for="customGlobalItalicCheckbox2" style="font-style: italic;">全局斜体</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="customGlobalUnderlineCheckbox2">
                                <label for="customGlobalUnderlineCheckbox2" style="text-decoration: underline;">全局下划线</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
        </div>
        
        <!-- 随机配色模式选择器 -->
        <div class="random-mode-selector">
            <label for="randomMode">随机配色模式：</label>
            <select id="randomMode">
                <option value="random">随机配色</option>
                <option value="analogous">随机相邻色</option>
                <option value="light">随机浅色</option>
                <option value="saturated">随机高饱和</option>
            </select>
        </div>
        
        <!-- 主要功能按钮 -->
        <div class="button-group">
            <button id="generateBtn">生成颜色代码</button>
            <button id="randomBtn">随机配色</button>
        </div>
        
        <!-- 代码输出区域 -->
        <div class="output">
            <div class="output-header">
                <div class="output-title">生成代码：<span id="codeCharCount">0</span> 字符 <span id="codeStatus" class="code-status"></span></div>
                <div class="output-buttons">
                    <button class="favorite-btn" id="favoriteBtn">☆ 收藏</button>
                    <button class="copy-btn" id="copyBtn">复制</button>
                    <button class="toggle-code-btn" id="toggleCodeBtn">▼</button>
                </div>
            </div>
            <div class="code-block hidden" id="codeOutput">等待生成...</div>
        </div>
        
        <!-- 示例颜色预览 - 只在首页显示 -->
        <div class="examples" id="examplesSection">
            <div class="examples-header">
                <div class="examples-title">示例颜色预览：</div>
                <div class="examples-style-checkboxes">
                    <div class="checkbox-group">
                        <input type="checkbox" id="examplesBoldCheckbox">
                        <label for="examplesBoldCheckbox" style="font-weight: bold;">粗体</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="examplesItalicCheckbox">
                        <label for="examplesItalicCheckbox" style="font-style: italic;">斜体</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="examplesUnderlineCheckbox">
                        <label for="examplesUnderlineCheckbox" style="text-decoration: underline;">下划线</label>
                    </div>
                </div>
            </div>
            
            <!-- 示例1 -->
            <div class="example-item" id="example1">
                <div class="example-preview" id="example1Preview"></div>
                <div class="example-controls">
                    <input type="text" class="example-text-input" id="example1Text" value="做一场不愿醒来的五彩斑斓的梦">
                    <div class="example-buttons">
                        <button class="example-btn" data-example="1">复制代码</button>
                        <button class="toggle-example-code-btn" data-example="1">▼</button>
                    </div>
                </div>
                <div class="example-code hidden" id="example1Code"></div>
            </div>
            
            <!-- 示例2 -->
            <div class="example-item" id="example2">
                <div class="example-preview" id="example2Preview"></div>
                <div class="example-controls">
                    <input type="text" class="example-text-input" id="example2Text" value="我啊，当然永远明媚啦">
                    <div class="example-buttons">
                        <button class="example-btn" data-example="2">复制代码</button>
                        <button class="toggle-example-code-btn" data-example="2">▼</button>
                    </div>
                </div>
                <div class="example-code hidden" id="example2Code"></div>
            </div>
            
            <!-- 示例3 -->
            <div class="example-item" id="example3">
                <div class="example-preview" id="example3Preview"></div>
                <div class="example-controls">
                    <div class="example-color-pickers" id="example3ColorPickers">
                        <!-- 颜色色块将通过JavaScript动态生成 -->
                    </div>
                    <div class="example-buttons">
                        <button class="example-btn" data-example="3">复制代码</button>
                        <button class="toggle-example-code-btn" data-example="3">▼</button>
                    </div>
                </div>
                <div class="example-code hidden" id="example3Code"></div>
            </div>
        </div>
        
        <!-- 页脚 -->
        <div class="footer">
            <p>作者：mobinsll</p>
            <p>公益工具</p>
        </div>
    </div>

    <!-- ========== JavaScript代码开始 ========== -->
    <script>
        // ========== 初始化函数开始 ==========
        document.addEventListener('DOMContentLoaded', function() {
            // ========== 全局变量声明 ==========
            let currentCharacter = '';
            let currentMode = 'home';
            let isCustomMode = false;
            let shouldShowGenerateNotification = false;
            let customColorCount = 3; // 默认3色，根据图片中的示例
            let customColorRowsData = [
                { range: '3-5,10-12', color: '#BDBDBD', fontSize: 14, enabled: true },
                { range: '1-2,8-9', color: '#C20000', fontSize: 18, enabled: true },
                { range: '6,13', color: '#C20000', fontSize: 20, enabled: true }
            ];
            let customGradientCount = 1; // 默认1渐变
            let customGradientData = [
                { range: '1-7', startColor: '#2effa4', endColor: '#3898ff' },
                { range: '8-14', startColor: '#ff6b6b', endColor: '#4ecdc4' }
            ];
            let gradientColorCount = 2; // 默认二色
            let lastGeneratedCode = ''; // 上次生成的代码
            let lastGeneratedMode = ''; // 上次生成代码时的模式
            let currentParamsHash = ''; // 当前参数的哈希值
            
            // 持久化颜色存储
            const persistentColors = {};
            

            
            // ========== DOM元素获取 ==========
            const textInput = document.getElementById('textInput');
            const fontSizeInput = document.getElementById('fontSize');
            const boldCheckbox = document.getElementById('boldCheckbox');
            const italicCheckbox = document.getElementById('italicCheckbox');
            const underlineCheckbox = document.getElementById('underlineCheckbox');
            const colorPreview = document.getElementById('colorPreview');
            const generateBtn = document.getElementById('generateBtn');
            const customGradientCheckbox = document.getElementById('customGradientCheckbox');
            const toggleGradientBtn = document.getElementById('toggleGradientBtn');
            const gradientContent = document.getElementById('gradientContent');
            const gradientBars = document.getElementById('gradientBars');
            const randomBtn = document.getElementById('randomBtn');
            const gradientColorCountButtons = document.querySelectorAll('.gradient-color-count-btn');
            const gradientColorCountSelector = document.getElementById('gradientColorCountSelector');
            const randomModeSelect = document.getElementById('randomMode');
            const codeOutput = document.getElementById('codeOutput');
            const copyBtn = document.getElementById('copyBtn');
            const favoriteBtn = document.getElementById('favoriteBtn');
            const previewOutput = document.getElementById('previewOutput');
            const notification = document.getElementById('notification');
            const shareBtn = document.getElementById('shareBtn');
            
            // 悬浮预览窗口元素
            const previewSection = document.getElementById('previewSection');
            const floatingPreview = document.getElementById('floatingPreview');
            const floatingPreviewOutput = document.getElementById('floatingPreviewOutput');
            const minimizeBtn = document.getElementById('minimizeBtn');
            const closeFloatingBtn = document.getElementById('closeFloatingBtn');
            const floatingPreviewHeader = document.querySelector('.floating-preview-header');
            const lockBtn = document.getElementById('lockBtn');
            const resetSizeBtn = document.getElementById('resetSizeBtn');
            const resizeHandle = document.getElementById('resizeHandle');
            
            const menuBtn = document.getElementById('menuBtn');
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            const historyList = document.getElementById('historyList');
            const favoritesList = document.getElementById('favoritesList');
            const clearHistoryBtn = document.getElementById('clearHistoryBtn');
            const clearFavoritesBtn = document.getElementById('clearFavoritesBtn');
            const importTextarea = document.getElementById('importTextarea');
            const importBtn = document.getElementById('importBtn');
            
            const menuItems = document.querySelectorAll('.menu-item');
            const backBtns = document.querySelectorAll('.back-btn');
            const sidebarContents = document.querySelectorAll('.sidebar-content');
            
            const examplesBoldCheckbox = document.getElementById('examplesBoldCheckbox');
            const examplesItalicCheckbox = document.getElementById('examplesItalicCheckbox');
            const examplesUnderlineCheckbox = document.getElementById('examplesUnderlineCheckbox');
            
            const moreColorsBtn = document.getElementById('moreColorsBtn');
            const moreColorsPanel = document.getElementById('moreColorsPanel');
            const moreColorsPanelBtns = document.querySelectorAll('.more-colors-panel-btn');
            
            const pageTitle = document.getElementById('pageTitle');
            const pageSubtitle = document.getElementById('pageSubtitle');
            const examplesSection = document.getElementById('examplesSection');
            const colorInputsContainer = document.getElementById('colorInputsContainer');
            const gradientFontSettings = document.getElementById('gradientFontSettings');
            
            const customModeContent = document.getElementById('customModeContent');
            const customColorCountButtons = document.querySelectorAll('.custom-color-count-btn');
            const customColorRows = document.getElementById('customColorRows');
            const customBoldCheckbox = document.getElementById('customBoldCheckbox');
            const customItalicCheckbox = document.getElementById('customItalicCheckbox');
            const customUnderlineCheckbox = document.getElementById('customUnderlineCheckbox');
            const customBoldInput = document.getElementById('customBoldInput');
            const customItalicInput = document.getElementById('customItalicInput');
            const customUnderlineInput = document.getElementById('customUnderlineInput');
            const customGlobalBoldCheckbox = document.getElementById('customGlobalBoldCheckbox');
            const customGlobalItalicCheckbox = document.getElementById('customGlobalItalicCheckbox');
            const customGlobalUnderlineCheckbox = document.getElementById('customGlobalUnderlineCheckbox');
            
            // 导入模式选择器元素
            const importModeButtons = document.querySelectorAll('.import-mode-btn');
            
            // ========== 悬浮预览窗口功能 ==========
            let isFloatingVisible = false;
            let isMinimized = false;
            let isDragging = false;
            let dragOffsetX = 0;
            let dragOffsetY = 0;
            
            // 滚动监听，检测预览区域是否被遮挡
            window.addEventListener('scroll', function() {
                checkPreviewVisibility();
            }, { passive: true });
            
            // 检查预览区域是否被遮挡
            function checkPreviewVisibility() {
                if (!previewSection || !floatingPreview) return;
                
                const rect = previewSection.getBoundingClientRect();
                const windowHeight = window.innerHeight;
                const windowWidth = window.innerWidth;
                
                // 判断是否为小屏幕
                const isSmallScreen = windowWidth <= 768;
                
                // 如果预览区域完全超出屏幕（顶部或底部）
                if (rect.bottom < 0 || rect.top > windowHeight) {
                    if (!isFloatingVisible) {
                        showFloatingPreview();
                    }
                } else if (isSmallScreen) {
                    // 小屏幕下，如果预览区域被部分遮挡（超过50%）
                    const visibleHeight = Math.min(rect.bottom, windowHeight) - Math.max(rect.top, 0);
                    const totalHeight = rect.height;
                    const visibleRatio = visibleHeight / totalHeight;
                    
                    if (visibleRatio < 0.5) {
                        if (!isFloatingVisible) {
                            showFloatingPreview();
                        }
                    } else {
                        if (isFloatingVisible) {
                            hideFloatingPreview();
                        }
                    }
                } else {
                    // 大屏幕下，如果预览区域完全可见，隐藏悬浮窗口
                    if (isFloatingVisible) {
                        hideFloatingPreview();
                    }
                }
            }
            
            // 悬浮预览窗口关闭状态
            let floatingPreviewClosed = false;
            
            // 在页面加载时自动清除关闭状态，确保页面刷新后能够恢复默认显示状态
            try {
                sessionStorage.removeItem('floatingPreviewClosed');
            } catch (e) {
                // 处理存储权限被禁用等异常情况
                console.warn('无法清除sessionStorage:', e);
            }
            
            // 显示悬浮预览窗口
            function showFloatingPreview() {
                if (!floatingPreview || floatingPreviewClosed) return;
                
                // 恢复初始位置和状态
                floatingPreview.style.width = DEFAULT_WIDTH + 'px';
                floatingPreview.style.height = 'auto';
                floatingPreview.style.top = '20px';
                floatingPreview.style.left = '50%';
                floatingPreview.style.transform = 'translateX(-50%)';
                floatingPreview.style.right = '';
                floatingPreview.style.bottom = '';
                
                // 恢复未最小化状态
                if (floatingPreview.classList.contains('minimized')) {
                    floatingPreview.classList.remove('minimized');
                    isMinimized = false;
                    if (minimizeBtn) {
                        minimizeBtn.textContent = '−';
                        minimizeBtn.title = '最小化';
                    }
                }
                
                // 恢复未锁定状态
                if (floatingPreview.classList.contains('locked')) {
                    floatingPreview.classList.remove('locked');
                    isLocked = false;
                    if (lockBtn) {
                        lockBtn.textContent = '🔓';
                        lockBtn.title = '锁定大小';
                    }
                }
                
                isFloatingVisible = true;
                floatingPreview.classList.add('visible');
                
                // 同步预览内容
                floatingPreviewOutput.innerHTML = previewOutput.innerHTML;
            }
            
            // 隐藏悬浮预览窗口
            function hideFloatingPreview() {
                if (!floatingPreview) return;
                
                isFloatingVisible = false;
                floatingPreview.classList.remove('visible');
            }
            
            // 彻底关闭悬浮预览窗口
            function closeFloatingPreview() {
                if (!floatingPreview) return;
                
                floatingPreviewClosed = true;
                isFloatingVisible = false;
                floatingPreview.classList.remove('visible');
                
                // 保存关闭状态到sessionStorage（在当前会话中有效）
                try {
                    sessionStorage.setItem('floatingPreviewClosed', 'true');
                } catch (e) {
                    // 处理存储权限被禁用等异常情况
                    console.warn('无法保存到sessionStorage:', e);
                }
            }
            
            // 最小化/恢复悬浮预览窗口
            minimizeBtn.addEventListener('click', function() {
                if (isMinimized) {
                    floatingPreview.classList.remove('minimized');
                    minimizeBtn.textContent = '−';
                    minimizeBtn.title = '最小化';
                } else {
                    floatingPreview.classList.add('minimized');
                    minimizeBtn.textContent = '+';
                    minimizeBtn.title = '恢复';
                }
                isMinimized = !isMinimized;
            });
            
            // 关闭悬浮预览窗口
            closeFloatingBtn.addEventListener('click', function() {
                closeFloatingPreview();
            });
            
            // 悬浮预览窗口拖拽功能
            floatingPreviewHeader.addEventListener('mousedown', function(e) {
                if (e.target.classList.contains('floating-preview-btn')) return;
                
                isDragging = true;
                const rect = floatingPreview.getBoundingClientRect();
                dragOffsetX = e.clientX - rect.left;
                dragOffsetY = e.clientY - rect.top;
                
                document.addEventListener('mousemove', handleDrag);
                document.addEventListener('mouseup', stopDrag);
            });
            
            // 触摸设备支持
            floatingPreviewHeader.addEventListener('touchstart', function(e) {
                if (e.target.classList.contains('floating-preview-btn')) return;
                
                isDragging = true;
                const rect = floatingPreview.getBoundingClientRect();
                const touch = e.touches[0];
                dragOffsetX = touch.clientX - rect.left;
                dragOffsetY = touch.clientY - rect.top;
                
                document.addEventListener('touchmove', handleTouchDrag, { passive: false });
                document.addEventListener('touchend', stopTouchDrag);
            });
            
            function handleDrag(e) {
                if (!isDragging) return;
                
                const x = e.clientX - dragOffsetX;
                const y = e.clientY - dragOffsetY;
                
                // 限制悬浮窗口在屏幕内
                const maxX = window.innerWidth - floatingPreview.offsetWidth;
                const maxY = window.innerHeight - floatingPreview.offsetHeight;
                
                const newX = Math.max(0, Math.min(x, maxX));
                const newY = Math.max(0, Math.min(y, maxY));
                
                floatingPreview.style.left = newX + 'px';
                floatingPreview.style.top = newY + 'px';
                floatingPreview.style.right = 'auto';
                floatingPreview.style.bottom = 'auto';
                floatingPreview.style.transform = 'none';
            }
            
            function handleTouchDrag(e) {
                if (!isDragging) return;
                e.preventDefault();
                
                const touch = e.touches[0];
                const x = touch.clientX - dragOffsetX;
                const y = touch.clientY - dragOffsetY;
                
                // 限制悬浮窗口在屏幕内
                const maxX = window.innerWidth - floatingPreview.offsetWidth;
                const maxY = window.innerHeight - floatingPreview.offsetHeight;
                
                const newX = Math.max(0, Math.min(x, maxX));
                const newY = Math.max(0, Math.min(y, maxY));
                
                floatingPreview.style.left = newX + 'px';
                floatingPreview.style.top = newY + 'px';
                floatingPreview.style.right = 'auto';
                floatingPreview.style.bottom = 'auto';
                floatingPreview.style.transform = 'none';
            }
            
            function stopDrag() {
                isDragging = false;
                document.removeEventListener('mousemove', handleDrag);
                document.removeEventListener('mouseup', stopDrag);
            }
            
            function stopTouchDrag() {
                isDragging = false;
                document.removeEventListener('touchmove', handleTouchDrag);
                document.removeEventListener('touchend', stopTouchDrag);
            }
            
            // 悬浮预览窗口调整大小功能
            let isResizing = false;
            let resizeStartX, resizeStartY, resizeStartWidth, resizeStartHeight;
            const DEFAULT_WIDTH = 300;
            const DEFAULT_HEIGHT = 100;
            let isLocked = false;
            
            resizeHandle.addEventListener('mousedown', function(e) {
                if (isLocked) return;
                
                isResizing = true;
                resizeStartX = e.clientX;
                resizeStartY = e.clientY;
                resizeStartWidth = floatingPreview.offsetWidth;
                resizeStartHeight = floatingPreview.offsetHeight;
                
                document.addEventListener('mousemove', handleResize);
                document.addEventListener('mouseup', stopResize);
                e.preventDefault();
            });
            
            function handleResize(e) {
                if (!isResizing) return;
                
                const deltaX = e.clientX - resizeStartX;
                const deltaY = e.clientY - resizeStartY;
                
                const newWidth = Math.max(200, resizeStartWidth + deltaX);
                const newHeight = Math.max(60, resizeStartHeight + deltaY);
                
                floatingPreview.style.width = newWidth + 'px';
                floatingPreview.style.height = 'auto';
                // 不修改transform和right/bottom，保持当前位置
            }
            
            function stopResize() {
                isResizing = false;
                document.removeEventListener('mousemove', handleResize);
                document.removeEventListener('mouseup', stopResize);
            }
            
            // 锁定/解锁按钮功能
            lockBtn.addEventListener('click', function() {
                isLocked = !isLocked;
                
                if (isLocked) {
                    floatingPreview.classList.add('locked');
                    lockBtn.textContent = '🔒';
                    lockBtn.title = '解锁大小';
                } else {
                    floatingPreview.classList.remove('locked');
                    lockBtn.textContent = '🔓';
                    lockBtn.title = '锁定大小';
                }
            });
            
            // 重置大小按钮功能
            resetSizeBtn.addEventListener('click', function() {
                floatingPreview.style.width = DEFAULT_WIDTH + 'px';
                floatingPreview.style.height = 'auto';
                // 不修改transform和right/bottom，保持当前位置
            });
            
            // ========== 滑动范围选择器类 ==========
            class SliderRangeSelector {
                constructor(containerId, options = {}) {
                    this.container = document.getElementById(containerId);
                    if (!this.container) {
                        console.error(`Container with id ${containerId} not found`);
                        return;
                    }
                    
                    this.options = {
                        maxValue: options.maxValue || 20,
                        minValue: options.minValue || 1,
                        initialRanges: options.initialRanges || [],
                        onRangeChange: options.onRangeChange || (() => {}),
                        textElement: options.textElement || null,
                        enableCharWidthMode: options.enableCharWidthMode || false,
                        ...options
                    };
                    
                    this.ranges = [];
                    this.handles = [];
                    this.segments = [];
                    this.draggingHandle = null;
                    this.dragOffset = 0;
                    this.charPositions = [];
                    this.charWidths = [];
                    
                    this.init();
                }
                
                init() {
                    this.container.innerHTML = '';
                    
                    const header = document.createElement('div');
                    header.className = 'slider-range-header';
                    header.innerHTML = `
                        <span class="slider-range-title">范围选择</span>
                        <div class="slider-range-controls">
                            <button class="slider-range-btn" id="addRangeBtn_${this.container.id}">+</button>
                            <button class="slider-range-btn" id="removeRangeBtn_${this.container.id}">-</button>
                        </div>
                    `;
                    this.container.appendChild(header);
                    
                    const trackContainer = document.createElement('div');
                    trackContainer.className = 'slider-range-track-container';
                    trackContainer.innerHTML = `
                        <div class="slider-range-track"></div>
                        <div class="slider-range-scale" id="scale_${this.container.id}"></div>
                    `;
                    this.container.appendChild(trackContainer);
                    
                    this.track = trackContainer.querySelector('.slider-range-track');
                    this.scale = trackContainer.querySelector('.slider-range-scale');
                    
                    if (this.options.enableCharWidthMode && this.options.textElement) {
                        this.calculateCharPositions();
                    }
                    
                    this.renderScale();
                    
                    if (this.options.initialRanges.length > 0) {
                        this.options.initialRanges.forEach(range => {
                            this.addRange(range.start, range.end);
                        });
                    } else {
                        this.addRange(1, 2);
                    }
                    
                    this.bindEvents();
                }
                
                calculateCharPositions() {
                    if (!this.options.textElement) return;
                    
                    const text = this.options.textElement.value || '';
                    const previewOutput = document.getElementById('previewOutput');
                    if (!previewOutput) return;
                    
                    this.charPositions = [];
                    this.charWidths = [];
                    
                    const tempSpan = document.createElement('span');
                    tempSpan.style.visibility = 'hidden';
                    tempSpan.style.position = 'absolute';
                    tempSpan.style.whiteSpace = 'pre';
                    
                    const computedStyle = window.getComputedStyle(previewOutput);
                    tempSpan.style.fontFamily = computedStyle.fontFamily;
                    tempSpan.style.fontSize = computedStyle.fontSize;
                    tempSpan.style.fontWeight = computedStyle.fontWeight;
                    tempSpan.style.fontStyle = computedStyle.fontStyle;
                    
                    document.body.appendChild(tempSpan);
                    
                    let currentPosition = 0;
                    for (let i = 0; i < text.length; i++) {
                        tempSpan.textContent = text[i];
                        const charWidth = tempSpan.getBoundingClientRect().width;
                        this.charWidths.push(charWidth);
                        this.charPositions.push(currentPosition);
                        currentPosition += charWidth;
                    }
                    
                    this.charPositions.push(currentPosition);
                    
                    document.body.removeChild(tempSpan);
                    
                    const totalWidth = currentPosition;
                    if (totalWidth > 0) {
                        const newMaxValue = text.length;
                        this.options.maxValue = newMaxValue;
                        this.options.minValue = 1;
                    } else {
                        this.options.maxValue = 1;
                        this.options.minValue = 1;
                    }
                }
                
                updateCharPositions() {
                    if (this.options.enableCharWidthMode && this.options.textElement) {
                        const oldMaxValue = this.options.maxValue;
                        const text = this.options.textElement.value || '';
                        
                        if (!text) {
                            this.charPositions = [0];
                            this.charWidths = [];
                            this.options.maxValue = 1;
                            this.options.minValue = 1;
                            this.renderScale();
                            return;
                        }
                        
                        this.calculateCharPositions();
                        this.renderScale();
                        
                        if (oldMaxValue !== this.options.maxValue) {
                            this.ranges.forEach((range, index) => {
                                if (range.start > this.options.maxValue) {
                                    range.start = this.options.maxValue;
                                }
                                if (range.end > this.options.maxValue) {
                                    range.end = this.options.maxValue;
                                }
                                if (range.start > range.end) {
                                    range.start = range.end;
                                }
                                this.updateRangeVisuals(index);
                            });
                            this.updateAddRemoveButtons();
                        } else {
                            this.ranges.forEach((range, index) => {
                                this.updateRangeVisuals(index);
                            });
                        }
                    }
                }
                
                renderScale() {
                    this.scale.innerHTML = '';
                    
                    if (this.options.enableCharWidthMode && this.charPositions.length > 0) {
                        const totalWidth = this.charPositions[this.charPositions.length - 1];
                        const totalChars = this.charPositions.length - 1;
                        
                        if (totalChars <= 0 || totalWidth <= 0) {
                            return;
                        }
                        
                        try {
                            const tickIndices = this.calculateTickIndicesForRuler(totalChars);
                            
                            tickIndices.forEach(index => {
                                if (index < 0 || index > totalChars) {
                                    return;
                                }
                                
                                const scaleItem = document.createElement('div');
                                scaleItem.className = 'slider-range-scale-item char-boundary';
                                
                                const isMajorTick = index === 0 || index === totalChars;
                                const isMiddleTick = index === Math.floor(totalChars / 2);
                                
                                if (isMajorTick || isMiddleTick) {
                                    scaleItem.classList.add('major');
                                    scaleItem.classList.add('with-number');
                                    scaleItem.setAttribute('data-value', index + 1);
                                }
                                
                                const position = (this.charPositions[index] / totalWidth) * 100;
                                if (!isNaN(position) && position >= 0 && position <= 100) {
                                    scaleItem.style.left = `${position}%`;
                                    this.scale.appendChild(scaleItem);
                                }
                            });
                        } catch (error) {
                            console.error('Error rendering scale:', error);
                        }
                    } else {
                        const totalRange = this.options.maxValue - this.options.minValue;
                        
                        if (totalRange <= 0) {
                            return;
                        }
                        
                        try {
                            const optimalTicks = Math.min(10, Math.max(5, totalRange / 2));
                            const step = Math.ceil(totalRange / optimalTicks);
                            
                            for (let i = this.options.minValue; i <= this.options.maxValue; i += step) {
                                const scaleItem = document.createElement('div');
                                scaleItem.className = 'slider-range-scale-item';
                                
                                const isMajorTick = i % (step * 2) === 0 || i === this.options.minValue || i === this.options.maxValue;
                                if (isMajorTick) {
                                    scaleItem.classList.add('major');
                                    scaleItem.setAttribute('data-value', i);
                                }
                                
                                const position = ((i - this.options.minValue) / totalRange) * 100;
                                if (!isNaN(position) && position >= 0 && position <= 100) {
                                    scaleItem.style.left = `${position}%`;
                                    this.scale.appendChild(scaleItem);
                                }
                            }
                        } catch (error) {
                            console.error('Error rendering scale:', error);
                        }
                    }
                }
                
                calculateTickIndicesForRuler(totalChars) {
                    const indices = [];
                    
                    if (totalChars <= 0) {
                        return indices;
                    }
                    
                    let step;
                    if (totalChars <= 10) {
                        step = 1;
                    } else if (totalChars <= 20) {
                        step = 2;
                    } else if (totalChars <= 50) {
                        step = 3;
                    } else if (totalChars <= 100) {
                        step = 5;
                    } else {
                        step = Math.max(5, Math.floor(totalChars / 20));
                    }
                    
                    for (let i = 0; i <= totalChars; i += step) {
                        indices.push(i);
                    }
                    
                    if (indices[indices.length - 1] !== totalChars) {
                        indices.push(totalChars);
                    }
                    
                    return indices;
                }
                
                findEmptySlot() {
                    if (this.ranges.length === 0) {
                        return { start: this.options.minValue, end: Math.min(this.options.minValue + 1, this.options.maxValue) };
                    }
                    
                    const coveredChars = new Set();
                    this.ranges.forEach(range => {
                        for (let i = range.start; i <= range.end; i++) {
                            coveredChars.add(i);
                        }
                    });
                    
                    for (let i = this.options.minValue; i <= this.options.maxValue; i++) {
                        if (!coveredChars.has(i)) {
                            let end = Math.min(i + 1, this.options.maxValue);
                            return { start: i, end: end };
                        }
                    }
                    
                    return null;
                }
                
                addRange(start, end) {
                    const rangeId = this.ranges.length;
                    
                    if (this.options.enableCharWidthMode) {
                        start = Math.max(this.options.minValue, Math.min(start, this.options.maxValue));
                        end = Math.max(this.options.minValue, Math.min(end, this.options.maxValue));
                    }
                    
                    this.ranges.push({ start, end, id: rangeId });
                    
                    const segment = document.createElement('div');
                    segment.className = 'slider-range-segment';
                    segment.id = `segment_${this.container.id}_${rangeId}`;
                    this.track.appendChild(segment);
                    this.segments.push(segment);
                    
                    const leftHandle = document.createElement('div');
                    leftHandle.className = 'slider-range-handle';
                    leftHandle.id = `handle_${this.container.id}_${rangeId}_left`;
                    leftHandle.dataset.rangeId = rangeId;
                    leftHandle.dataset.position = 'left';
                    this.track.appendChild(leftHandle);
                    this.handles.push(leftHandle);
                    
                    // 为新创建的左侧 handle 绑定拖动事件
                    leftHandle.addEventListener('mousedown', (e) => this.handleMouseDown(e, leftHandle));
                    leftHandle.addEventListener('touchstart', (e) => this.handleTouchStart(e, leftHandle));
                    
                    const rightHandle = document.createElement('div');
                    rightHandle.className = 'slider-range-handle';
                    rightHandle.id = `handle_${this.container.id}_${rangeId}_right`;
                    rightHandle.dataset.rangeId = rangeId;
                    rightHandle.dataset.position = 'right';
                    this.track.appendChild(rightHandle);
                    this.handles.push(rightHandle);
                    
                    // 为新创建的右侧 handle 绑定拖动事件
                    rightHandle.addEventListener('mousedown', (e) => this.handleMouseDown(e, rightHandle));
                    rightHandle.addEventListener('touchstart', (e) => this.handleTouchStart(e, rightHandle));
                    
                    this.updateRangeVisuals(rangeId);
                    this.updateAddRemoveButtons();
                }
                
                removeRange() {
                    if (this.ranges.length === 0) return;
                    
                    const lastRangeId = this.ranges.length - 1;
                    
                    const segment = document.getElementById(`segment_${this.container.id}_${lastRangeId}`);
                    const leftHandle = document.getElementById(`handle_${this.container.id}_${lastRangeId}_left`);
                    const rightHandle = document.getElementById(`handle_${this.container.id}_${lastRangeId}_right`);
                    
                    if (segment) segment.remove();
                    if (leftHandle) leftHandle.remove();
                    if (rightHandle) rightHandle.remove();
                    
                    this.ranges.pop();
                    this.segments.pop();
                    this.handles.pop();
                    this.handles.pop();
                    
                    this.updateAddRemoveButtons();
                    this.options.onRangeChange(this.getRangeString());
                }
                
                updateRangeVisuals(rangeId) {
                    if (!this.ranges[rangeId]) return;
                    
                    const range = this.ranges[rangeId];
                    const segment = this.segments[rangeId];
                    const leftHandle = this.handles[rangeId * 2];
                    const rightHandle = this.handles[rangeId * 2 + 1];
                    
                    let leftPercent, rightPercent;
                    
                    if (this.options.enableCharWidthMode && this.charPositions.length > 0) {
                        const totalWidth = this.charPositions[this.charPositions.length - 1];
                        
                        if (totalWidth <= 0) {
                            return;
                        }
                        
                        const startIdx = Math.max(0, Math.min(range.start - 1, this.charPositions.length - 1));
                        const endIdx = Math.max(0, Math.min(range.end, this.charPositions.length - 1));
                        
                        leftPercent = (this.charPositions[startIdx] / totalWidth) * 100;
                        rightPercent = (this.charPositions[endIdx] / totalWidth) * 100;
                    } else {
                        const totalRange = this.options.maxValue - this.options.minValue;
                        
                        if (totalRange <= 0) {
                            return;
                        }
                        
                        leftPercent = ((range.start - 0.5 - this.options.minValue) / totalRange) * 100;
                        rightPercent = ((range.end + 0.5 - this.options.minValue) / totalRange) * 100;
                    }
                    
                    if (!isNaN(leftPercent) && !isNaN(rightPercent)) {
                        leftPercent = Math.max(0, Math.min(100, leftPercent));
                        rightPercent = Math.max(0, Math.min(100, rightPercent));
                        
                        if (segment) {
                            segment.style.left = `${leftPercent}%`;
                            segment.style.width = `${Math.max(0, rightPercent - leftPercent)}%`;
                        }
                        
                        if (leftHandle) {
                            leftHandle.style.left = `${leftPercent}%`;
                        }
                        
                        if (rightHandle) {
                            rightHandle.style.left = `${rightPercent}%`;
                        }
                    }
                }
                
                renderValueInputs() {
                    const valuesContainer = document.getElementById(`values_${this.container.id}`);
                    valuesContainer.innerHTML = '';
                    
                    this.ranges.forEach((range, index) => {
                        const valueItem = document.createElement('div');
                        valueItem.className = 'slider-range-value-item';
                        valueItem.innerHTML = `
                            <span class="slider-range-value-label">范围${index + 1}:</span>
                            <input type="text" class="slider-range-value-input" 
                                   id="input_${this.container.id}_${index}" 
                                   value="${range.start}-${range.end}"
                                   placeholder="例如：1-3">
                        `;
                        valuesContainer.appendChild(valueItem);
                        
                        const input = valueItem.querySelector('input');
                        input.addEventListener('input', (e) => this.handleInputChange(index, e.target.value));
                    });
                }
                
                handleInputChange(rangeId, value) {
                    const match = value.match(/(\d+)-(\d+)/);
                    if (match) {
                        let start = parseInt(match[1]);
                        let end = parseInt(match[2]);
                        
                        start = Math.max(this.options.minValue, Math.min(this.options.maxValue, start));
                        end = Math.max(this.options.minValue, Math.min(this.options.maxValue, end));
                        
                        if (start > end) {
                            [start, end] = [end, start];
                        }
                        
                        this.ranges[rangeId].start = start;
                        this.ranges[rangeId].end = end;
                        
                        this.updateRangeVisuals(rangeId);
                    
                    if (!this.onRangeChangeTimeout) {
                        this.onRangeChangeTimeout = setTimeout(() => {
                            this.options.onRangeChange(this.getRangeString());
                            this.onRangeChangeTimeout = null;
                        }, 50);
                    }
                    }
                }
                
                bindEvents() {
                    const addBtn = document.getElementById(`addRangeBtn_${this.container.id}`);
                    const removeBtn = document.getElementById(`removeRangeBtn_${this.container.id}`);
                    
                    if (addBtn) {
                        addBtn.addEventListener('click', () => {
                            let newStart, newEnd;
                            
                            if (this.options.enableCharWidthMode) {
                                const emptySlot = this.findEmptySlot();
                                if (emptySlot) {
                                    newStart = emptySlot.start;
                                    newEnd = emptySlot.end;
                                } else {
                                    return;
                                }
                            } else {
                                if (this.ranges.length > 0) {
                                    const lastRange = this.ranges[this.ranges.length - 1];
                                    newStart = Math.min(lastRange.end + 1, this.options.maxValue);
                                    newEnd = Math.min(newStart + 1, this.options.maxValue);
                                } else {
                                    newStart = this.options.minValue;
                                    newEnd = Math.min(newStart + 1, this.options.maxValue);
                                }
                            }
                            
                            this.addRange(newStart, newEnd);
                            this.options.onRangeChange(this.getRangeString());
                        });
                    }
                    
                    if (removeBtn) {
                        removeBtn.addEventListener('click', () => {
                            this.removeRange();
                        });
                    }
                    
                    this.handles.forEach(handle => {
                        handle.addEventListener('mousedown', (e) => this.handleMouseDown(e, handle));
                        handle.addEventListener('touchstart', (e) => this.handleTouchStart(e, handle));
                    });
                    
                    document.addEventListener('mousemove', (e) => this.handleMouseMove(e));
                    document.addEventListener('mouseup', () => this.handleMouseUp());
                    document.addEventListener('touchmove', (e) => this.handleTouchMove(e));
                    document.addEventListener('touchend', () => this.handleTouchEnd());
                }
                
                handleMouseDown(e, handle) {
                    e.preventDefault();
                    this.draggingHandle = handle;
                    this.trackRect = this.track.getBoundingClientRect();
                    this.dragOffset = e.clientX - this.trackRect.left;
                    handle.classList.add('dragging');
                }
                
                handleTouchStart(e, handle) {
                    e.preventDefault();
                    this.draggingHandle = handle;
                    this.trackRect = this.track.getBoundingClientRect();
                    this.dragOffset = e.touches[0].clientX - this.trackRect.left;
                    handle.classList.add('dragging');
                }
                
                handleMouseMove(e) {
                    if (!this.draggingHandle) return;
                    
                    const x = e.clientX - this.trackRect.left;
                    this.updateHandlePosition(x);
                }
                
                handleTouchMove(e) {
                    if (!this.draggingHandle) return;
                    
                    const x = e.touches[0].clientX - this.trackRect.left;
                    this.updateHandlePosition(x);
                }
                
                updateHandlePosition(x) {
                    const rangeId = parseInt(this.draggingHandle.dataset.rangeId);
                    const position = this.draggingHandle.dataset.position;
                    
                    let value;
                    
                    if (this.options.enableCharWidthMode && this.charPositions.length > 0) {
                        const totalWidth = this.charPositions[this.charPositions.length - 1];
                        const pixelPosition = (x / this.trackRect.width) * totalWidth;
                        
                        let closestIdx = 0;
                        let minDist = Math.abs(this.charPositions[0] - pixelPosition);
                        
                        for (let i = 1; i < this.charPositions.length; i++) {
                            const dist = Math.abs(this.charPositions[i] - pixelPosition);
                            if (dist < minDist) {
                                minDist = dist;
                                closestIdx = i;
                            }
                        }
                        
                        value = closestIdx + 1;
                    } else {
                        const totalRange = this.options.maxValue - this.options.minValue;
                        const percent = Math.max(0, Math.min(100, (x / this.trackRect.width) * 100));
                        value = Math.round((percent / 100) * totalRange + this.options.minValue + 0.5);
                    }
                    
                    if (position === 'left') {
                        const range = this.ranges[rangeId];
                        
                        if (value > range.end) {
                            this.ranges[rangeId].start = range.end;
                            this.ranges[rangeId].end = value;
                            
                            const leftHandle = this.handles[rangeId * 2];
                            const rightHandle = this.handles[rangeId * 2 + 1];
                            
                            leftHandle.dataset.position = 'right';
                            rightHandle.dataset.position = 'left';
                            
                            this.handles[rangeId * 2] = rightHandle;
                            this.handles[rangeId * 2 + 1] = leftHandle;
                            
                            this.draggingHandle = leftHandle;
                        } else {
                            this.ranges[rangeId].start = value;
                        }
                    } else {
                        const range = this.ranges[rangeId];
                        
                        if (value < range.start) {
                            this.ranges[rangeId].end = range.start;
                            this.ranges[rangeId].start = value;
                            
                            const leftHandle = this.handles[rangeId * 2];
                            const rightHandle = this.handles[rangeId * 2 + 1];
                            
                            leftHandle.dataset.position = 'right';
                            rightHandle.dataset.position = 'left';
                            
                            this.handles[rangeId * 2] = rightHandle;
                            this.handles[rangeId * 2 + 1] = leftHandle;
                            
                            this.draggingHandle = rightHandle;
                        } else {
                            this.ranges[rangeId].end = value;
                        }
                    }
                    
                    this.updateRangeVisuals(rangeId);
                    
                    if (!this.onRangeChangeTimeout) {
                        this.onRangeChangeTimeout = setTimeout(() => {
                            this.options.onRangeChange(this.getRangeString());
                            this.onRangeChangeTimeout = null;
                        }, 50);
                    }
                }
                
                handleMouseUp() {
                    if (this.draggingHandle) {
                        this.draggingHandle.classList.remove('dragging');
                        this.draggingHandle = null;
                    }
                }
                
                handleTouchEnd() {
                    this.handleMouseUp();
                }
                
                updateAddRemoveButtons() {
                    const addBtn = document.getElementById(`addRangeBtn_${this.container.id}`);
                    const removeBtn = document.getElementById(`removeRangeBtn_${this.container.id}`);
                    
                    if (addBtn) {
                        if (this.ranges.length === 0) {
                            addBtn.disabled = false;
                        } else {
                            if (this.options.enableCharWidthMode) {
                                const totalChars = this.options.maxValue - this.options.minValue + 1;
                                const coveredChars = new Set();
                                
                                this.ranges.forEach(range => {
                                    for (let i = range.start; i <= range.end; i++) {
                                        coveredChars.add(i);
                                    }
                                });
                                
                                addBtn.disabled = coveredChars.size >= totalChars;
                            } else {
                                const lastRange = this.ranges[this.ranges.length - 1];
                                addBtn.disabled = lastRange.end >= this.options.maxValue;
                            }
                        }
                    }
                    
                    if (removeBtn) {
                        removeBtn.disabled = this.ranges.length === 0;
                    }
                }
                
                getRangeString() {
                    return this.ranges.map(range => {
                        if (range.start === range.end) {
                            return `${range.start}`;
                        } else {
                            return `${range.start}-${range.end}`;
                        }
                    }).join(',');
                }
                
                setRangeString(rangeString) {
                    this.originalRangeString = rangeString;
                    const ranges = parseRangeStringToRanges(rangeString);
                    this.clearRanges();
                    
                    ranges.forEach(range => {
                        this.addRange(range.start, range.end);
                    });
                    
                    this.options.onRangeChange(this.getRangeString());
                }
                
                clearRanges() {
                    this.ranges.forEach((_, index) => {
                        const segment = document.getElementById(`segment_${this.container.id}_${index}`);
                        const leftHandle = document.getElementById(`handle_${this.container.id}_${index}_left`);
                        const rightHandle = document.getElementById(`handle_${this.container.id}_${index}_right`);
                        
                        if (segment) segment.remove();
                        if (leftHandle) leftHandle.remove();
                        if (rightHandle) rightHandle.remove();
                    });
                    
                    this.ranges = [];
                    this.segments = [];
                    this.handles = [];
                }
            }
            
            // ========== 数据存储 ==========
            let examples = {
                1: {
                    colors: ['#FF3842', '#FF6834', '#FF9834', '#F0C334', '#C8E234', '#9AFF34', '#5AFF5A', '#34F0B4', '#34C8E2', '#349AFF', '#5A5AFF', '#B434F0', '#E234C8', '#FF349A'],
                    originalText: '做一场不愿醒来的五彩斑斓的梦'
                },
                2: {
                    colors: ['#FFEB3B', '#FFDD34', '#FFCF2E', '#FFC127', '#FFB321', '#FFA51A', '#FF9714', '#FF890D', '#FF7B07', '#FF6D00'],
                    originalText: '我啊，当然永远明媚啦'
                },
                3: {
                    colors: ['#FFFFFF', '#FFDBDB', '#FFB6B6', '#FF9292', '#FF6D6D', '#FF4949', '#FF2424', '#FF0000', '#FF2020', '#FF4040', '#FF6060', '#FF8080', '#FF9F9F', '#FFBFBF', '#FFFFFF'],
                    originalText: 'ﮩ٨ـﮩﮩ٨ﮩ♡ﮩ٨ﮩـﮩ٨ﮩ'
                }
            };
            
            let history = JSON.parse(localStorage.getItem('colorHistory')) || [];
            let favorites = JSON.parse(localStorage.getItem('colorFavorites')) || [];
            
            // ========== 核心功能函数 ==========
            
            // 颜色输入同步
            function bindColorInputEvents() {
                // 绑定颜色选择器事件
                document.querySelectorAll('input[type="color"]').forEach(input => {
                    input.addEventListener('input', function(e) {
                        const colorId = this.id;
                        const swatch = document.getElementById(colorId + 'Swatch');
                        if (swatch) {
                            swatch.style.backgroundColor = e.target.value;
                        }
                        
                        // 更新对应的颜色代码输入框
                        const codeInput = document.getElementById(colorId + 'Code');
                        if (codeInput) {
                            codeInput.value = e.target.value.toUpperCase();
                        }
                        

                        
                        updateColorPreview();
                        resetFavoriteButton();
                        updateRealTimePreview();
                        updateCodeStatus();
                    });
                    
                    // 移动端支持
                    input.addEventListener('change', function(e) {
                        const colorId = this.id;
                        const swatch = document.getElementById(colorId + 'Swatch');
                        if (swatch) {
                            swatch.style.backgroundColor = e.target.value;
                        }
                        
                        // 更新对应的颜色代码输入框
                        const codeInput = document.getElementById(colorId + 'Code');
                        if (codeInput) {
                            codeInput.value = e.target.value.toUpperCase();
                        }
                        
                        // 保存到历史记录
                        addToHistory();
                        
                        updateColorPreview();
                        resetFavoriteButton();
                        updateRealTimePreview();
                        updateCodeStatus();
                    });
                });
                
                // 绑定颜色代码输入框事件
                document.querySelectorAll('.color-code-input').forEach(input => {
                    input.addEventListener('input', function(e) {
                        const inputId = this.id;
                        const colorId = inputId.replace('Code', '');
                        const colorInput = document.getElementById(colorId);
                        const swatch = document.getElementById(colorId + 'Swatch');
                        
                        if (colorInput && swatch && this.value) {
                            let colorValue = this.value;
                            // 确保以#开头
                            if (!colorValue.startsWith('#')) {
                                colorValue = '#' + colorValue;
                            }
                            
                            // 确保是有效的十六进制颜色
                            if (/^#[0-9A-Fa-f]{6}$/.test(colorValue) || /^#[0-9A-Fa-f]{3}$/.test(colorValue)) {
                                colorInput.value = colorValue;
                                swatch.style.backgroundColor = colorValue;
                                this.value = colorValue.toUpperCase();
                                

                                
                                updateColorPreview();
                                resetFavoriteButton();
                                updateRealTimePreview();
                                updateCodeStatus();
                            }
                        }
                    });
                    
                    input.addEventListener('blur', function(e) {
                        const inputId = this.id;
                        const colorId = inputId.replace('Code', '');
                        const colorInput = document.getElementById(colorId);
                        const swatch = document.getElementById(colorId + 'Swatch');
                        
                        if (colorInput && swatch && this.value) {
                            let colorValue = this.value;
                            // 确保以#开头
                            if (!colorValue.startsWith('#')) {
                                colorValue = '#' + colorValue;
                            }
                            
                            // 确保是有效的十六进制颜色
                            if (/^#[0-9A-Fa-f]{6}$/.test(colorValue) || /^#[0-9A-Fa-f]{3}$/.test(colorValue)) {
                                colorInput.value = colorValue;
                                swatch.style.backgroundColor = colorValue;
                                this.value = colorValue.toUpperCase();
                                
                                // 保存到历史记录
                                addToHistory();
                                
                                updateColorPreview();
                                resetFavoriteButton();
                                updateRealTimePreview();
                                updateCodeStatus();
                            } else {
                                // 如果无效，恢复原来的值
                                this.value = colorInput.value.toUpperCase();
                            }
                        }
                    });
                });
                

                
                const swapBtn = document.getElementById('swapColorsBtn');
                if (swapBtn) {
                    swapBtn.addEventListener('click', swapColors);
                }
            }
            

            
            function getCurrentParamsHash() {
                const text = textInput.value.trim();
                const fontSize = fontSizeInput.value;
                const isBold = boldCheckbox.checked;
                const isItalic = italicCheckbox.checked;
                const isUnderline = underlineCheckbox.checked;
                const mode = currentMode;
                
                let params = `${text}|${fontSize}|${isBold}|${isItalic}|${isUnderline}|${mode}`;
                
                if (mode === 'custom') {
                    const gradientEnabled = customGradientCheckbox ? customGradientCheckbox.checked : false;
                    params += `|${gradientEnabled}|${JSON.stringify(customColorRowsData)}|${JSON.stringify(customGradientData)}`;
                } else {
                    const color1 = document.getElementById('color1');
                    const color2 = document.getElementById('color2');
                    const colorCount = getColorCount();
                    const randomMode = randomModeSelect ? randomModeSelect.value : 'sequential';
                    
                    if (colorCount === 2 && color1 && color2) {
                        params += `|${color1.value}|${color2.value}|2|${randomMode}`;
                    } else {
                        params += `|multi|${colorCount}|${randomMode}`;
                    }
                }
                
                let hash = 0;
                for (let i = 0; i < params.length; i++) {
                    const char = params.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash;
                }
                return hash.toString();
            }
            
            function updateCodeStatus() {
                const codeStatus = document.getElementById('codeStatus');
                if (!codeStatus) return;
                
                const currentCode = codeOutput.textContent;
                const currentHash = getCurrentParamsHash();
                
                if (currentCode === '等待生成...' || currentCode === '') {
                    codeStatus.textContent = '';
                    codeStatus.className = 'code-status';
                    return;
                }
                
                if (currentHash === currentParamsHash && currentMode === lastGeneratedMode) {
                    codeStatus.textContent = '效果代码已生成';
                    codeStatus.className = 'code-status up-to-date';
                } else {
                    codeStatus.textContent = '新效果代码未生成';
                    codeStatus.className = 'code-status needs-update';
                }
            }
            
            function updateCodeCharCount() {
                const code = codeOutput.textContent;
                if (!code || code === '等待生成...') {
                    document.getElementById('codeCharCount').textContent = '0';
                    return;
                }
                
                const charCount = code.length;
                document.getElementById('codeCharCount').textContent = charCount;
            }
            
            function updateColorUI(colorId, colorValue) {
                const colorInput = document.getElementById(colorId);
                const swatch = document.getElementById(colorId + 'Swatch');
                const codeInput = document.getElementById(colorId + 'Code');
                
                if (colorInput) {
                    colorInput.value = colorValue;
                }
                if (swatch) {
                    swatch.style.backgroundColor = colorValue;
                }
                if (codeInput) {
                    codeInput.value = colorValue.toUpperCase();
                }
                
                updateColorPreview();
                resetFavoriteButton();
                updateRealTimePreview();
            }
            

            

            
            // 颜色互换
            function swapColors() {
                const color1 = document.getElementById('color1');
                const color2 = document.getElementById('color2');
                const color1Swatch = document.getElementById('color1Swatch');
                const color2Swatch = document.getElementById('color2Swatch');
                
                if (!color1 || !color2) return;
                
                const tempColor = color1.value;
                color1.value = color2.value;
                if (color1Swatch) color1Swatch.style.backgroundColor = color2.value;
                color2.value = tempColor;
                if (color2Swatch) color2Swatch.style.backgroundColor = tempColor;
                
                updateColorPreview();
                resetFavoriteButton();
                updateRealTimePreview();
                showNotification('颜色已互换');
            }
            
            // 更新颜色预览
            function updateColorPreview() {
                if (currentMode === 'custom') {
                    colorPreview.style.background = 'rgba(30, 40, 50, 0.6)';
                } else {
                    const colors = getAllColors();
                    if (colors.length > 0) {
                        colorPreview.style.background = `linear-gradient(to right, ${colors.join(', ')})`;
                    }
                }
            }
            
            // 实时预览
            function updateRealTimePreview() {
                const text = textInput.value.trim();
                if (!text) {
                    previewOutput.innerHTML = '<span style="color: #7a8a9a;">请输入文案以预览效果</span>';
                    floatingPreviewOutput.innerHTML = '<span style="color: #7a8a9a;">请输入文案以预览效果</span>';
                    return;
                }
                
                if (currentMode === 'custom') {
                    const previewHtml = generateCustomPreview(text);
                    previewOutput.innerHTML = previewHtml;
                    floatingPreviewOutput.innerHTML = previewHtml;
                } else {
                    const fontSize = parseInt(fontSizeInput.value) || 16;
                    const isBold = boldCheckbox.checked;
                    const isItalic = italicCheckbox.checked;
                    const isUnderline = underlineCheckbox.checked;
                    
                    let colors = [];
                    const colorCount = getColorCount();
                    if (colorCount === 2) {
                        const color1 = document.getElementById('color1');
                        const color2 = document.getElementById('color2');
                        if (color1 && color2) {
                            colors = interpolateColors(color1.value.toUpperCase(), color2.value.toUpperCase(), text.length);
                        }
                    } else {
                        colors = interpolateMultiColors(text.length);
                    }
                    
                    let previewHtml = '';
                    for (let i = 0; i < text.length; i++) {
                        let style = `color: ${colors[i]}; font-size: ${fontSize}px;`;
                        if (isBold) style += ' font-weight: bold;';
                        if (isItalic) style += ' font-style: italic;';
                        if (isUnderline) style += ' text-decoration: underline;';
                        previewHtml += `<span style="${style}">${text[i]}</span>`;
                    }
                    
                    previewOutput.innerHTML = previewHtml;
                    floatingPreviewOutput.innerHTML = previewHtml;
                }
            }
            
            // 生成颜色代码
            function generateGradientCode() {
                const text = textInput.value.trim();
                if (!text) {
                    showNotification('请输入文案！', 'error');
                    return;
                }
                
                let gameCode = '';
                
                if (currentMode === 'custom') {
                    gameCode = generateCustomCode(text);
                } else {
                    const fontSize = parseInt(fontSizeInput.value) || 16;
                    const isBold = boldCheckbox.checked;
                    const isItalic = italicCheckbox.checked;
                    const isUnderline = underlineCheckbox.checked;
                    
                    let colors = [];
                    const colorCount = getColorCount();
                    if (colorCount === 2) {
                        const color1 = document.getElementById('color1');
                        const color2 = document.getElementById('color2');
                        if (color1 && color2) {
                            colors = interpolateColors(color1.value.toUpperCase(), color2.value.toUpperCase(), text.length);
                        }
                    } else {
                        colors = interpolateMultiColors(text.length);
                    }
                    
                    let currentColor = '';
                    let currentText = '';
                    
                    for (let i = 0; i < text.length; i++) {
                        if (colors[i] !== currentColor) {
                            if (currentText) {
                                gameCode += `<color=${currentColor}>${currentText}</color>`;
                            }
                            currentColor = colors[i];
                            currentText = text[i];
                        } else {
                            currentText += text[i];
                        }
                    }
                    
                    if (currentText) {
                        gameCode += `<color=${currentColor}>${currentText}</color>`;
                    }
                    
                    gameCode = formatTextSegment(gameCode, null, fontSize, isBold, isItalic, isUnderline, fontSize);
                }
                
                codeOutput.textContent = gameCode;
                
                // 计算实际文本的长度，不包含HTML标签
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = gameCode;
                const actualTextLength = tempDiv.textContent.length;
                document.getElementById('codeCharCount').textContent = actualTextLength;
                lastGeneratedCode = gameCode;
                lastGeneratedMode = currentMode;
                currentParamsHash = getCurrentParamsHash();
                updateCodeStatus();
                resetFavoriteButton();
                
                if (shouldShowGenerateNotification) {
                    addToHistory();
                    showNotification('代码生成！');
                    shouldShowGenerateNotification = false;
                }
            }
            
            // 复制代码
            function copyCode() {
                const code = codeOutput.textContent;
                if (code === '等待生成...') {
                    showNotification('请先生成代码！', 'error');
                    return;
                }
                
                const textArea = document.createElement("textarea");
                textArea.value = code;
                document.body.appendChild(textArea);
                textArea.select();
                textArea.setSelectionRange(0, 99999);
                
                try {
                    const successful = document.execCommand('copy');
                    if (successful) {
                        copyBtn.textContent = '已复制！';
                        copyBtn.classList.add('copied');
                        showNotification('复制成功！');
                        
                        // 将当前选中的自定义范围数据添加到历史记录
                        addToHistory();
                        
                        setTimeout(() => {
                            copyBtn.textContent = '复制';
                            copyBtn.classList.remove('copied');
                        }, 500);
                    } else {
                        showNotification('复制失败！', 'error');
                    }
                } catch (err) {
                    console.error('复制失败: ', err);
                    showNotification('复制失败！', 'error');
                }
                
                document.body.removeChild(textArea);
            }
            
            // 颜色插值
            function interpolateColors(startColor, endColor, steps) {
                const start = hexToRgb(startColor);
                const end = hexToRgb(endColor);
                const colors = [];
                
                for (let i = 0; i < steps; i++) {
                    const ratio = i / (steps - 1);
                    const r = Math.round(start.r + (end.r - start.r) * ratio);
                    const g = Math.round(start.g + (end.g - start.g) * ratio);
                    const b = Math.round(start.b + (end.b - start.b) * ratio);
                    colors.push(rgbToHex(r, g, b));
                }
                
                return colors;
            }
            
            function interpolateMultiColors(steps) {
                const colors = getAllColors();
                if (colors.length < 2) {
                    const color1 = document.getElementById('color1');
                    const color2 = document.getElementById('color2');
                    if (color1 && color2) {
                        return interpolateColors(color1.value.toUpperCase(), color2.value.toUpperCase(), steps);
                    }
                    return ['#2EFFA4'];
                }
                
                const colorCount = colors.length;
                const segmentSteps = Math.floor(steps / (colorCount - 1));
                const resultColors = [];
                
                for (let i = 0; i < colorCount - 1; i++) {
                    const startColor = hexToRgb(colors[i]);
                    const endColor = hexToRgb(colors[i + 1]);
                    
                    const currentSteps = (i === colorCount - 2) ? 
                        steps - i * segmentSteps : segmentSteps;
                    
                    for (let j = 0; j < currentSteps; j++) {
                        const ratio = j / currentSteps;
                        const r = Math.round(startColor.r + (endColor.r - startColor.r) * ratio);
                        const g = Math.round(startColor.g + (endColor.g - startColor.g) * ratio);
                        const b = Math.round(startColor.b + (endColor.b - startColor.b) * ratio);
                        resultColors.push(rgbToHex(r, g, b));
                    }
                }
                
                while (resultColors.length < steps) {
                    resultColors.push(resultColors[resultColors.length - 1]);
                }
                
                return resultColors;
            }
            
            // 颜色转换
            function hexToRgb(hex) {
                const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
                return result ? {
                    r: parseInt(result[1], 16),
                    g: parseInt(result[2], 16),
                    b: parseInt(result[3], 16)
                } : { r: 0, g: 0, b: 0 };
            }
            
            function rgbToHex(r, g, b) {
                return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1).toUpperCase();
            }
            
            function rgbToHsl(r, g, b) {
                r /= 255;
                g /= 255;
                b /= 255;
                
                const max = Math.max(r, g, b);
                const min = Math.min(r, g, b);
                let h, s, l = (max + min) / 2;
                
                if (max === min) {
                    h = s = 0;
                } else {
                    const d = max - min;
                    s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                    
                    switch (max) {
                        case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                        case g: h = (b - r) / d + 2; break;
                        case b: h = (r - g) / d + 4; break;
                    }
                    
                    h /= 6;
                }
                
                return [h * 360, s * 100, l * 100];
            }
            
            function hslToRgb(h, s, l) {
                h /= 360;
                s /= 100;
                l /= 100;
                
                let r, g, b;
                
                if (s === 0) {
                    r = g = b = l;
                } else {
                    const hue2rgb = (p, q, t) => {
                        if (t < 0) t += 1;
                        if (t > 1) t -= 1;
                        if (t < 1/6) return p + (q - p) * 6 * t;
                        if (t < 1/2) return q;
                        if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
                        return p;
                    };
                    
                    const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
                    const p = 2 * l - q;
                    
                    r = hue2rgb(p, q, h + 1/3);
                    g = hue2rgb(p, q, h);
                    b = hue2rgb(p, q, h - 1/3);
                }
                
                return [
                    Math.round(r * 255),
                    Math.round(g * 255),
                    Math.round(b * 255)
                ];
            }
            
            // 获取所有颜色值
            function getAllColors() {
                const colors = [];
                const colorCount = getColorCount();
                
                // 添加起始颜色
                const color1 = document.getElementById('color1');
                if (color1) colors.push(color1.value.toUpperCase());
                
                // 添加中间颜色
                if (colorCount > 2) {
                    for (let i = 3; i <= colorCount; i++) {
                        const color = document.getElementById(`color${i}`);
                        if (color) colors.push(color.value.toUpperCase());
                    }
                }
                
                // 添加末尾颜色
                const color2 = document.getElementById('color2');
                if (color2) colors.push(color2.value.toUpperCase());
                
                return colors;
            }
            
            // 历史记录功能
            function addToHistory() {
                const fontSize = currentMode === 'custom' ? 
                16 : // 移除了全局字体大小设置，使用默认值
                (parseInt(fontSizeInput.value) || 16);
                
                const isBold = currentMode === 'custom' ? 
                    customGlobalBoldCheckbox.checked : 
                    boldCheckbox.checked;
                const isItalic = currentMode === 'custom' ? 
                    customGlobalItalicCheckbox.checked : 
                    italicCheckbox.checked;
                const isUnderline = currentMode === 'custom' ? 
                    customGlobalUnderlineCheckbox.checked : 
                    underlineCheckbox.checked;
                
                const color1 = document.getElementById('color1');
                const color2 = document.getElementById('color2');
                const colors = getAllColors();
                
                const historyItem = {
                    id: Date.now(),
                    text: textInput.value,
                    fontSize: fontSize,
                    isBold: isBold,
                    isItalic: isItalic,
                    isUnderline: isUnderline,
                    startColor: color1 ? color1.value : '#2effa4',
                    endColor: color2 ? color2.value : '#3898ff',
                    colors: colors,
                    mode: currentMode,
                    timestamp: new Date().toLocaleString(),
                    isFavorite: false
                };
                
                if (currentMode === 'custom') {
                    historyItem.customData = {
                        colorCount: customColorCount,
                        colorRows: [...customColorRowsData],
                        boldRanges: customBoldCheckbox.checked ? customBoldInput.value : '',
                        italicRanges: customItalicCheckbox.checked ? customItalicInput.value : '',
                        underlineRanges: customUnderlineCheckbox.checked ? customUnderlineInput.value : ''
                    };
                }
                
                const existingIndex = history.findIndex(item => 
                    item.text === historyItem.text && 
                    item.fontSize === historyItem.fontSize &&
                    item.isBold === historyItem.isBold &&
                    item.isItalic === historyItem.isItalic &&
                    item.isUnderline === historyItem.isUnderline &&
                    item.startColor === historyItem.startColor && 
                    item.endColor === historyItem.endColor &&
                    JSON.stringify(item.colors) === JSON.stringify(historyItem.colors) &&
                    item.mode === historyItem.mode
                );
                
                if (existingIndex !== -1) {
                    const existingItem = history.splice(existingIndex, 1)[0];
                    history.unshift(existingItem);
                } else {
                    history.unshift(historyItem);
                }
                
                if (history.length > 20) {
                    history = history.slice(0, 20);
                }
                
                localStorage.setItem('colorHistory', JSON.stringify(history));
                renderHistory();
            }
            
            function renderHistory() {
                if (!historyList) return;   
                historyList.innerHTML = '';
                
                if (history.length === 0) {
                    historyList.innerHTML = '<div class="empty-message">暂无历史记录</div>';
                    return;
                }
                
                history.forEach(item => {
                    const historyItem = document.createElement('div');
                    historyItem.className = 'history-item';
                    historyItem.setAttribute('data-id', item.id);
                    
                    let colors = [];
                    if (item.mode === 'home') {
                        colors = item.colors ? interpolateMultiColorsWithColors(item.text.length, item.colors) : 
                                               interpolateColors(item.startColor, item.endColor, item.text.length);
                    } else if (item.mode === 'custom' && item.customData) {
                        let previewHtml = '';
                        const textLength = item.text.length;
                        const fontSize = item.fontSize;
                        
                        let colorMap = new Array(textLength).fill('#FFFFFF');
                        
                        if (item.customData.colorRows) {
                            for (const row of item.customData.colorRows) {
                                if (row.range && row.color) {
                                    const ranges = parseRanges(row.range, textLength);
                                    for (const range of ranges) {
                                        for (let j = range.start; j <= range.end; j++) {
                                            if (j >= 1 && j <= textLength) {
                                                colorMap[j-1] = row.color;
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        
                        const boldRanges = item.customData.boldRanges ? parseRanges(item.customData.boldRanges, textLength) : [];
                        const italicRanges = item.customData.italicRanges ? parseRanges(item.customData.italicRanges, textLength) : [];
                        const underlineRanges = item.customData.underlineRanges ? parseRanges(item.customData.underlineRanges, textLength) : [];
                        
                        for (let i = 0; i < textLength; i++) {
                            let style = `color: ${colorMap[i]}; font-size: ${fontSize}px;`;
                            
                            if (item.isBold || boldRanges.some(range => i+1 >= range.start && i+1 <= range.end)) {
                                style += ' font-weight: bold;';
                            }
                            
                            if (item.isItalic || italicRanges.some(range => i+1 >= range.start && i+1 <= range.end)) {
                                style += ' font-style: italic;';
                            }
                            
                            if (item.isUnderline || underlineRanges.some(range => i+1 >= range.start && i+1 <= range.end)) {
                                style += ' text-decoration: underline;';
                            }
                            
                            previewHtml += `<span style="${style}">${item.text[i]}</span>`;
                        }
                        
                        historyItem.innerHTML = `
                            <div class="history-preview">${previewHtml}</div>
                            <div class="history-info">
                                <div class="history-text">${item.text.substring(0, 20)}${item.text.length > 20 ? '...' : ''}</div>
                                <div class="history-colors">
                                    ${item.mode === 'custom' && item.customData && item.customData.colorRows ? 
                                        item.customData.colorRows.map(row => row.color ? `<div class="history-color" style="background-color: ${row.color}"></div>` : '').join('') : 
                                        item.colors ? 
                                            item.colors.map(color => `<div class="history-color" style="background-color: ${color}"></div>`).join('') : `
                                                <div class="history-color" style="background-color: ${item.startColor}"></div>
                                                <div class="history-color" style="background-color: ${item.endColor}"></div>
                                            `
                                    }
                                </div>
                            </div>
                            <div class="history-actions">
                                <button class="history-action-btn copy-history" data-id="${item.id}">复制</button>
                                <button class="history-action-btn delete-history" data-id="${item.id}">删除</button>
                                <button class="star-btn ${item.isFavorite ? 'favorited' : ''}" data-id="${item.id}">${item.isFavorite ? '★' : '☆'}</button>
                            </div>
                        `;
                        
                        historyList.appendChild(historyItem);
                        
                        historyItem.addEventListener('click', function(e) {
                            if (!e.target.classList.contains('star-btn') && !e.target.classList.contains('delete-history')) {
                                applyHistoryItem(item, 'history');
                            }
                        });
                        
                        const deleteBtn = historyItem.querySelector('.delete-history');
                        deleteBtn.addEventListener('click', function(e) {
                            e.stopPropagation();
                            deleteHistoryItem(item.id);
                        });
                        
                        const starBtn = historyItem.querySelector('.star-btn');
                        starBtn.addEventListener('click', function(e) {
                            e.stopPropagation();
                            toggleFavorite(item.id);
                        });
                        
                        const copyBtn = historyItem.querySelector('.copy-history');
                        copyBtn.addEventListener('click', function(e) {
                            e.stopPropagation();
                            copyHistoryItemCode(item);
                        });
                        
                        return;
                    } else {
                        colors = item.colors ? interpolateMultiColorsWithColors(item.text.length, item.colors) : 
                                               interpolateColors(item.startColor, item.endColor, item.text.length);
                    }
                    
                    let previewHtml = '';
                    for (let i = 0; i < item.text.length; i++) {
                        let style = `color: ${colors[i]}; font-size: ${item.fontSize}px;`;
                        if (item.isBold) style += ' font-weight: bold;';
                        if (item.isItalic) style += ' font-style: italic;';
                        if (item.isUnderline) style += ' text-decoration: underline;';
                        previewHtml += `<span style="${style}">${item.text[i]}</span>`;
                    }
                    
                    historyItem.innerHTML = `
                        <div class="history-preview">${previewHtml}</div>
                        <div class="history-info">
                            <div class="history-text">${item.text.substring(0, 20)}${item.text.length > 20 ? '...' : ''}</div>
                            <div class="history-colors">
                                    ${item.mode === 'custom' && item.customData && item.customData.colorRows ? 
                                        item.customData.colorRows.map(row => row.color ? `<div class="history-color" style="background-color: ${row.color}"></div>` : '').join('') : 
                                        item.colors ? 
                                            item.colors.map(color => `<div class="history-color" style="background-color: ${color}"></div>`).join('') : `
                                                <div class="history-color" style="background-color: ${item.startColor}"></div>
                                                <div class="history-color" style="background-color: ${item.endColor}"></div>
                                            `
                                    }
                                </div>
                        </div>
                        <div class="history-actions">
                            <button class="history-action-btn copy-history" data-id="${item.id}">复制</button>
                            <button class="history-action-btn delete-history" data-id="${item.id}">删除</button>
                            <button class="star-btn ${item.isFavorite ? 'favorited' : ''}" data-id="${item.id}">${item.isFavorite ? '★' : '☆'}</button>
                        </div>
                    `;
                    
                    historyList.appendChild(historyItem);
                    
                    historyItem.addEventListener('click', function(e) {
                        if (!e.target.classList.contains('star-btn') && !e.target.classList.contains('delete-history')) {
                            applyHistoryItem(item, 'history');
                        }
                    });
                    
                    const deleteBtn = historyItem.querySelector('.delete-history');
                    deleteBtn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        deleteHistoryItem(item.id);
                    });
                    
                    const starBtn = historyItem.querySelector('.star-btn');
                    starBtn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        toggleFavorite(item.id);
                    });
                    
                    const copyBtn = historyItem.querySelector('.copy-history');
                    copyBtn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        copyHistoryItemCode(item);
                    });
                });
            }
            
            // 收藏功能
            function renderFavorites() {
                if (!favoritesList) return;
                favoritesList.innerHTML = '';
                
                if (favorites.length === 0) {
                    favoritesList.innerHTML = '<div class="empty-message">暂无收藏</div>';
                    return;
                }
                
                favorites.forEach(item => {
                    const favoriteItem = document.createElement('div');
                    favoriteItem.className = 'favorite-item';
                    favoriteItem.setAttribute('data-id', item.id);
                    
                    let colors = [];
                    if (item.colors && Array.isArray(item.colors) && item.colors.length > 1) {
                        // 如果有保存的完整颜色数组，使用它来生成渐变
                        colors = interpolateMultiColorsWithColors(item.text.length, item.colors);
                    } else if (item.mode === 'home') {
                        // 否则使用起始颜色和末尾颜色生成渐变
                        colors = interpolateColors(item.startColor, item.endColor, item.text.length);
                    } else if (item.mode === 'custom' && item.customData) {
                        let previewHtml = '';
                        const textLength = item.text.length;
                        const fontSize = item.fontSize;
                        
                        let colorMap = new Array(textLength).fill('#FFFFFF');
                        
                        if (item.customData.colorRows) {
                            for (const row of item.customData.colorRows) {
                                if (row.range && row.color) {
                                    const ranges = parseRanges(row.range, textLength);
                                    for (const range of ranges) {
                                        for (let j = range.start; j <= range.end; j++) {
                                            if (j >= 1 && j <= textLength) {
                                                colorMap[j-1] = row.color;
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        
                        const boldRanges = item.customData.boldRanges ? parseRanges(item.customData.boldRanges, textLength) : [];
                        const italicRanges = item.customData.italicRanges ? parseRanges(item.customData.italicRanges, textLength) : [];
                        const underlineRanges = item.customData.underlineRanges ? parseRanges(item.customData.underlineRanges, textLength) : [];
                        
                        for (let i = 0; i < textLength; i++) {
                            let style = `color: ${colorMap[i]}; font-size: ${fontSize}px;`;
                            
                            if (item.isBold || boldRanges.some(range => i+1 >= range.start && i+1 <= range.end)) {
                                style += ' font-weight: bold;';
                            }
                            
                            if (item.isItalic || italicRanges.some(range => i+1 >= range.start && i+1 <= range.end)) {
                                style += ' font-style: italic;';
                            }
                            
                            if (item.isUnderline || underlineRanges.some(range => i+1 >= range.start && i+1 <= range.end)) {
                                style += ' text-decoration: underline;';
                            }
                            
                            previewHtml += `<span style="${style}">${item.text[i]}</span>`;
                        }
                        
                        favoriteItem.innerHTML = `
                            <div class="history-preview">${previewHtml}</div>
                            <div class="history-info">
                                <div class="history-text">${item.text.substring(0, 20)}${item.text.length > 20 ? '...' : ''}</div>
                                <div class="history-colors">
                                    ${item.mode === 'custom' && item.customData && item.customData.colorRows ? 
                                        item.customData.colorRows.map(row => row.color ? `<div class="history-color" style="background-color: ${row.color}"></div>` : '').join('') : 
                                        item.colors ? 
                                            item.colors.map(color => `<div class="history-color" style="background-color: ${color}"></div>`).join('') : `
                                                <div class="history-color" style="background-color: ${item.startColor}"></div>
                                                <div class="history-color" style="background-color: ${item.endColor}"></div>
                                            `
                                    }
                                </div>
                            </div>
                            <div class="history-actions">
                                <button class="history-action-btn copy-history" data-id="${item.id}">复制</button>
                                <button class="history-action-btn delete-history" data-id="${item.id}">删除</button>
                                <button class="star-btn favorited" data-id="${item.id}">★</button>
                            </div>
                        `;
                        
                        favoritesList.appendChild(favoriteItem);
                        
                        favoriteItem.addEventListener('click', function(e) {
                            if (!e.target.classList.contains('star-btn') && !e.target.classList.contains('delete-history')) {
                                applyHistoryItem(item, 'favorite');
                            }
                        });
                        
                        const deleteBtn = favoriteItem.querySelector('.delete-history');
                        deleteBtn.addEventListener('click', function(e) {
                            e.stopPropagation();
                            deleteHistoryItem(item.id);
                        });
                        
                        const starBtn = favoriteItem.querySelector('.star-btn');
                        starBtn.addEventListener('click', function(e) {
                            e.stopPropagation();
                            toggleFavorite(item.id);
                        });
                        
                        const copyBtn = favoriteItem.querySelector('.copy-history');
                        copyBtn.addEventListener('click', function(e) {
                            e.stopPropagation();
                            copyHistoryItemCode(item);
                        });
                        
                        return;
                    } else {
                        colors = item.colors ? interpolateMultiColorsWithColors(item.text.length, item.colors) : 
                                               interpolateColors(item.startColor, item.endColor, item.text.length);
                    }
                    
                    let previewHtml = '';
                    for (let i = 0; i < item.text.length; i++) {
                        let style = `color: ${colors[i]}; font-size: ${item.fontSize}px;`;
                        if (item.isBold) style += ' font-weight: bold;';
                        if (item.isItalic) style += ' font-style: italic;';
                        if (item.isUnderline) style += ' text-decoration: underline;';
                        previewHtml += `<span style="${style}">${item.text[i]}</span>`;
                    }
                    
                    favoriteItem.innerHTML = `
                        <div class="history-preview">${previewHtml}</div>
                        <div class="history-info">
                            <div class="history-text">${item.text.substring(0, 20)}${item.text.length > 20 ? '...' : ''}</div>
                            <div class="history-colors">
                                    ${item.mode === 'custom' && item.customData && item.customData.colorRows ? 
                                        item.customData.colorRows.map(row => row.color ? `<div class="history-color" style="background-color: ${row.color}"></div>` : '').join('') : 
                                        item.colors ? 
                                            item.colors.map(color => `<div class="history-color" style="background-color: ${color}"></div>`).join('') : `
                                                <div class="history-color" style="background-color: ${item.startColor}"></div>
                                                <div class="history-color" style="background-color: ${item.endColor}"></div>
                                            `
                                    }
                                </div>
                        </div>
                        <div class="history-actions">
                            <button class="history-action-btn copy-history" data-id="${item.id}">复制</button>
                            <button class="history-action-btn delete-history" data-id="${item.id}">删除</button>
                            <button class="star-btn favorited" data-id="${item.id}">★</button>
                        </div>
                    `;
                    
                    favoritesList.appendChild(favoriteItem);
                    
                    favoriteItem.addEventListener('click', function(e) {
                        if (!e.target.classList.contains('star-btn') && !e.target.classList.contains('delete-history')) {
                            applyHistoryItem(item, 'favorite');
                        }
                    });
                    
                    const deleteBtn = favoriteItem.querySelector('.delete-history');
                    deleteBtn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        deleteHistoryItem(item.id);
                    });
                    
                    const starBtn = favoriteItem.querySelector('.star-btn');
                    starBtn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        toggleFavorite(item.id);
                    });
                    
                    const copyBtn = favoriteItem.querySelector('.copy-history');
                    copyBtn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        copyHistoryItemCode(item);
                    });
                });
            }
            
            function applyHistoryItem(item, source) {
                textInput.value = item.text;
                switchMode(item.mode);
                
                if (item.mode === 'custom' && item.customData) {
                    setTimeout(() => {
                        customGlobalBoldCheckbox.checked = item.isBold;
                        customGlobalItalicCheckbox.checked = item.isItalic;
                        customGlobalUnderlineCheckbox.checked = item.isUnderline;
                        setCustomColorCount(item.customData.colorCount || 3);
                        
                        if (item.customData.colorRows) {
                            for (let i = 0; i < item.customData.colorRows.length; i++) {
                                if (i < customColorRowsData.length) {
                                    customColorRowsData[i] = { ...item.customData.colorRows[i] };
                                }
                            }
                        }
                        
                        customBoldCheckbox.checked = !!item.customData.boldRanges;
                        customItalicCheckbox.checked = !!item.customData.italicRanges;
                        customUnderlineCheckbox.checked = !!item.customData.underlineRanges;
                        
                        customBoldInput.value = item.customData.boldRanges || '';
                        customItalicInput.value = item.customData.italicRanges || '';
                        customUnderlineInput.value = item.customData.underlineRanges || '';
                        
                        renderCustomColorRows();
                        updateRealTimePreview();
                        generateGradientCode();
                    }, 100);
                } else {
                    fontSizeInput.value = item.fontSize;
                    boldCheckbox.checked = item.isBold;
                    italicCheckbox.checked = item.isItalic;
                    underlineCheckbox.checked = item.isUnderline;
                    
                    setTimeout(() => {
                        // 根据保存的颜色数量设置对应的颜色模式
                        if (item.colors && Array.isArray(item.colors) && item.colors.length > 0) {
                            setGradientColorCount(item.colors.length);
                        }
                        
                        const color1 = document.getElementById('color1');
                        const color2 = document.getElementById('color2');
                        const color1Swatch = document.getElementById('color1Swatch');
                        const color2Swatch = document.getElementById('color2Swatch');
                        const color1Code = document.getElementById('color1Code');
                        const color2Code = document.getElementById('color2Code');
                        
                        if (color1) {
                            color1.value = item.startColor;
                        }
                        if (color1Swatch) {
                            color1Swatch.style.backgroundColor = item.startColor;
                        }
                        if (color1Code) {
                            color1Code.value = item.startColor.toUpperCase().replace('#', '');
                        }
                        
                        if (color2) {
                            color2.value = item.endColor;
                        }
                        if (color2Swatch) {
                            color2Swatch.style.backgroundColor = item.endColor;
                        }
                        if (color2Code) {
                            color2Code.value = item.endColor.toUpperCase().replace('#', '');
                        }
                        
                        if (item.colors && Array.isArray(item.colors)) {
                                for (let i = 0; i < item.colors.length - 2; i++) {
                                    const colorIndex = i + 3;
                                    const colorInput = document.getElementById(`color${colorIndex}`);
                                    const colorSwatch = document.getElementById(`color${colorIndex}Swatch`);
                                    const colorCode = document.getElementById(`color${colorIndex}Code`);
                                    
                                    if (colorInput && colorSwatch && item.colors[i + 1]) {
                                        colorInput.value = item.colors[i + 1];
                                        colorSwatch.style.backgroundColor = item.colors[i + 1];
                                        if (colorCode) {
                                            colorCode.value = item.colors[i + 1].toUpperCase().replace('#', '');
                                        }
                                    }
                                }
                            }
                        
                        updateColorPreview();
                        generateGradientCode();
                        updateAllPreviews();
                    }, 100);
                }
                
                closeSidebar();
                
                // 显示通知
                const notificationText = source === 'history' ? '应用历史！' : '应用收藏！';
                showNotification(notificationText);
            }
            
            function deleteHistoryItem(id) {
                history = history.filter(item => item.id !== id);
                favorites = favorites.filter(item => item.id !== id);
                
                localStorage.setItem('colorHistory', JSON.stringify(history));
                localStorage.setItem('colorFavorites', JSON.stringify(favorites));
                
                renderHistory();
                renderFavorites();
                showNotification('删除历史！');
            }
            
            function clearHistory() {
                history = [];
                localStorage.setItem('colorHistory', JSON.stringify(history));
                renderHistory();
                showNotification('清空历史！');
            }
            
            function clearFavorites() {
                history.forEach(item => {
                    item.isFavorite = false;
                });
                
                favorites = [];
                
                localStorage.setItem('colorHistory', JSON.stringify(history));
                localStorage.setItem('colorFavorites', JSON.stringify(favorites));
                
                renderHistory();
                renderFavorites();
                showNotification('清空收藏！');
            }
            
            // 复制历史记录或收藏项的代码
            function copyHistoryItemCode(item) {
                let code = '';
                const fontSize = item.fontSize;
                
                if (item.mode === 'custom' && item.customData) {
                    // 自定义范围颜色模式
                    code = `<size=${fontSize}>`;
                    const textLength = item.text.length;
                    
                    let colorMap = new Array(textLength).fill('#FFFFFF');
                    if (item.customData.colorRows) {
                        for (const row of item.customData.colorRows) {
                            if (row.range && row.color) {
                                const ranges = parseRanges(row.range, textLength);
                                for (const range of ranges) {
                                    for (let j = range.start; j <= range.end; j++) {
                                        if (j >= 1 && j <= textLength) {
                                            colorMap[j-1] = row.color;
                                        }
                                    }
                                }
                            }
                        }
                    }
                    
                    const boldRanges = item.customData.boldRanges ? parseRanges(item.customData.boldRanges, textLength) : [];
                    const italicRanges = item.customData.italicRanges ? parseRanges(item.customData.italicRanges, textLength) : [];
                    const underlineRanges = item.customData.underlineRanges ? parseRanges(item.customData.underlineRanges, textLength) : [];
                    
                    for (let i = 0; i < textLength; i++) {
                        let charCode = `<color=${colorMap[i]}>`;
                        
                        if (item.isBold || boldRanges.some(range => i+1 >= range.start && i+1 <= range.end)) {
                            charCode += '<b>';
                        }
                        
                        if (item.isItalic || italicRanges.some(range => i+1 >= range.start && i+1 <= range.end)) {
                            charCode += '<i>';
                        }
                        
                        if (item.isUnderline || underlineRanges.some(range => i+1 >= range.start && i+1 <= range.end)) {
                            charCode += '<u>';
                        }
                        
                        charCode += item.text[i];
                        
                        if (item.isUnderline || underlineRanges.some(range => i+1 >= range.start && i+1 <= range.end)) {
                            charCode += '</u>';
                        }
                        
                        if (item.isItalic || italicRanges.some(range => i+1 >= range.start && i+1 <= range.end)) {
                            charCode += '</i>';
                        }
                        
                        if (item.isBold || boldRanges.some(range => i+1 >= range.start && i+1 <= range.end)) {
                            charCode += '</b>';
                        }
                        
                        charCode += '</color>';
                        code += charCode;
                    }
                    
                    code += `</size>`;
                } else {
                    // 其他模式
                    code = `<size=${fontSize}>`;
                    const colors = item.colors ? interpolateMultiColorsWithColors(item.text.length, item.colors) : 
                                               interpolateColors(item.startColor, item.endColor, item.text.length);
                    
                    for (let i = 0; i < item.text.length; i++) {
                        let charCode = `<color=${colors[i]}>`;
                        
                        if (item.isBold) charCode += '<b>';
                        if (item.isItalic) charCode += '<i>';
                        if (item.isUnderline) charCode += '<u>';
                        
                        charCode += item.text[i];
                        
                        if (item.isUnderline) charCode += '</u>';
                        if (item.isItalic) charCode += '</i>';
                        if (item.isBold) charCode += '</b>';
                        
                        charCode += '</color>';
                        code += charCode;
                    }
                    
                    code += `</size>`;
                }
                
                // 复制到剪贴板
                navigator.clipboard.writeText(code).then(() => {
                    showNotification('代码已复制到剪贴板');
                }).catch(err => {
                    console.error('复制失败:', err);
                    showNotification('复制失败，请手动复制');
                });
            }
            
            function toggleFavorite(id) {
                const itemIndex = history.findIndex(item => item.id === id);
                
                if (itemIndex !== -1) {
                    history[itemIndex].isFavorite = !history[itemIndex].isFavorite;
                    
                    if (history[itemIndex].isFavorite) {
                        if (!favorites.some(item => item.id === id)) {
                            favorites.unshift(history[itemIndex]);
                        } else {
                            const favoriteIndex = favorites.findIndex(item => item.id === id);
                            const favoriteItem = favorites.splice(favoriteIndex, 1)[0];
                            favorites.unshift(favoriteItem);
                        }
                    } else {
                        favorites = favorites.filter(item => item.id !== id);
                    }
                    
                    localStorage.setItem('colorHistory', JSON.stringify(history));
                    localStorage.setItem('colorFavorites', JSON.stringify(favorites));
                    
                    renderHistory();
                    renderFavorites();
                    
                    showNotification(history[itemIndex].isFavorite ? '添加收藏！' : '移除收藏！');
                }
            }
            
            function favoriteCurrent() {
                const fontSize = currentMode === 'custom' ? 
                    16 : 
                    (parseInt(fontSizeInput.value) || 16);
                
                const isBold = currentMode === 'custom' ? 
                    customGlobalBoldCheckbox.checked : 
                    boldCheckbox.checked;
                const isItalic = currentMode === 'custom' ? 
                    customGlobalItalicCheckbox.checked : 
                    italicCheckbox.checked;
                const isUnderline = currentMode === 'custom' ? 
                    customGlobalUnderlineCheckbox.checked : 
                    underlineCheckbox.checked;
                
                const color1 = document.getElementById('color1');
                const color2 = document.getElementById('color2');
                const colors = getAllColors();
                
                const currentItem = {
                    id: Date.now(),
                    text: textInput.value,
                    fontSize: fontSize,
                    isBold: isBold,
                    isItalic: isItalic,
                    isUnderline: isUnderline,
                    startColor: color1 ? color1.value : '#2effa4',
                    endColor: color2 ? color2.value : '#3898ff',
                    colors: colors,
                    mode: currentMode,
                    timestamp: new Date().toLocaleString(),
                    isFavorite: true
                };
                
                if (currentMode === 'custom') {
                    currentItem.customData = {
                        colorCount: customColorCount,
                        colorRows: [...customColorRowsData],
                        boldRanges: customBoldCheckbox.checked ? customBoldInput.value : '',
                        italicRanges: customItalicCheckbox.checked ? customItalicInput.value : '',
                        underlineRanges: customUnderlineCheckbox.checked ? customUnderlineInput.value : ''
                    };
                }
                
                const isAlreadyFavorite = favorites.some(item => 
                    item.text === currentItem.text && 
                    item.fontSize === currentItem.fontSize &&
                    item.isBold === currentItem.isBold &&
                    item.isItalic === currentItem.isItalic &&
                    item.isUnderline === currentItem.isUnderline &&
                    item.startColor === currentItem.startColor && 
                    item.endColor === currentItem.endColor &&
                    JSON.stringify(item.colors) === JSON.stringify(currentItem.colors) &&
                    item.mode === currentItem.mode
                );
                
                if (isAlreadyFavorite) {
                    favorites = favorites.filter(item => 
                        !(item.text === currentItem.text && 
                        item.fontSize === currentItem.fontSize &&
                        item.isBold === currentItem.isBold &&
                        item.isItalic === currentItem.isItalic &&
                        item.isUnderline === currentItem.isUnderline &&
                        item.startColor === currentItem.startColor && 
                        item.endColor === currentItem.endColor &&
                        JSON.stringify(item.colors) === JSON.stringify(currentItem.colors) &&
                        item.mode === currentItem.mode)
                    );
                    
                    history.forEach(item => {
                        if (item.text === currentItem.text && 
                            item.fontSize === currentItem.fontSize &&
                            item.isBold === currentItem.isBold &&
                            item.isItalic === currentItem.isItalic &&
                            item.isUnderline === currentItem.isUnderline &&
                            item.startColor === currentItem.startColor && 
                            item.endColor === currentItem.endColor &&
                            JSON.stringify(item.colors) === JSON.stringify(currentItem.colors) &&
                            item.mode === currentItem.mode) {
                            item.isFavorite = false;
                        }
                    });
                    
                    favoriteBtn.textContent = '☆ 收藏';
                    favoriteBtn.classList.remove('favorited');
                    showNotification('取消收藏！');
                } else {
                    const existingIndex = history.findIndex(item => 
                        item.text === currentItem.text && 
                        item.fontSize === currentItem.fontSize &&
                        item.isBold === currentItem.isBold &&
                        item.isItalic === currentItem.isItalic &&
                        item.isUnderline === currentItem.isUnderline &&
                        item.startColor === currentItem.startColor && 
                        item.endColor === currentItem.endColor &&
                        JSON.stringify(item.colors) === JSON.stringify(currentItem.colors) &&
                        item.mode === currentItem.mode
                    );
                    
                    if (existingIndex === -1) {
                        history.unshift(currentItem);
                    } else {
                        const existingItem = history.splice(existingIndex, 1)[0];
                        existingItem.isFavorite = true;
                        history.unshift(existingItem);
                    }
                    
                    const favoriteExistingIndex = favorites.findIndex(item => 
                        item.text === currentItem.text && 
                        item.fontSize === currentItem.fontSize &&
                        item.isBold === currentItem.isBold &&
                        item.isItalic === currentItem.isItalic &&
                        item.isUnderline === currentItem.isUnderline &&
                        item.startColor === currentItem.startColor && 
                        item.endColor === currentItem.endColor &&
                        JSON.stringify(item.colors) === JSON.stringify(currentItem.colors) &&
                        item.mode === currentItem.mode
                    );
                    
                    if (favoriteExistingIndex === -1) {
                        favorites.unshift(currentItem);
                    } else {
                        const favoriteItem = favorites.splice(favoriteExistingIndex, 1)[0];
                        favorites.unshift(favoriteItem);
                    }
                    
                    favoriteBtn.textContent = '★ 已收藏';
                    favoriteBtn.classList.add('favorited');
                    showNotification('已收藏');
                }
                
                localStorage.setItem('colorHistory', JSON.stringify(history));
                localStorage.setItem('colorFavorites', JSON.stringify(favorites));
                
                renderHistory();
                renderFavorites();
            }
            
            // 导入代码
            function importCode() {
                const code = importTextarea.value.trim();
                if (!code) {
                    showNotification('请输入要导入的代码！', 'error');
                    return;
                }
                
                try {
                    const isCustomModeCode = code.includes('<color=') && 
                                           (code.includes('</b>') || code.includes('</i>') || code.includes('</u>')) &&
                                           code.split('<color=').length > 3;
                    
                    const isCssGradient = code.includes('linear-gradient') || 
                                        code.includes('radial-gradient') ||
                                        code.includes('conic-gradient');
                    
                    if (isCustomModeCode) {
                        importModeButtons.forEach(btn => {
                            btn.classList.remove('active');
                            if (btn.dataset.mode === 'custom') {
                                btn.classList.add('active');
                            }
                        });
                        parseCustomModeCode(code);
                        importTextarea.value = '';
                        closeSidebar();
                        showNotification('导入成功！');
                        return;
                    } else if (isCssGradient) {
                        importModeButtons.forEach(btn => {
                            btn.classList.remove('active');
                            if (btn.dataset.mode === 'gradient') {
                                btn.classList.add('active');
                            }
                        });
                        parseCssGradientCode(code);
                        return;
                    } else {
                        // 渐变色代码模式
                        const sizeMatch = code.match(/<size=(\d+)>/);
                        if (sizeMatch) {
                            fontSizeInput.value = sizeMatch[1];
                        }
                        
                        const boldMatch = code.includes('<b>');
                        const italicMatch = code.includes('<i>');
                        const underlineMatch = code.includes('<u>');
                        boldCheckbox.checked = boldMatch;
                        italicCheckbox.checked = italicMatch;
                        underlineCheckbox.checked = underlineMatch;
                        customGlobalBoldCheckbox.checked = boldMatch;
                        customGlobalItalicCheckbox.checked = italicMatch;
                        customGlobalUnderlineCheckbox.checked = underlineMatch;
                        
                        const colorMatches = code.matchAll(/<color=([^>]+)>([^<]+)<\/color>/g);
                        let text = '';
                        let colors = [];
                        
                        for (const match of colorMatches) {
                            colors.push(match[1]);
                            text += match[2];
                        }
                        
                        if (text && colors.length > 0) {
                            textInput.value = text;
                            
                            const mainColors = analyzeGradientColors(colors);
                            
                            let targetMode = 'home';
                            if (mainColors.length === 2) {
                                targetMode = 'home';
                            } else if (mainColors.length === 3) {
                                targetMode = 'three';
                            } else if (mainColors.length === 4) {
                                targetMode = 'four';
                            } else if (mainColors.length === 5) {
                                targetMode = 'five';
                            } else if (mainColors.length === 6) {
                                targetMode = 'six';
                            } else if (mainColors.length === 7) {
                                targetMode = 'seven';
                            }
                            
                            switchMode(targetMode);
                    
                    // 更新颜色输入框的值，确保颜色设置模块中的颜色值与导入的颜色值一致
                    for (let i = 1; i <= customColorCount; i++) {
                        const colorInput = document.getElementById(`color${i}`);
                        const colorSwatch = document.getElementById(`color${i}Swatch`);
                        const colorCode = document.getElementById(`color${i}Code`);
                        
                        if (i <= mergedColorRows.length) {
                            const colorValue = mergedColorRows[i-1].color;
                            if (colorInput) colorInput.value = colorValue;
                            if (colorSwatch) colorSwatch.style.backgroundColor = colorValue;
                            if (colorCode) colorCode.value = colorValue.toUpperCase().replace('#', '');
                        }
                    }
                            
                            for (let i = 1; i <= 7; i++) {
                                const colorInput = document.getElementById(`color${i}`);
                                const colorSwatch = document.getElementById(`color${i}Swatch`);
                                const colorCode = document.getElementById(`color${i}Code`);
                                
                                if (i <= mainColors.length) {
                                    const colorValue = mainColors[i-1];
                                    if (colorInput) colorInput.value = colorValue;
                                    if (colorSwatch) colorSwatch.style.backgroundColor = colorValue;
                                    if (colorCode) colorCode.value = colorValue.toUpperCase().replace('#', '');
                                }
                            }
                            
                            updateColorPreview();
                            generateGradientCode();
                            updateAllPreviews();
                            addToHistory();
                            importTextarea.value = '';
                            closeSidebar();
                            showNotification(`导入成功！已切换到${getModeName(targetMode)}模式`);
                        } else {
                            showNotification('解析失败！', 'error');
                        }
                    }
                } catch (error) {
                    console.error('导入错误:', error);
                    showNotification('导入失败！', 'error');
                }
            }
            
            function analyzeGradientColors(colors) {
                if (colors.length <= 7) {
                    return colors;
                }
                
                const colorGroups = [];
                const threshold = 15;
                
                for (const color of colors) {
                    const rgb = hexToRgb(color);
                    let found = false;
                    
                    for (const group of colorGroups) {
                        const groupRgb = hexToRgb(group.color);
                        const diff = Math.abs(rgb.r - groupRgb.r) + 
                                    Math.abs(rgb.g - groupRgb.g) + 
                                    Math.abs(rgb.b - groupRgb.b);
                        
                        if (diff < threshold) {
                            group.count++;
                            group.color = color;
                            found = true;
                            break;
                        }
                    }
                    
                    if (!found) {
                        colorGroups.push({
                            color: color,
                            count: 1
                        });
                    }
                }
                
                colorGroups.sort((a, b) => b.count - a.count);
                
                let mainColors = colorGroups.slice(0, 7).map(g => g.color);
                
                if (mainColors.length < 2) {
                    return [colors[0], colors[colors.length - 1]];
                }
                
                return mainColors;
            }
            
            function parseCssGradientCode(code) {
                try {
                    const gradientMatch = code.match(/(?:linear|radial|conic)-gradient\s*\([^)]+\)/i);
                    if (!gradientMatch) {
                        showNotification('无法解析渐变格式！', 'error');
                        return;
                    }
                    
                    const gradient = gradientMatch[0];
                    const colorMatches = gradient.matchAll(/#([0-9A-Fa-f]{3,8})|rgb\([^)]+\)|rgba\([^)]+\)|hsl\([^)]+\)|hsla\([^)]+\)/gi);
                    const colors = [];
                    
                    for (const match of colorMatches) {
                        let color = match[0];
                        
                        if (color.startsWith('#')) {
                            colors.push(color.toUpperCase());
                        } else if (color.startsWith('rgb')) {
                            const rgbMatch = color.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/i) ||
                                             color.match(/rgba\((\d+),\s*(\d+),\s*(\d+),\s*[\d.]+\)/i);
                            if (rgbMatch) {
                                const r = parseInt(rgbMatch[1]);
                                const g = parseInt(rgbMatch[2]);
                                const b = parseInt(rgbMatch[3]);
                                colors.push(rgbToHex(r, g, b));
                            }
                        } else if (color.startsWith('hsl')) {
                            const hslMatch = color.match(/hsl\(([\d.]+),\s*([\d.]+)%,\s*([\d.]+)%\)/i) ||
                                             color.match(/hsla\(([\d.]+),\s*([\d.]+)%,\s*([\d.]+)%,\s*[\d.]+\)/i);
                            if (hslMatch) {
                                const h = parseFloat(hslMatch[1]);
                                const s = parseFloat(hslMatch[2]);
                                const l = parseFloat(hslMatch[3]);
                                const [r, g, b] = hslToRgb(h, s, l);
                                colors.push(rgbToHex(r, g, b));
                            }
                        }
                    }
                    
                    if (colors.length < 2) {
                        showNotification('渐变中至少需要2个颜色！', 'error');
                        return;
                    }
                    
                    const mainColors = analyzeGradientColors(colors);
                    
                    let targetMode = 'home';
                    if (mainColors.length === 2) {
                        targetMode = 'home';
                    } else if (mainColors.length === 3) {
                        targetMode = 'three';
                    } else if (mainColors.length === 4) {
                        targetMode = 'four';
                    } else if (mainColors.length === 5) {
                        targetMode = 'five';
                    } else if (mainColors.length === 6) {
                        targetMode = 'six';
                    } else if (mainColors.length === 7) {
                        targetMode = 'seven';
                    }
                    
                    switchMode(targetMode);
                    
                    for (let i = 1; i <= 7; i++) {
                        const colorInput = document.getElementById(`color${i}`);
                        const colorSwatch = document.getElementById(`color${i}Swatch`);
                        const colorCode = document.getElementById(`color${i}Code`);
                        
                        if (i <= mainColors.length) {
                            const colorValue = mainColors[i-1];
                            if (colorInput) colorInput.value = colorValue;
                            if (colorSwatch) colorSwatch.style.backgroundColor = colorValue;
                            if (colorCode) colorCode.value = colorValue.toUpperCase().replace('#', '');
                        }
                    }
                    
                    updateColorPreview();
                    generateGradientCode();
                    updateAllPreviews();
                    addToHistory();
                    importTextarea.value = '';
                    closeSidebar();
                    showNotification(`导入成功！已切换到${getModeName(targetMode)}模式`);
                } catch (error) {
                    console.error('CSS渐变解析错误:', error);
                    showNotification('解析失败！', 'error');
                }
            }
            
            function parseCustomModeCode(code) {
                try {
                    // 首先提取所有文本内容（用于计算位置）
                    let fullText = code.replace(/<[^>]+>/g, '');
                    textInput.value = fullText;
                    
                    // 暂时不切换模式，等待合并颜色后根据颜色数量自动切换
                    
                    // 清除现有格式范围
                    customBoldInput.value = '';
                    customItalicInput.value = '';
                    customUnderlineInput.value = '';
                    
                    // 解析并收集所有格式范围
                    const boldRanges = [];
                    const italicRanges = [];
                    const underlineRanges = [];
                    const sizeRanges = [];
                    
                    // 解析粗体
                    const boldRegex = /<b>(.*?)<\/b>/gs;
                    let boldMatch;
                    while ((boldMatch = boldRegex.exec(code)) !== null) {
                        const boldContent = boldMatch[0];
                        const boldText = boldContent.replace(/<[^>]+>/g, '');
                        // 找到这个粗体内容在原代码中的位置
                        const boldStartIndex = code.indexOf(boldContent, boldMatch.index);
                        // 计算这个粗体内容对应的文本在完整文本中的位置
                        const textBefore = code.substring(0, boldStartIndex).replace(/<[^>]+>/g, '');
                        const start = textBefore.length + 1;
                        const end = start + boldText.length - 1;
                        boldRanges.push(`${start}-${end}`);
                    }
                    
                    // 解析斜体
                    const italicRegex = /<i>(.*?)<\/i>/gs;
                    let italicMatch;
                    while ((italicMatch = italicRegex.exec(code)) !== null) {
                        const italicContent = italicMatch[0];
                        const italicText = italicContent.replace(/<[^>]+>/g, '');
                        const italicStartIndex = code.indexOf(italicContent, italicMatch.index);
                        const textBefore = code.substring(0, italicStartIndex).replace(/<[^>]+>/g, '');
                        const start = textBefore.length + 1;
                        const end = start + italicText.length - 1;
                        italicRanges.push(`${start}-${end}`);
                    }
                    
                    // 解析下划线
                    const underlineRegex = /<u>(.*?)<\/u>/gs;
                    let underlineMatch;
                    while ((underlineMatch = underlineRegex.exec(code)) !== null) {
                        const underlineContent = underlineMatch[0];
                        const underlineText = underlineContent.replace(/<[^>]+>/g, '');
                        const underlineStartIndex = code.indexOf(underlineContent, underlineMatch.index);
                        const textBefore = code.substring(0, underlineStartIndex).replace(/<[^>]+>/g, '');
                        const start = textBefore.length + 1;
                        const end = start + underlineText.length - 1;
                        underlineRanges.push(`${start}-${end}`);
                    }
                    
                    // 解析字体大小范围
                    const sizeRegex = /<size=(\d+)>(.*?)<\/size>/gs;
                    let sizeMatch;
                    while ((sizeMatch = sizeRegex.exec(code)) !== null) {
                        const fontSize = parseInt(sizeMatch[1]);
                        const sizeContent = sizeMatch[0];
                        const sizeText = sizeContent.replace(/<[^>]+>/g, '');
                        const sizeStartIndex = code.indexOf(sizeContent, sizeMatch.index);
                        const textBefore = code.substring(0, sizeStartIndex).replace(/<[^>]+>/g, '');
                        const start = textBefore.length + 1;
                        const end = start + sizeText.length - 1;
                        sizeRanges.push({
                            start: start,
                            end: end,
                            fontSize: fontSize
                        });
                    }
                    
                    // 设置格式范围
                    customBoldInput.value = boldRanges.join(',');
                    customItalicInput.value = italicRanges.join(',');
                    customUnderlineInput.value = underlineRanges.join(',');
                    
                    // 解析颜色代码
                    const nestedColorRegex = /<color=([^>]+)>(.*?)<\/color>/gs;
                    let match;
                    const colorSegments = [];
                    
                    while ((match = nestedColorRegex.exec(code)) !== null) {
                        const color = match[1];
                        const segmentContent = match[2];
                        const segmentText = segmentContent.replace(/<[^>]+>/g, '');
                        
                        // 找到这个颜色段在原代码中的位置
                        const segmentStartIndex = code.indexOf(match[0], match.index);
                        // 计算这个颜色段对应的文本在完整文本中的位置
                        const textBefore = code.substring(0, segmentStartIndex).replace(/<[^>]+>/g, '');
                        const start = textBefore.length + 1;
                        const end = start + segmentText.length - 1;
                        
                        // 查找这个颜色段对应的字体大小
                        let fontSize = 16; // 默认字体大小
                        for (const sizeRange of sizeRanges) {
                            if (start >= sizeRange.start && end <= sizeRange.end) {
                                fontSize = sizeRange.fontSize;
                                break;
                            }
                        }
                        
                        // 标准化颜色值（转换为大写）
                        const normalizedColor = color.toUpperCase();
                        
                        // 添加到颜色段
                        colorSegments.push({
                            start: start,
                            end: end,
                            color: normalizedColor,
                            fontSize: fontSize
                        });
                    }
                    
                    // 合并相同颜色的连续范围
                    const mergedColorRows = [];
                    for (let i = 0; i < colorSegments.length; i++) {
                        const current = colorSegments[i];
                        
                        // 检查是否可以与上一个合并
                        if (mergedColorRows.length > 0) {
                            const previous = mergedColorRows[mergedColorRows.length - 1];
                            
                            // 如果颜色相同、字体大小相同且范围连续
                            if (current.color === previous.color && 
                                current.fontSize === previous.fontSize &&
                                current.start === parseInt(previous.range.split('-')[1]) + 1) {
                                // 合并范围
                                previous.range = `${previous.range.split('-')[0]}-${current.end}`;
                                continue;
                            }
                        }
                        
                        // 添加新的颜色行
                        mergedColorRows.push({
                            range: `${current.start}-${current.end}`,
                            color: current.color,
                            fontSize: current.fontSize,
                            enabled: true // 添加enabled属性，确保预览时能正确显示颜色
                        });
                    }
                    
                    // 更新自定义颜色行数据和显示
                    customColorRowsData = mergedColorRows;
                    customColorCount = mergedColorRows.length;
                    renderCustomColorRows();
                    renderCustomColorRows2();
                    
                    // 保持在自定义模式
                    switchMode('custom');
                    
                    // 更新颜色输入框的值，确保颜色设置模块中的颜色值与导入的颜色值一致
                    for (let i = 1; i <= customColorCount; i++) {
                        const colorInput = document.getElementById(`color${i}`);
                        const colorSwatch = document.getElementById(`color${i}Swatch`);
                        const colorCode = document.getElementById(`color${i}Code`);
                        
                        if (i <= mergedColorRows.length) {
                            const colorValue = mergedColorRows[i-1].color;
                            if (colorInput) colorInput.value = colorValue;
                            if (colorSwatch) colorSwatch.style.backgroundColor = colorValue;
                            if (colorCode) colorCode.value = colorValue.toUpperCase().replace('#', '');
                        }
                    }
                    
                    updateRealTimePreview();
                    generateGradientCode();
                    showNotification('导入成功！');
                } catch (error) {
                    console.error('解析错误:', error);
                    showNotification('解析失败！', 'error');
                }
            }
            
            // 分享功能
            function shareTool() {
                const shareUrl = "https://mobinsll.github.io/tool/";
                
                const textArea = document.createElement("textarea");
                textArea.value = shareUrl;
                document.body.appendChild(textArea);
                textArea.select();
                textArea.setSelectionRange(0, 99999);
                
                try {
                    const successful = document.execCommand('copy');
                    if (successful) {
                        showNotification('复制成功！');
                    } else {
                        showNotification('复制失败！', 'error');
                    }
                } catch (err) {
                    console.error('复制失败: ', err);
                    showNotification('复制失败！', 'error');
                }
                
                document.body.removeChild(textArea);
            }
            
            // 显示通知 - 修改为0.5秒
            function showNotification(message, type = 'success') {
                notification.textContent = message;
                notification.className = 'notification';
                
                if (type === 'error') {
                    notification.style.background = '#ff4d4d';
                } else {
                    notification.style.background = '#2effa4';
                    notification.style.color = '#0d1b2a';
                }
                
                // 移除现有的类
                notification.classList.remove('show', 'hide');
                
                // 强制重绘
                notification.offsetHeight;
                
                // 显示通知
                notification.classList.add('show');
                
                // 0.5秒后开始隐藏动画
                setTimeout(() => {
                    notification.classList.remove('show');
                    notification.classList.add('hide');
                }, 500);
                
                // 完全移除元素
                setTimeout(() => {
                    notification.classList.remove('hide');
                }, 800);
            }
            
            // 随机配色
            function randomColors() {
                const mode = randomModeSelect.value;
                
                if (currentMode === 'custom') {
                    for (let i = 0; i < customColorCount; i++) {
                        const randomColor = generateRandomColorByMode(mode);
                        customColorRowsData[i].color = randomColor;
                    }
                    
                    renderCustomColorRows();
                    updateRealTimePreview();
                    updateCodeStatus();
                    generateGradientCode();
                    showNotification('自定颜色已随机更新');
                } else {
                    const colorCount = getColorCount();
                    const startColor = generateRandomColorByMode(mode);
                    const color1 = document.getElementById('color1');
                    const color1Swatch = document.getElementById('color1Swatch');
                    if (color1) {
                        color1.value = startColor;
                        if (color1Swatch) color1Swatch.style.backgroundColor = startColor;
                    }
                    
                    const endColor = generateRandomColorByMode(mode);
                    const color2 = document.getElementById('color2');
                    const color2Swatch = document.getElementById('color2Swatch');
                    if (color2) {
                        color2.value = endColor;
                        if (color2Swatch) color2Swatch.style.backgroundColor = endColor;
                    }
                    
                    if (colorCount > 2) {
                        for (let i = 3; i <= colorCount; i++) {
                            const randomColor = generateRandomColorByMode(mode);
                            const colorInput = document.getElementById(`color${i}`);
                            const colorSwatch = document.getElementById(`color${i}Swatch`);
                            
                            if (colorInput && colorSwatch) {
                                colorInput.value = randomColor;
                                colorSwatch.style.backgroundColor = randomColor;
                            }
                        }
                    }
                    
                    updateColorPreview();
                    resetFavoriteButton();
                    updateRealTimePreview();
                    updateCodeStatus();
                }
            }
            
            function generateRandomColorByMode(mode) {
                switch(mode) {
                    case 'random':
                        return getRandomColor();
                    case 'analogous':
                        return getRandomColor();
                    case 'light':
                        return getRandomLightColor();
                    case 'saturated':
                        return getRandomSaturatedColor();
                    default:
                        return getRandomColor();
                }
            }
            
            function getRandomColor() {
                return '#' + Math.floor(Math.random()*16777215).toString(16).toUpperCase().padStart(6, '0');
            }
            
            function getRandomLightColor() {
                const h = Math.random() * 360;
                const s = Math.random() * 30 + 70;
                const l = Math.random() * 30 + 70;
                
                const rgb = hslToRgb(h, s, l);
                return rgbToHex(rgb[0], rgb[1], rgb[2]);
            }
            
            function getRandomSaturatedColor() {
                const h = Math.random() * 360;
                const s = Math.random() * 30 + 70;
                const l = Math.random() * 30 + 35;
                
                const rgb = hslToRgb(h, s, l);
                return rgbToHex(rgb[0], rgb[1], rgb[2]);
            }
            
            function getColorCount() {
                return gradientColorCount;
            }
            
            // 更新所有预览
            function updateAllPreviews() {
                generateGradientCode();
                updateRealTimePreview();
                if (currentMode === 'home') {
                    for (let i = 1; i <= 3; i++) {
                        updateExamplePreview(i);
                    }
                }
            }
            
            // 文本全选
            function selectAllText(element) {
                const selection = window.getSelection();
                const range = document.createRange();
                range.selectNodeContents(element);
                selection.removeAllRanges();
                selection.addRange(range);
                
                element.classList.add('selected');
                
                setTimeout(() => {
                    element.classList.remove('selected');
                }, 1000);
            }
            
            // 侧边栏功能
            function openSidebar() {
                sidebar.classList.add('open');
                overlay.classList.add('show');
                document.body.style.overflow = 'hidden';
                showSidebarContent('mainMenu');
            }
            
            function closeSidebar() {
                sidebar.classList.remove('open');
                overlay.classList.remove('show');
                document.body.style.overflow = '';
            }
            
            function toggleSidebar() {
                if (sidebar.classList.contains('open')) {
                    closeSidebar();
                } else {
                    openSidebar();
                }
            }
            
            function showSidebarContent(contentId) {
                sidebarContents.forEach(content => {
                    content.classList.remove('active');
                });
                
                const targetContent = document.getElementById(contentId);
                if (targetContent) {
                    targetContent.classList.add('active');
                }
            }
            
            // 更多颜色模式面板功能
            function toggleMoreColorsPanel() {
                moreColorsPanel.classList.toggle('show');
            }
            
            function closeMoreColorsPanel() {
                moreColorsPanel.classList.remove('show');
            }
            
            // 切换模式
            function switchMode(mode) {
                currentMode = mode;
                isCustomMode = (mode === 'custom');
                
                moreColorsPanelBtns.forEach(btn => {
                    if (btn.dataset.mode === mode) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
                
                // 根据模式设置颜色数量
                if (mode === 'home') {
                    gradientColorCount = 2;
                } else if (mode === 'three') {
                    gradientColorCount = 3;
                } else if (mode === 'four') {
                    gradientColorCount = 4;
                } else if (mode === 'five') {
                    gradientColorCount = 5;
                } else if (mode === 'six') {
                    gradientColorCount = 6;
                } else if (mode === 'seven') {
                    gradientColorCount = 7;
                }
                
                // 更新颜色数量按钮状态
                gradientColorCountButtons.forEach(btn => {
                    if (parseInt(btn.getAttribute('data-count')) === gradientColorCount) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
                
                updatePageTitle();
                updateColorInputs();
                updateFontSettingsVisibility();
                updateExamplesVisibility();
                
                // 显示/隐藏渐变颜色数量选择器
                if (gradientColorCountSelector) {
                    gradientColorCountSelector.style.display = (mode === 'custom') ? 'none' : 'block';
                }
                
                // 显示/隐藏模式切换按钮（仅在自定义范围模式下显示）
                const modeToggleContainer = document.getElementById('modeToggleContainer');
                if (modeToggleContainer) {
                    modeToggleContainer.style.display = (mode === 'custom') ? 'flex' : 'none';
                }
                
                updateColorPreview();
                updateRealTimePreview();
                updateCodeStatus();
                closeMoreColorsPanel();
                showNotification(`已切换到${getModeName(mode)}模式`);
            }
            
            function getModeName(mode) {
                switch(mode) {
                    case 'home': return '二色';
                    case 'three': return '三色';
                    case 'four': return '四色';
                    case 'five': return '五色';
                    case 'six': return '六色';
                    case 'seven': return '七色';
                    case 'custom': return '自定义范围';
                    default: return '二色';
                }
            }
            
            function updatePageTitle() {
                if (currentMode === 'home') {
                    pageTitle.textContent = '渐变色个性签名生成器';
                    pageSubtitle.textContent = '仅用于《超自然行动组》游戏个性标签';
                } else if (currentMode === 'custom') {
                    pageTitle.textContent = '自定义范围签名';
                    pageSubtitle.textContent = '仅用于《超自然行动组》游戏个性标签';
                } else {
                    pageTitle.textContent = `${getModeName(currentMode)}签名`;
                    pageSubtitle.textContent = '仅用于《超自然行动组》游戏个性标签';
                }
            }
            
            // 更新颜色输入框
            function updateColorInputs() {
                if (currentMode === 'custom') {
                    colorInputsContainer.style.display = 'none';
                    colorPreview.style.display = 'none';
                    customModeContent.style.display = 'block';
                } else {
                    colorInputsContainer.style.display = 'block';
                    colorPreview.style.display = 'block';
                    customModeContent.style.display = 'none';
                    
                    // 先从DOM中更新持久化存储
                    for (let i = 1; i <= 7; i++) {
                        const colorInput = document.getElementById(`color${i}`);
                        if (colorInput) {
                            persistentColors[i] = colorInput.value;
                        }
                    }
                    
                    const colorCount = getColorCount();
                    let html = '<div class="color-inputs">';
                    
                    const colorsPerRow = 4;
                    let currentColorCount = 1; // 已经添加了起始颜色
                    
                    // 起始颜色
                    const color1Value = persistentColors[1] || '#2effa4';
                    html += `
                        <div class="color-input">
                            <div class="color-label">
                                起始：
                                <div class="color-swatch-container">
                                    <div class="color-swatch" id="color1Swatch" style="background-color: ${color1Value};">
                                        <input type="color" id="color1" value="${color1Value}">
                                    </div>
                                    <div class="color-code-with-history">
                            <input type="text" class="color-code-input" id="color1Code" value="${color1Value.replace('#', '')}" maxlength="6">
                        </div>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    if (colorCount > 2) {
                        for (let i = 3; i <= colorCount; i++) {
                            const colorValue = persistentColors[i] || getRandomColor();
                            currentColorCount++;
                            
                            html += `
                                <div class="color-input">
                                    <div class="color-label">
                                        颜色${i-1}：
                                        <div class="color-swatch-container">
                                            <div class="color-swatch" id="color${i}Swatch" style="background-color: ${colorValue};">
                                                <input type="color" id="color${i}" value="${colorValue}">
                                            </div>
                                            <div class="color-code-group">
                                        <input type="text" class="color-code-input" id="color${i}Code" value="${colorValue.replace('#', '')}" maxlength="6">
                                    </div>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }
                    }
                    
                    if (colorCount === 2) {
                        html += `
                            <div class="swap-colors-container">
                                <button class="swap-colors-btn" id="swapColorsBtn" title="互换起始和末尾">⇆</button>
                            </div>
                        `;
                    }
                    
                    // 末尾颜色
                    const color2Value = persistentColors[2] || '#3898ff';
                    currentColorCount++;
                    
                    html += `
                        <div class="color-input">
                            <div class="color-label">
                                末尾：
                                <div class="color-swatch-container">
                                    <div class="color-swatch" id="color2Swatch" style="background-color: ${color2Value};">
                                        <input type="color" id="color2" value="${color2Value}">
                                    </div>
                                    <div class="color-code-group">
                    <input type="text" class="color-code-input" id="color2Code" value="${color2Value.replace('#', '')}" maxlength="6">
                </div>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    html += '</div>';
                    
                    colorInputsContainer.innerHTML = html;
                    bindColorInputEvents();
                }
            }
            
            function updateFontSettingsVisibility() {
                if (currentMode === 'custom') {
                    gradientFontSettings.style.display = 'none';
                } else {
                    gradientFontSettings.style.display = 'flex';
                }
            }
            
            function updateExamplesVisibility() {
                if (currentMode === 'home') {
                    examplesSection.style.display = 'block';
                } else {
                    examplesSection.style.display = 'none';
                }
            }
            
            // 自定义范围功能
            // 模式切换和数据同步
            let currentModeView = 1; // 当前显示的模式页面（1或2）
            
            function initModeToggle() {
                const modeToggleBtn = document.getElementById('modeToggleBtn');
                const mode1 = document.getElementById('mode1');
                const mode2 = document.getElementById('mode2');
                const modeToggleContainer = document.getElementById('modeToggleContainer');
                
                if (modeToggleBtn) {
                    modeToggleBtn.addEventListener('click', function() {
                        if (currentModeView === 1) {
                            currentModeView = 2;
                            // 从数字模式切换到滑杆模式时，更新滑杆模式的渐变栏
                            renderGradientBars2();
                            // 添加平滑的切换动画
                            mode1.style.opacity = '0';
                            mode1.style.visibility = 'hidden';
                            setTimeout(() => {
                                mode1.style.display = 'none';
                                mode2.style.display = 'block';
                                setTimeout(() => {
                                    mode2.style.opacity = '1';
                                    mode2.style.visibility = 'visible';
                                }, 10);
                            }, 100);
                            modeToggleBtn.textContent = '切换到数字模式';
                            // 更新按钮样式
                            modeToggleBtn.classList.remove('digital-mode');
                            modeToggleBtn.classList.add('slider-mode');
                        } else {
                            currentModeView = 1;
                            // 从滑杆模式切换到数字模式时，更新数字模式的渐变栏
                            renderGradientBars();
                            // 添加平滑的切换动画
                            mode2.style.opacity = '0';
                            mode2.style.visibility = 'hidden';
                            setTimeout(() => {
                                mode2.style.display = 'none';
                                mode1.style.display = 'block';
                                setTimeout(() => {
                                    mode1.style.opacity = '1';
                                    mode1.style.visibility = 'visible';
                                }, 10);
                            }, 100);
                            modeToggleBtn.textContent = '切换到滑杆模式';
                            // 更新按钮样式
                            modeToggleBtn.classList.remove('slider-mode');
                            modeToggleBtn.classList.add('digital-mode');
                        }
                    });
                }
            }
            
            function initCustomMode() {
                // 初始化模式切换功能
                initModeToggle();
                
                // 设置默认3色，并根据图片中的示例数据设置默认值
                setCustomColorCount(3);
                
                // 设置默认样式数据（根据图片中的示例）- 数字模式
                customBoldCheckbox.checked = true;
                customBoldInput.value = '1-2,8-9';
                customItalicCheckbox.checked = true;
                customItalicInput.value = '6,13';
                customUnderlineCheckbox.checked = true;
                customUnderlineInput.value = '3-5,10-12';
                
                // 设置默认样式数据（根据图片中的示例）- 滑杆模式
                const customBoldCheckbox2 = document.getElementById('customBoldCheckbox2');
                const customItalicCheckbox2 = document.getElementById('customItalicCheckbox2');
                const customUnderlineCheckbox2 = document.getElementById('customUnderlineCheckbox2');
                
                if (customBoldCheckbox2) customBoldCheckbox2.checked = true;
                if (customItalicCheckbox2) customItalicCheckbox2.checked = true;
                if (customUnderlineCheckbox2) customUnderlineCheckbox2.checked = true;
                
                // 初始渲染两个模式的颜色行
                renderCustomColorRows();
                renderCustomColorRows2();
                
                // 绑定颜色设置容器的收起/展开功能（数字模式）
                const toggleColorBtn = document.getElementById('toggleColorBtn');
                const colorContent = document.getElementById('colorContent');
                if (toggleColorBtn && colorContent) {
                    toggleColorBtn.addEventListener('click', function() {
                        if (colorContent.style.display === 'none') {
                            colorContent.style.display = 'block';
                            toggleColorBtn.textContent = '▼';
                        } else {
                            colorContent.style.display = 'none';
                            toggleColorBtn.textContent = '▲';
                        }
                    });
                }
                
                // 绑定颜色设置容器的收起/展开功能（滑杆模式）
                const toggleColorBtn2 = document.getElementById('toggleColorBtn2');
                const colorContent2 = document.getElementById('colorContent2');
                if (toggleColorBtn2 && colorContent2) {
                    toggleColorBtn2.addEventListener('click', function() {
                        if (colorContent2.style.display === 'none') {
                            colorContent2.style.display = 'block';
                            toggleColorBtn2.textContent = '▼';
                        } else {
                            colorContent2.style.display = 'none';
                            toggleColorBtn2.textContent = '▲';
                        }
                    });
                }
                
                // 绑定颜色数量按钮事件（数字模式和滑杆模式共享）
                const allCustomColorCountButtons = document.querySelectorAll('.custom-color-count-btn');
                allCustomColorCountButtons.forEach(btn => {
                    btn.addEventListener('click', function() {
                        const count = parseInt(this.getAttribute('data-count'));
                        setCustomColorCount(count);
                    });
                });
                
                // 绑定颜色设置复选框事件（同时控制启用状态）- 数字模式
                const customColorCheckbox = document.getElementById('customColorCheckbox');
                if (customColorCheckbox) {
                    customColorCheckbox.addEventListener('change', function() {
                        const isEnabled = this.checked;
                        // 更新所有颜色行的启用状态
                        customColorRowsData.forEach(row => {
                            row.enabled = isEnabled;
                        });
                        
                        // 同步到滑杆模式
                        const customColorCheckbox2 = document.getElementById('customColorCheckbox2');
                        if (customColorCheckbox2) {
                            customColorCheckbox2.checked = isEnabled;
                        }
                        
                        // 自动展开/收起
                        if (isEnabled) {
                            colorContent.style.display = 'block';
                            toggleColorBtn.textContent = '▼';
                            if (colorContent2) colorContent2.style.display = 'block';
                            if (toggleColorBtn2) toggleColorBtn2.textContent = '▼';
                        } else {
                            colorContent.style.display = 'none';
                            toggleColorBtn.textContent = '▲';
                            if (colorContent2) colorContent2.style.display = 'none';
                            if (toggleColorBtn2) toggleColorBtn2.textContent = '▲';
                        }
                        
                        updateRealTimePreview();
                        generateGradientCode();
                    });
                }
                
                // 绑定颜色设置复选框事件（同时控制启用状态）- 滑杆模式
                const customColorCheckbox2 = document.getElementById('customColorCheckbox2');
                if (customColorCheckbox2) {
                    customColorCheckbox2.addEventListener('change', function() {
                        const isEnabled = this.checked;
                        // 更新所有颜色行的启用状态
                        customColorRowsData.forEach(row => {
                            row.enabled = isEnabled;
                        });
                        
                        // 同步到数字模式
                        if (customColorCheckbox) {
                            customColorCheckbox.checked = isEnabled;
                        }
                        
                        // 自动展开/收起
                        if (isEnabled) {
                            colorContent.style.display = 'block';
                            toggleColorBtn.textContent = '▼';
                            if (colorContent2) colorContent2.style.display = 'block';
                            if (toggleColorBtn2) toggleColorBtn2.textContent = '▼';
                        } else {
                            colorContent.style.display = 'none';
                            toggleColorBtn.textContent = '▲';
                            if (colorContent2) colorContent2.style.display = 'none';
                            if (toggleColorBtn2) toggleColorBtn2.textContent = '▲';
                        }
                        
                        updateRealTimePreview();
                        generateGradientCode();
                    });
                }
                
                // 绑定样式输入事件（数字模式）
                const styleInputs1 = [customBoldInput, customItalicInput, customUnderlineInput];
                const styleCheckboxes1 = [customBoldCheckbox, customItalicCheckbox, customUnderlineCheckbox];
                const styleCheckboxes2 = [document.getElementById('customBoldCheckbox2'), document.getElementById('customItalicCheckbox2'), document.getElementById('customUnderlineCheckbox2')];
                
                // 数字模式输入框事件
                styleInputs1.forEach((input, index) => {
                    if (input) {
                        input.addEventListener('input', function() {
                            let rangeValue = this.value;
                            rangeValue = rangeValue.replace(/[^\d\-,\s。，。]/g, '');
                            this.value = rangeValue;
                        });
                        input.addEventListener('change', function() {
                            // 同步到滑动范围选择器
                            const sliderIds = ['boldSlider2', 'italicSlider2', 'underlineSlider2'];
                            const sliderContainer = document.getElementById(sliderIds[index]);
                            if (sliderContainer && sliderContainer.slider) {
                                sliderContainer.slider.clearRanges();
                                const ranges = parseRangeStringToRanges(this.value);
                                ranges.forEach(range => {
                                    sliderContainer.slider.addRange(range.start, range.end);
                                });
                            }
                            updateRealTimePreview();
                            updateCodeStatus();
                            generateGradientCode();
                        });
                    }
                });
                
                // 数字模式复选框事件
                styleCheckboxes1.forEach((checkbox, index) => {
                    if (checkbox && styleCheckboxes2[index]) {
                        checkbox.addEventListener('change', function() {
                            styleCheckboxes2[index].checked = this.checked;
                            updateRealTimePreview();
                            generateGradientCode();
                        });
                    }
                });
                
                // 滑杆模式复选框事件
                styleCheckboxes2.forEach((checkbox, index) => {
                    if (checkbox && styleCheckboxes1[index]) {
                        checkbox.addEventListener('change', function() {
                            styleCheckboxes1[index].checked = this.checked;
                            updateRealTimePreview();
                            generateGradientCode();
                        });
                    }
                });
                
                // 初始化滑杆模式的滑动范围选择器
                const boldSlider2 = document.getElementById('boldSlider2');
                const italicSlider2 = document.getElementById('italicSlider2');
                const underlineSlider2 = document.getElementById('underlineSlider2');
                
                if (boldSlider2) {
                    boldSlider2.slider = new SliderRangeSelector('boldSlider2', {
                        maxValue: 20,
                        minValue: 1,
                        initialRanges: parseRangeStringToRanges('1-2,8-9'),
                        textElement: textInput,
                        enableCharWidthMode: true,
                        onRangeChange: (rangeString) => {
                            if (customBoldInput) {
                                customBoldInput.value = rangeString;
                            }
                            updateRealTimePreview();
                            generateGradientCode();
                        }
                    });
                }
                
                if (italicSlider2) {
                    italicSlider2.slider = new SliderRangeSelector('italicSlider2', {
                        maxValue: 20,
                        minValue: 1,
                        initialRanges: parseRangeStringToRanges('6,13'),
                        textElement: textInput,
                        enableCharWidthMode: true,
                        onRangeChange: (rangeString) => {
                            if (customItalicInput) {
                                customItalicInput.value = rangeString;
                            }
                            updateRealTimePreview();
                            generateGradientCode();
                        }
                    });
                }
                
                if (underlineSlider2) {
                    underlineSlider2.slider = new SliderRangeSelector('underlineSlider2', {
                        maxValue: 20,
                        minValue: 1,
                        initialRanges: parseRangeStringToRanges('3-5,10-12'),
                        textElement: textInput,
                        enableCharWidthMode: true,
                        onRangeChange: (rangeString) => {
                            if (customUnderlineInput) {
                                customUnderlineInput.value = rangeString;
                            }
                            updateRealTimePreview();
                            generateGradientCode();
                        }
                    });
                }
                
                // 监听文本输入框变化，更新滑杆的字符位置
                textInput.addEventListener('input', function() {
                    if (boldSlider2 && boldSlider2.slider) {
                        boldSlider2.slider.updateCharPositions();
                    }
                    if (italicSlider2 && italicSlider2.slider) {
                        italicSlider2.slider.updateCharPositions();
                    }
                    if (underlineSlider2 && underlineSlider2.slider) {
                        underlineSlider2.slider.updateCharPositions();
                    }
                });
                
                // 监听字体大小变化，更新滑杆的字符位置
                const fontSizeInput = document.getElementById('fontSize');
                if (fontSizeInput) {
                    fontSizeInput.addEventListener('input', function() {
                        if (boldSlider2 && boldSlider2.slider) {
                            boldSlider2.slider.updateCharPositions();
                        }
                        if (italicSlider2 && italicSlider2.slider) {
                            italicSlider2.slider.updateCharPositions();
                        }
                        if (underlineSlider2 && underlineSlider2.slider) {
                            underlineSlider2.slider.updateCharPositions();
                        }
                    });
                }
                


            // 调整字体大小的函数
            // 全局样式复选框同步（数字模式和滑杆模式）
            const globalCheckboxes1 = [customGlobalBoldCheckbox, customGlobalItalicCheckbox, customGlobalUnderlineCheckbox];
            const globalCheckboxes2 = [document.getElementById('customGlobalBoldCheckbox2'), document.getElementById('customGlobalItalicCheckbox2'), document.getElementById('customGlobalUnderlineCheckbox2')];
            
            globalCheckboxes1.forEach((checkbox, index) => {
                if (checkbox && globalCheckboxes2[index]) {
                    checkbox.addEventListener('change', function() {
                        globalCheckboxes2[index].checked = this.checked;
                        updateRealTimePreview();
                        generateGradientCode();
                    });
                }
            });
            
            globalCheckboxes2.forEach((checkbox, index) => {
                if (checkbox && globalCheckboxes1[index]) {
                    checkbox.addEventListener('change', function() {
                        globalCheckboxes1[index].checked = this.checked;
                        updateRealTimePreview();
                        generateGradientCode();
                    });
                }
            });
                
                // 初始化渐变功能（数字模式）
            initGradientFunctionality();
            
            // 初始化渐变功能（滑杆模式）
            initGradientFunctionality2();
            
            // 初始化样式功能（数字模式）
            initStyleFunctionality();
            
            // 初始化样式功能（滑杆模式）
            initStyleFunctionality2();
            
            // 初始化渐变颜色数量选择器
            initGradientColorCountSelector();
            
            // 初始化导入模式选择器
                initImportModeSelector();
            }
            
            // 初始化渐变功能（滑杆模式）
            function initGradientFunctionality2() {
                const toggleGradientBtn2 = document.getElementById('toggleGradientBtn2');
                const gradientContent2 = document.getElementById('gradientContent2');
                const customGradientCheckbox2 = document.getElementById('customGradientCheckbox2');
                const gradientBars2 = document.getElementById('gradientBars2');
                
                // 渐变展开/收起切换
                if (toggleGradientBtn2 && gradientContent2) {
                    toggleGradientBtn2.addEventListener('click', function() {
                        if (gradientContent2.style.display === 'none') {
                            gradientContent2.style.display = 'block';
                            toggleGradientBtn2.textContent = '▼';
                        } else {
                            gradientContent2.style.display = 'none';
                            toggleGradientBtn2.textContent = '▲';
                        }
                    });
                }
                
                // 渐变复选框事件（滑杆模式）
                if (customGradientCheckbox2) {
                    customGradientCheckbox2.addEventListener('change', function() {
                        const isEnabled = this.checked;
                        
                        // 同步到数字模式
                        const customGradientCheckbox = document.getElementById('customGradientCheckbox');
                        if (customGradientCheckbox) {
                            customGradientCheckbox.checked = isEnabled;
                        }
                        
                        // 自动展开/收起
                        if (isEnabled) {
                            gradientContent2.style.display = 'block';
                            toggleGradientBtn2.textContent = '▼';
                            const gradientContent = document.getElementById('gradientContent');
                            const toggleGradientBtn = document.getElementById('toggleGradientBtn');
                            if (gradientContent) gradientContent.style.display = 'block';
                            if (toggleGradientBtn) toggleGradientBtn.textContent = '▼';
                        } else {
                            gradientContent2.style.display = 'none';
                            toggleGradientBtn2.textContent = '▲';
                            const gradientContent = document.getElementById('gradientContent');
                            const toggleGradientBtn = document.getElementById('toggleGradientBtn');
                            if (gradientContent) gradientContent.style.display = 'none';
                            if (toggleGradientBtn) toggleGradientBtn.textContent = '▲';
                        }
                        
                        updateRealTimePreview();
                        updateCodeStatus();
                        generateGradientCode();
                    });
                }
                
                // 渐变数量选择按钮（滑杆模式）
                const gradientCountButtons2 = document.querySelectorAll('#mode2 .gradient-count-btn');
                gradientCountButtons2.forEach(btn => {
                    btn.addEventListener('click', function() {
                        const count = parseInt(this.getAttribute('data-count'));
                        setCustomGradientCount(count);
                    });
                });
                
                // 初始渲染渐变栏（滑杆模式）
                renderGradientBars2();
            }
            
            // 渲染渐变栏（滑杆模式）
            function renderGradientBars2() {
                const gradientBars2 = document.getElementById('gradientBars2');
                if (!gradientBars2) return;
                
                gradientBars2.innerHTML = '';
                
                for (let i = 0; i < customGradientCount; i++) {
                    const gradientData = customGradientData[i] || { range: '', startColor: '#2effa4', endColor: '#3898ff' };
                    const gradientIndex = i + 1;
                    
                    const gradientBar = document.createElement('div');
                    
                    // 1渐变模式使用特殊布局
                    if (customGradientCount === 1 && i === 0) {
                        gradientBar.className = 'custom-color-row full-width';
                        
                        gradientBar.innerHTML = `
                            <div class="custom-color-row-line">
                                <div class="slider-range-container" id="gradientRangeSlider2_${gradientIndex}"></div>
                            </div>
                            <div class="custom-color-row-line">
                                <div class="gradient-preview-container">
                                    <div class="gradient-preview-bar" id="gradientPreview2_${gradientIndex}" style="background: linear-gradient(to right, ${gradientData.startColor}, ${gradientData.endColor});"></div>
                                </div>
                            </div>
                            <div class="color-inputs-row">
                                <div class="custom-color-input-group">
                                    <label>起始：</label>
                                    <div class="color-swatch-container">
                                        <div class="custom-color-swatch" id="gradientStartColorSwatch2_${gradientIndex}" style="background-color: ${gradientData.startColor};">
                                            <input type="color" id="gradientStartColor2_${gradientIndex}" value="${gradientData.startColor}">
                                        </div>
                                        <input type="text" class="color-code-input" id="gradientStartColorCode2_${gradientIndex}" value="${gradientData.startColor.toUpperCase().replace('#', '')}" maxlength="6">
                                    </div>
                                </div>
                                <div class="custom-color-input-group">
                                    <label>末尾：</label>
                                    <div class="color-swatch-container">
                                        <div class="custom-color-swatch" id="gradientEndColorSwatch2_${gradientIndex}" style="background-color: ${gradientData.endColor};">
                                            <input type="color" id="gradientEndColor2_${gradientIndex}" value="${gradientData.endColor}">
                                        </div>
                                        <input type="text" class="color-code-input" id="gradientEndColorCode2_${gradientIndex}" value="${gradientData.endColor.toUpperCase().replace('#', '')}" maxlength="6">
                                    </div>
                                </div>
                            </div>
                        `;
                    } else {
                        gradientBar.className = 'custom-color-row';
                        
                        gradientBar.innerHTML = `
                            <div class="custom-color-row-line">
                                <div class="slider-range-container" id="gradientRangeSlider2_${gradientIndex}"></div>
                            </div>
                            <div class="custom-color-row-line">
                                <div class="gradient-preview-container">
                                    <div class="gradient-preview-bar" id="gradientPreview2_${gradientIndex}" style="background: linear-gradient(to right, ${gradientData.startColor}, ${gradientData.endColor});"></div>
                                </div>
                            </div>
                            <div class="custom-color-row-line">
                                <div class="custom-color-input-group">
                                    <label>起始：</label>
                                    <div class="color-swatch-container">
                                        <div class="custom-color-swatch" id="gradientStartColorSwatch2_${gradientIndex}" style="background-color: ${gradientData.startColor};">
                                            <input type="color" id="gradientStartColor2_${gradientIndex}" value="${gradientData.startColor}">
                                        </div>
                                        <input type="text" class="color-code-input" id="gradientStartColorCode2_${gradientIndex}" value="${gradientData.startColor.toUpperCase().replace('#', '')}" maxlength="6">
                                    </div>
                                </div>
                            </div>
                            <div class="custom-color-row-line">
                                <div class="custom-color-input-group">
                                    <label>末尾：</label>
                                    <div class="color-swatch-container">
                                        <div class="custom-color-swatch" id="gradientEndColorSwatch2_${gradientIndex}" style="background-color: ${gradientData.endColor};">
                                            <input type="color" id="gradientEndColor2_${gradientIndex}" value="${gradientData.endColor}">
                                        </div>
                                        <input type="text" class="color-code-input" id="gradientEndColorCode2_${gradientIndex}" value="${gradientData.endColor.toUpperCase().replace('#', '')}" maxlength="6">
                                    </div>
                                </div>
                            </div>
                        `;
                    }
                    
                    gradientBars2.appendChild(gradientBar);
                    
                    // 绑定事件（滑杆模式）
                    const startColorInput = document.getElementById(`gradientStartColor2_${gradientIndex}`);
                    const endColorInput = document.getElementById(`gradientEndColor2_${gradientIndex}`);
                    const startColorSwatch = document.getElementById(`gradientStartColorSwatch2_${gradientIndex}`);
                    const endColorSwatch = document.getElementById(`gradientEndColorSwatch2_${gradientIndex}`);
                    const startColorCodeInput = document.getElementById(`gradientStartColorCode2_${gradientIndex}`);
                    const endColorCodeInput = document.getElementById(`gradientEndColorCode2_${gradientIndex}`);
                    
                    // 初始化滑动范围选择器
                    const sliderContainer = document.getElementById(`gradientRangeSlider2_${gradientIndex}`);
                    if (sliderContainer) {
                        sliderContainer.slider = new SliderRangeSelector(`gradientRangeSlider2_${gradientIndex}`, {
                            maxValue: 20,
                            minValue: 1,
                            initialRanges: gradientData.range ? parseRangeStringToRanges(gradientData.range) : [],
                            textElement: textInput,
                            enableCharWidthMode: true,
                            onRangeChange: (rangeString) => {
                                customGradientData[i].range = rangeString;
                                // 同步到数字模式
                                const rangeInput1 = document.getElementById(`gradientRange${gradientIndex}`);
                                if (rangeInput1) rangeInput1.value = rangeString;
                                updateRealTimePreview();
                                updateCodeStatus();
                                generateGradientCode();
                            }
                        });
                    }
                    
                    // 监听文本输入框变化，更新渐变滑杆的字符位置
                    textInput.addEventListener('input', function() {
                        const sliderContainer = document.getElementById(`gradientRangeSlider2_${gradientIndex}`);
                        if (sliderContainer && sliderContainer.slider) {
                            sliderContainer.slider.updateCharPositions();
                        }
                    });
                    
                    // 监听字体大小变化，更新渐变滑杆的字符位置
                    const globalFontSizeInput = document.getElementById('fontSize');
                    if (globalFontSizeInput) {
                        globalFontSizeInput.addEventListener('input', function() {
                            const sliderContainer = document.getElementById(`gradientRangeSlider2_${gradientIndex}`);
                            if (sliderContainer && sliderContainer.slider) {
                                sliderContainer.slider.updateCharPositions();
                            }
                        });
                    }
                    
                    // 起始输入事件
                    if (startColorInput) {
                        startColorInput.addEventListener('input', function(e) {
                            customGradientData[i].startColor = e.target.value;
                            startColorSwatch.style.backgroundColor = e.target.value;
                            startColorCodeInput.value = e.target.value.toUpperCase();
                            // 同步到数字模式
                            const startColorInput1 = document.getElementById(`gradientStartColor${gradientIndex}`);
                            const startColorSwatch1 = document.getElementById(`gradientStartColorSwatch${gradientIndex}`);
                            const startColorCodeInput1 = document.getElementById(`gradientStartColorCode${gradientIndex}`);
                            if (startColorInput1) startColorInput1.value = e.target.value;
                            if (startColorSwatch1) startColorSwatch1.style.backgroundColor = e.target.value;
                            if (startColorCodeInput1) startColorCodeInput1.value = e.target.value.toUpperCase();
                            updateGradientPreview2(i + 1);
                            updateRealTimePreview();
                            updateCodeStatus();
                            generateGradientCode();
                        });
                    }
                    
                    // 末尾输入事件
                    if (endColorInput) {
                        endColorInput.addEventListener('input', function(e) {
                            customGradientData[i].endColor = e.target.value;
                            endColorSwatch.style.backgroundColor = e.target.value;
                            endColorCodeInput.value = e.target.value.toUpperCase();
                            // 同步到数字模式
                            const endColorInput1 = document.getElementById(`gradientEndColor${gradientIndex}`);
                            const endColorSwatch1 = document.getElementById(`gradientEndColorSwatch${gradientIndex}`);
                            const endColorCodeInput1 = document.getElementById(`gradientEndColorCode${gradientIndex}`);
                            if (endColorInput1) endColorInput1.value = e.target.value;
                            if (endColorSwatch1) endColorSwatch1.style.backgroundColor = e.target.value;
                            if (endColorCodeInput1) endColorCodeInput1.value = e.target.value.toUpperCase();
                            updateGradientPreview2(i + 1);
                            updateRealTimePreview();
                            updateCodeStatus();
                            generateGradientCode();
                        });
                    }
                    
                    // 起始代码输入事件
                    if (startColorCodeInput) {
                        startColorCodeInput.addEventListener('input', function(e) {
                            if (this.value) {
                                let colorValue = this.value;
                                if (!colorValue.startsWith('#')) {
                                    colorValue = '#' + colorValue;
                                }
                                if (/^#[0-9A-Fa-f]{6}$/.test(colorValue) || /^#[0-9A-Fa-f]{3}$/.test(colorValue)) {
                                    customGradientData[i].startColor = colorValue;
                                    startColorSwatch.style.backgroundColor = colorValue;
                                    startColorInput.value = colorValue;
                                    this.value = colorValue.toUpperCase();
                                    // 同步到数字模式
                                    const startColorCodeInput1 = document.getElementById(`gradientStartColorCode${gradientIndex}`);
                                    if (startColorCodeInput1) startColorCodeInput1.value = colorValue.toUpperCase();
                                    updateGradientPreview2(i + 1);
                                    updateRealTimePreview();
                                    updateCodeStatus();
                                    generateGradientCode();
                                }
                            }
                        });
                    }
                    
                    // 末尾代码输入事件
                    if (endColorCodeInput) {
                        endColorCodeInput.addEventListener('input', function(e) {
                            if (this.value) {
                                let colorValue = this.value;
                                if (!colorValue.startsWith('#')) {
                                    colorValue = '#' + colorValue;
                                }
                                if (/^#[0-9A-Fa-f]{6}$/.test(colorValue) || /^#[0-9A-Fa-f]{3}$/.test(colorValue)) {
                                    customGradientData[i].endColor = colorValue;
                                    endColorSwatch.style.backgroundColor = colorValue;
                                    endColorInput.value = colorValue;
                                    this.value = colorValue.toUpperCase();
                                    // 同步到数字模式
                                    const endColorCodeInput1 = document.getElementById(`gradientEndColorCode${gradientIndex}`);
                                    if (endColorCodeInput1) endColorCodeInput1.value = colorValue.toUpperCase();
                                    updateGradientPreview2(i + 1);
                                    updateRealTimePreview();
                                    updateCodeStatus();
                                    generateGradientCode();
                                }
                            }
                        });
                    }
                }
            }
            
            // 更新渐变预览（滑杆模式）
            function updateGradientPreview2(gradientIndex) {
                const gradientPreview = document.getElementById(`gradientPreview2_${gradientIndex}`);
                if (gradientPreview) {
                    const gradientData = customGradientData[gradientIndex - 1];
                    if (gradientData) {
                        gradientPreview.style.background = `linear-gradient(to right, ${gradientData.startColor}, ${gradientData.endColor})`;
                    }
                }
                
                // 同步更新数字模式的渐变预览
                const gradientPreview1 = document.getElementById(`gradientPreview${gradientIndex}`);
                if (gradientPreview1) {
                    const gradientData = customGradientData[gradientIndex - 1];
                    if (gradientData) {
                        gradientPreview1.style.background = `linear-gradient(to right, ${gradientData.startColor}, ${gradientData.endColor})`;
                    }
                }
            }
            
            // 初始化渐变颜色数量选择器
            function initGradientColorCountSelector() {
                gradientColorCountButtons.forEach(btn => {
                    btn.addEventListener('click', function() {
                        const count = parseInt(this.getAttribute('data-count'));
                        setGradientColorCount(count);
                    });
                });
            }
            
            // 设置渐变颜色数量
            function setGradientColorCount(count) {
                gradientColorCount = count;
                
                gradientColorCountButtons.forEach(btn => {
                    if (parseInt(btn.getAttribute('data-count')) === count) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
                
                updateColorInputs();
                updateColorPreview();
                updateRealTimePreview();
                updateCodeStatus();
                generateGradientCode();
            }
            
            // 初始化样式功能
            function initStyleFunctionality() {
                const toggleStyleBtn = document.getElementById('toggleStyleBtn');
                const styleContent = document.getElementById('styleContent');
                
                // 样式展开/收起切换
                if (toggleStyleBtn && styleContent) {
                    toggleStyleBtn.addEventListener('click', function() {
                        if (styleContent.style.display === 'none') {
                            styleContent.style.display = 'flex';
                            toggleStyleBtn.textContent = '▼';
                        } else {
                            styleContent.style.display = 'none';
                            toggleStyleBtn.textContent = '▲';
                        }
                    });
                }
            }
            
            // 初始化样式功能（滑杆模式）
            function initStyleFunctionality2() {
                const toggleStyleBtn2 = document.getElementById('toggleStyleBtn2');
                const styleContent2 = document.getElementById('styleContent2');
                const customStyleCheckbox2 = document.getElementById('customStyleCheckbox2');
                
                // 样式展开/收起切换
                if (toggleStyleBtn2 && styleContent2) {
                    toggleStyleBtn2.addEventListener('click', function() {
                        if (styleContent2.style.display === 'none') {
                            styleContent2.style.display = 'flex';
                            toggleStyleBtn2.textContent = '▼';
                        } else {
                            styleContent2.style.display = 'none';
                            toggleStyleBtn2.textContent = '▲';
                        }
                    });
                }
                
                // 样式复选框事件（滑杆模式）
                if (customStyleCheckbox2) {
                    customStyleCheckbox2.addEventListener('change', function() {
                        const isEnabled = this.checked;
                        
                        // 同步到数字模式
                        const customStyleCheckbox = document.getElementById('customStyleCheckbox');
                        if (customStyleCheckbox) {
                            customStyleCheckbox.checked = isEnabled;
                        }
                        
                        // 自动展开/收起
                        if (isEnabled) {
                            styleContent2.style.display = 'flex';
                            toggleStyleBtn2.textContent = '▼';
                        } else {
                            styleContent2.style.display = 'none';
                            toggleStyleBtn2.textContent = '▲';
                        }
                        
                        updateRealTimePreview();
                    });
                }
            }
            
            // 初始化渐变功能
            function initGradientFunctionality() {
                // 渐变展开/收起切换
                toggleGradientBtn.addEventListener('click', function() {
                    if (gradientContent.style.display === 'none') {
                        gradientContent.style.display = 'block';
                        toggleGradientBtn.textContent = '▼';
                    } else {
                        gradientContent.style.display = 'none';
                        toggleGradientBtn.textContent = '▲';
                    }
                });
                
                // 渐变复选框事件
                customGradientCheckbox.addEventListener('change', function() {
                    const isEnabled = this.checked;
                    
                    // 同步到滑杆模式
                    const customGradientCheckbox2 = document.getElementById('customGradientCheckbox2');
                    if (customGradientCheckbox2) {
                        customGradientCheckbox2.checked = isEnabled;
                    }
                    
                    // 自动展开/收起
                    if (isEnabled) {
                        gradientContent.style.display = 'block';
                        toggleGradientBtn.textContent = '▼';
                        const gradientContent2 = document.getElementById('gradientContent2');
                        const toggleGradientBtn2 = document.getElementById('toggleGradientBtn2');
                        if (gradientContent2) gradientContent2.style.display = 'block';
                        if (toggleGradientBtn2) toggleGradientBtn2.textContent = '▼';
                    } else {
                        gradientContent.style.display = 'none';
                        toggleGradientBtn.textContent = '▲';
                        const gradientContent2 = document.getElementById('gradientContent2');
                        const toggleGradientBtn2 = document.getElementById('toggleGradientBtn2');
                        if (gradientContent2) gradientContent2.style.display = 'none';
                        if (toggleGradientBtn2) toggleGradientBtn2.textContent = '▲';
                    }
                    
                    updateRealTimePreview();
                    updateCodeStatus();
                    generateGradientCode();
                });
                
                // 渐变数量选择按钮
                const gradientCountButtons = document.querySelectorAll('.gradient-count-btn');
                gradientCountButtons.forEach(btn => {
                    btn.addEventListener('click', function() {
                        const count = parseInt(this.getAttribute('data-count'));
                        setCustomGradientCount(count);
                    });
                });
                
                // 初始渲染渐变栏
                renderGradientBars();
            }
            
            // 更新渐变预览
            function updateGradientPreview(gradientIndex) {
                const gradientPreview = document.getElementById(`gradientPreview${gradientIndex}`);
                if (gradientPreview) {
                    const gradientData = customGradientData[gradientIndex - 1];
                    if (gradientData) {
                        gradientPreview.style.background = `linear-gradient(to right, ${gradientData.startColor}, ${gradientData.endColor})`;
                    }
                }
                
                // 同步更新滑杆模式的渐变预览
                const gradientPreview2 = document.getElementById(`gradientPreview2_${gradientIndex}`);
                if (gradientPreview2) {
                    const gradientData = customGradientData[gradientIndex - 1];
                    if (gradientData) {
                        gradientPreview2.style.background = `linear-gradient(to right, ${gradientData.startColor}, ${gradientData.endColor})`;
                    }
                }
            }
            
            // 设置渐变数量
            function setCustomGradientCount(count) {
                customGradientCount = count;
                
                const gradientCountButtons = document.querySelectorAll('.gradient-count-btn');
                gradientCountButtons.forEach(btn => {
                    if (parseInt(btn.getAttribute('data-count')) === count) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
                
                renderGradientBars();
                renderGradientBars2();
                updateRealTimePreview();
                updateCodeStatus();
                generateGradientCode();
            }
            
            // 渲染渐变栏
            function renderGradientBars() {
                gradientBars.innerHTML = '';
                
                for (let i = 0; i < customGradientCount; i++) {
                    const gradientData = customGradientData[i] || { range: '', startColor: '#2effa4', endColor: '#3898ff' };
                    const gradientIndex = i + 1;
                    
                    const gradientBar = document.createElement('div');
                    
                    // 1渐变模式使用特殊布局
                    if (customGradientCount === 1 && i === 0) {
                        gradientBar.className = 'custom-color-row full-width';
                        
                        gradientBar.innerHTML = `
                            <div class="custom-color-row-line">
                                <div class="custom-color-input-group range-group">
                                    <label>范围：</label>
                                    <textarea class="custom-color-range-input" 
                                           id="gradientRange${gradientIndex}" 
                                           placeholder="例如：1-7" 
                                           rows="2">${gradientData.range || ''}</textarea>
                                </div>
                            </div>
                            <div class="custom-color-row-line">
                                <div class="gradient-preview-container">
                                    <div class="gradient-preview-bar" id="gradientPreview${gradientIndex}" style="background: linear-gradient(to right, ${gradientData.startColor}, ${gradientData.endColor});"></div>
                                </div>
                            </div>
                            <div class="color-inputs-row">
                                <div class="custom-color-input-group">
                                    <label>起始：</label>
                                    <div class="color-swatch-container">
                                        <div class="custom-color-swatch" id="gradientStartColorSwatch${gradientIndex}" style="background-color: ${gradientData.startColor};">
                                            <input type="color" id="gradientStartColor${gradientIndex}" value="${gradientData.startColor}">
                                        </div>
                                        <input type="text" class="color-code-input" id="gradientStartColorCode${gradientIndex}" value="${gradientData.startColor.toUpperCase().replace('#', '')}" maxlength="6">
                                    </div>
                                </div>
                                <div class="custom-color-input-group">
                                    <label>末尾：</label>
                                    <div class="color-swatch-container">
                                        <div class="custom-color-swatch" id="gradientEndColorSwatch${gradientIndex}" style="background-color: ${gradientData.endColor};">
                                            <input type="color" id="gradientEndColor${gradientIndex}" value="${gradientData.endColor}">
                                        </div>
                                        <input type="text" class="color-code-input" id="gradientEndColorCode${gradientIndex}" value="${gradientData.endColor.toUpperCase().replace('#', '')}" maxlength="6">
                                    </div>
                                </div>
                            </div>
                        `;
                    } else {
                        gradientBar.className = 'custom-color-row';
                        
                        gradientBar.innerHTML = `
                            <div class="custom-color-row-line">
                                <div class="custom-color-input-group range-group">
                                    <label>范围：</label>
                                    <textarea class="custom-color-range-input" 
                                           id="gradientRange${gradientIndex}" 
                                           placeholder="例如：1-7" 
                                           rows="2">${gradientData.range || ''}</textarea>
                                </div>
                            </div>
                            <div class="custom-color-row-line">
                                <div class="gradient-preview-container">
                                    <div class="gradient-preview-bar" id="gradientPreview${gradientIndex}" style="background: linear-gradient(to right, ${gradientData.startColor}, ${gradientData.endColor});"></div>
                                </div>
                            </div>
                            <div class="custom-color-row-line">
                                <div class="custom-color-input-group">
                                    <label>起始：</label>
                                    <div class="color-swatch-container">
                                        <div class="custom-color-swatch" id="gradientStartColorSwatch${gradientIndex}" style="background-color: ${gradientData.startColor};">
                                            <input type="color" id="gradientStartColor${gradientIndex}" value="${gradientData.startColor}">
                                        </div>
                                        <input type="text" class="color-code-input" id="gradientStartColorCode${gradientIndex}" value="${gradientData.startColor.toUpperCase().replace('#', '')}" maxlength="6">
                                    </div>
                                </div>
                            </div>
                            <div class="custom-color-row-line">
                                <div class="custom-color-input-group">
                                    <label>末尾：</label>
                                    <div class="color-swatch-container">
                                        <div class="custom-color-swatch" id="gradientEndColorSwatch${gradientIndex}" style="background-color: ${gradientData.endColor};">
                                            <input type="color" id="gradientEndColor${gradientIndex}" value="${gradientData.endColor}">
                                        </div>
                                        <input type="text" class="color-code-input" id="gradientEndColorCode${gradientIndex}" value="${gradientData.endColor.toUpperCase().replace('#', '')}" maxlength="6">
                                    </div>
                                </div>
                            </div>
                        `;
                    }
                    
                    gradientBars.appendChild(gradientBar);
                    
                    // 绑定事件
                    const rangeInput = document.getElementById(`gradientRange${gradientIndex}`);
                    const startColorInput = document.getElementById(`gradientStartColor${gradientIndex}`);
                    const endColorInput = document.getElementById(`gradientEndColor${gradientIndex}`);
                    const startColorSwatch = document.getElementById(`gradientStartColorSwatch${gradientIndex}`);
                    const endColorSwatch = document.getElementById(`gradientEndColorSwatch${gradientIndex}`);
                    const startColorCodeInput = document.getElementById(`gradientStartColorCode${gradientIndex}`);
                    const endColorCodeInput = document.getElementById(`gradientEndColorCode${gradientIndex}`);
                    
                    // 范围输入事件
                    rangeInput.addEventListener('input', function() {
                        let rangeValue = this.value;
                        rangeValue = rangeValue.replace(/[^\d\-,\s。，。]/g, '');
                        this.value = rangeValue;
                        customGradientData[i].range = this.value;
                        // 同步到滑杆模式
                        const sliderContainer = document.getElementById(`gradientRangeSlider2_${gradientIndex}`);
                        if (sliderContainer && sliderContainer.slider) {
                            sliderContainer.slider.clearRanges();
                            const ranges = parseRangeStringToRanges(this.value);
                            ranges.forEach(range => {
                                sliderContainer.slider.addRange(range.start, range.end);
                            });
                        }
                        updateRealTimePreview();
                        updateCodeStatus();
                        generateGradientCode();
                    });
                    
                    // 起始输入事件
                    startColorInput.addEventListener('input', function(e) {
                        customGradientData[i].startColor = e.target.value;
                        startColorSwatch.style.backgroundColor = e.target.value;
                        startColorCodeInput.value = e.target.value.toUpperCase();
                        updateGradientPreview(i + 1);
                        updateRealTimePreview();
                        updateCodeStatus();
                        generateGradientCode();
                    });
                    
                    // 末尾输入事件
                    endColorInput.addEventListener('input', function(e) {
                        customGradientData[i].endColor = e.target.value;
                        endColorSwatch.style.backgroundColor = e.target.value;
                        endColorCodeInput.value = e.target.value.toUpperCase();
                        updateGradientPreview(i + 1);
                        updateRealTimePreview();
                        updateCodeStatus();
                        generateGradientCode();
                    });
                    
                    // 起始代码输入事件
                    startColorCodeInput.addEventListener('input', function(e) {
                        if (this.value) {
                            let colorValue = this.value;
                            if (!colorValue.startsWith('#')) {
                                colorValue = '#' + colorValue;
                            }
                            if (/^#[0-9A-Fa-f]{6}$/.test(colorValue) || /^#[0-9A-Fa-f]{3}$/.test(colorValue)) {
                                customGradientData[i].startColor = colorValue;
                                startColorSwatch.style.backgroundColor = colorValue;
                                startColorInput.value = colorValue;
                                this.value = colorValue.toUpperCase();
                                updateGradientPreview(i + 1);
                                updateRealTimePreview();
                                updateCodeStatus();
                                generateGradientCode();
                            }
                        }
                    });
                    
                    // 末尾代码输入事件
                    endColorCodeInput.addEventListener('input', function(e) {
                        if (this.value) {
                            let colorValue = this.value;
                            if (!colorValue.startsWith('#')) {
                                colorValue = '#' + colorValue;
                            }
                            if (/^#[0-9A-Fa-f]{6}$/.test(colorValue) || /^#[0-9A-Fa-f]{3}$/.test(colorValue)) {
                                customGradientData[i].endColor = colorValue;
                                endColorSwatch.style.backgroundColor = colorValue;
                                endColorInput.value = colorValue;
                                this.value = colorValue.toUpperCase();
                                updateGradientPreview(i + 1);
                                updateRealTimePreview();
                                updateCodeStatus();
                                generateGradientCode();
                            }
                        }
                    });
                }
            }
            
            function setCustomColorCount(count) {
                customColorCount = count;
                
                customColorCountButtons.forEach(btn => {
                    if (parseInt(btn.getAttribute('data-count')) === count) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
                
                if (count > customColorRowsData.length) {
                    for (let i = customColorRowsData.length; i < count; i++) {
                        customColorRowsData.push({
                            range: '',
                            color: getRandomColor(),
                            fontSize: 16,
                            enabled: true
                        });
                    }
                }
                // 注意：不再使用 slice 删除数据，这样当从 3 色切换到 2 色再切换回 3 色时，颜色3的数据会被保留
                
                renderCustomColorRows();
                renderCustomColorRows2();
                updateRealTimePreview();
                generateGradientCode();
            }
            
            function renderCustomColorRows() {
                customColorRows.innerHTML = '';
                
                for (let i = 0; i < customColorCount; i++) {
                    const rowData = customColorRowsData[i];
                    const rowIndex = i + 1;
                    
                    const row = document.createElement('div');
                    row.className = 'custom-color-row';
                    
                    row.innerHTML = `
                        <div class="custom-color-row-line">
                            <div class="custom-color-input-group range-group">
                                <label>范围：</label>
                                <div class="range-input-group">
                                    <textarea class="style-range-input" id="customColorRange${rowIndex}" placeholder="例如：1-3,5-8" rows="2">${rowData.range || ''}</textarea>
                                </div>
                            </div>
                        </div>
                        <div class="custom-color-row-line">
                            <div class="custom-color-input-group">
                                <label>颜色：</label>
                                <div class="color-swatch-container">
                                    <div class="custom-color-swatch" id="customColorSwatch${rowIndex}" style="background-color: ${rowData.color};">
                                        <input type="color" id="customColor${rowIndex}" value="${rowData.color}">
                                    </div>
                                    <input type="text" class="color-code-input" id="customColorCode${rowIndex}" value="${rowData.color.toUpperCase().replace('#', '')}" maxlength="6">
                                </div>
                            </div>
                        </div>
                        <div class="custom-color-row-line">
                            <div class="custom-color-input-group">
                                <label>字体：</label>
                                <div class="font-size-input-group">
                                        <input type="number" class="custom-font-size-input font-size-input" 
                                               id="customFontSize${rowIndex}" 
                                               min="10" max="30" value="${rowData.fontSize || 16}">
                                    </div>
                            </div>
                        </div>
                    `;
                    
                    customColorRows.appendChild(row);
                    
                    const fontSizeInput = document.getElementById(`customFontSize${rowIndex}`);
                    const colorInput = document.getElementById(`customColor${rowIndex}`);
                    const colorSwatch = document.getElementById(`customColorSwatch${rowIndex}`);
                    const colorCodeInput = document.getElementById(`customColorCode${rowIndex}`);
                    const rangeInput = document.getElementById(`customColorRange${rowIndex}`);
                    
                    // 范围输入事件
                    if (rangeInput) {
                        rangeInput.addEventListener('input', function() {
                            let rangeValue = this.value;
                            rangeValue = rangeValue.replace(/[^\d\-,\s。，。]/g, '');
                            this.value = rangeValue;
                            customColorRowsData[i].range = this.value;
                            // 同步到滑杆模式
                            const rangeSlider2 = document.getElementById(`colorRangeSlider2_${rowIndex}`);
                            if (rangeSlider2 && rangeSlider2.slider) {
                                rangeSlider2.slider.clearRanges();
                                const ranges = parseRangeStringToRanges(this.value);
                                ranges.forEach(range => {
                                    rangeSlider2.slider.addRange(range.start, range.end);
                                });
                            }
                            updateRealTimePreview();
                            updateCodeStatus();
                            generateGradientCode();
                        });
                    }
                    
                    fontSizeInput.addEventListener('input', function() {
                        customColorRowsData[i].fontSize = parseInt(this.value) || 16;
                        // 同步到滑杆模式
                        const fontSizeInput2 = document.getElementById(`customFontSize2_${rowIndex}`);
                        if (fontSizeInput2) fontSizeInput2.value = this.value;
                        updateRealTimePreview();
                        updateCodeStatus();
                        generateGradientCode();
                    });
                    
                    colorInput.addEventListener('input', function(e) {
                        customColorRowsData[i].color = e.target.value;
                        colorSwatch.style.backgroundColor = e.target.value;
                        if (colorCodeInput) {
                            colorCodeInput.value = e.target.value.toUpperCase().replace('#', '');
                        }
                        // 同步到滑杆模式
                        const colorInput2 = document.getElementById(`customColor2_${rowIndex}`);
                        const colorSwatch2 = document.getElementById(`customColorSwatch2_${rowIndex}`);
                        const colorCodeInput2 = document.getElementById(`customColorCode2_${rowIndex}`);
                        if (colorInput2) colorInput2.value = e.target.value;
                        if (colorSwatch2) colorSwatch2.style.backgroundColor = e.target.value;
                        if (colorCodeInput2) colorCodeInput2.value = e.target.value.toUpperCase().replace('#', '');
                        updateRealTimePreview();
                        updateCodeStatus();
                        generateGradientCode();
                    });
                    
                    colorInput.addEventListener('change', function(e) {
                        customColorRowsData[i].color = e.target.value;
                        colorSwatch.style.backgroundColor = e.target.value;
                        if (colorCodeInput) {
                            colorCodeInput.value = e.target.value.toUpperCase().replace('#', '');
                        }
                        // 同步到滑杆模式
                        const colorInput2 = document.getElementById(`customColor2_${rowIndex}`);
                        const colorSwatch2 = document.getElementById(`customColorSwatch2_${rowIndex}`);
                        const colorCodeInput2 = document.getElementById(`customColorCode2_${rowIndex}`);
                        if (colorInput2) colorInput2.value = e.target.value;
                        if (colorSwatch2) colorSwatch2.style.backgroundColor = e.target.value;
                        if (colorCodeInput2) colorCodeInput2.value = e.target.value.toUpperCase().replace('#', '');
                        updateRealTimePreview();
                        updateCodeStatus();
                        generateGradientCode();
                    });
                    
                    // 绑定颜色代码输入框事件
                    if (colorCodeInput) {
                        colorCodeInput.addEventListener('input', function(e) {
                            if (this.value) {
                                let colorValue = this.value;
                                // 过滤掉#符号，只保留字母和数字
                                colorValue = colorValue.replace(/[^0-9A-Fa-f]/g, '');
                                // 限制最大长度为6个字符
                                if (colorValue.length > 6) {
                                    colorValue = colorValue.substring(0, 6);
                                }
                                this.value = colorValue.toUpperCase();
                                
                                // 确保是有效的十六进制颜色
                                if (/^[0-9A-Fa-f]{6}$/.test(colorValue) || /^[0-9A-Fa-f]{3}$/.test(colorValue)) {
                                    const fullColorValue = '#' + colorValue;
                                    customColorRowsData[i].color = fullColorValue;
                                    colorSwatch.style.backgroundColor = fullColorValue;
                                    colorInput.value = fullColorValue;
                                    
                                    // 同步到滑杆模式
                                    const colorCodeInput2 = document.getElementById(`customColorCode2_${rowIndex}`);
                                    const colorInput2 = document.getElementById(`customColor2_${rowIndex}`);
                                    const colorSwatch2 = document.getElementById(`customColorSwatch2_${rowIndex}`);
                                    if (colorCodeInput2) colorCodeInput2.value = colorValue.toUpperCase();
                                    if (colorInput2) colorInput2.value = fullColorValue;
                                    if (colorSwatch2) colorSwatch2.style.backgroundColor = fullColorValue;
                                    
                                    updateRealTimePreview();
                                    updateCodeStatus();
                                    generateGradientCode();
                                }
                            }
                        });
                        
                        colorCodeInput.addEventListener('blur', function(e) {
                            if (this.value) {
                                let colorValue = this.value;
                                // 过滤掉#符号，只保留字母和数字
                                colorValue = colorValue.replace(/[^0-9A-Fa-f]/g, '');
                                // 限制最大长度为6个字符
                                if (colorValue.length > 6) {
                                    colorValue = colorValue.substring(0, 6);
                                }
                                this.value = colorValue.toUpperCase();
                                
                                // 确保是有效的十六进制颜色
                                if (/^[0-9A-Fa-f]{6}$/.test(colorValue) || /^[0-9A-Fa-f]{3}$/.test(colorValue)) {
                                    const fullColorValue = '#' + colorValue;
                                    customColorRowsData[i].color = fullColorValue;
                                    colorSwatch.style.backgroundColor = fullColorValue;
                                    colorInput.value = fullColorValue;
                                    
                                    // 同步到滑杆模式
                                    const colorCodeInput2 = document.getElementById(`customColorCode2_${rowIndex}`);
                                    const colorInput2 = document.getElementById(`customColor2_${rowIndex}`);
                                    const colorSwatch2 = document.getElementById(`customColorSwatch2_${rowIndex}`);
                                    if (colorCodeInput2) colorCodeInput2.value = colorValue.toUpperCase();
                                    if (colorInput2) colorInput2.value = fullColorValue;
                                    if (colorSwatch2) colorSwatch2.style.backgroundColor = fullColorValue;
                                    
                                    updateRealTimePreview();
                                    updateCodeStatus();
                                    generateGradientCode();
                                } else {
                                    // 如果无效，恢复原来的值
                                    this.value = customColorRowsData[i].color.toUpperCase();
                                }
                            }
                        });
                    }
                }
            }
            
            // 渲染滑杆模式的颜色行
            function renderCustomColorRows2() {
                const customColorRows2 = document.getElementById('customColorRows2');
                if (!customColorRows2) return;
                
                customColorRows2.innerHTML = '';
                
                for (let i = 0; i < customColorCount; i++) {
                    const rowData = customColorRowsData[i];
                    const rowIndex = i + 1;
                    
                    const row = document.createElement('div');
                    row.className = 'custom-color-row';
                    
                    row.innerHTML = `
                        <div class="custom-color-row-line">
                            <div class="slider-range-container" id="colorRangeSlider2_${rowIndex}"></div>
                        </div>
                        <div class="custom-color-row-line horizontal-layout">
                            <div class="custom-color-input-group">
                                <label>颜色：</label>
                                <div class="color-swatch-container">
                                    <div class="custom-color-swatch" id="customColorSwatch2_${rowIndex}" style="background-color: ${rowData.color};">
                                        <input type="color" id="customColor2_${rowIndex}" value="${rowData.color}">
                                    </div>
                                    <input type="text" class="color-code-input" id="customColorCode2_${rowIndex}" value="${rowData.color.toUpperCase().replace('#', '')}" maxlength="6">
                                </div>
                            </div>
                            <div class="custom-color-input-group">
                                <label>字体：</label>
                                <div class="font-size-input-group">
                                        <input type="number" class="custom-font-size-input font-size-input" 
                                               id="customFontSize2_${rowIndex}" 
                                               min="10" max="30" value="${rowData.fontSize || 16}">
                                    </div>
                            </div>
                        </div>
                    `;
                    
                    customColorRows2.appendChild(row);
                    
                    const fontSizeInput = document.getElementById(`customFontSize2_${rowIndex}`);
                    const colorInput = document.getElementById(`customColor2_${rowIndex}`);
                    const colorSwatch = document.getElementById(`customColorSwatch2_${rowIndex}`);
                    const colorCodeInput = document.getElementById(`customColorCode2_${rowIndex}`);
                    const rangeSlider = document.getElementById(`colorRangeSlider2_${rowIndex}`);
                    
                    // 初始化范围滑杆
                    if (rangeSlider) {
                        rangeSlider.slider = new SliderRangeSelector(`colorRangeSlider2_${rowIndex}`, {
                            maxValue: 20,
                            minValue: 1,
                            initialRanges: parseRangeStringToRanges(rowData.range || ''),
                            textElement: textInput,
                            enableCharWidthMode: true,
                            onRangeChange: (rangeString) => {
                                customColorRowsData[i].range = rangeString;
                                // 同步到数字模式
                                const rangeInput1 = document.getElementById(`customColorRange${rowIndex}`);
                                if (rangeInput1) rangeInput1.value = rangeString;
                                updateRealTimePreview();
                                updateCodeStatus();
                                generateGradientCode();
                            }
                        });
                    }
                    
                    // 字体大小输入事件
                    if (fontSizeInput) {
                        fontSizeInput.addEventListener('input', function() {
                            customColorRowsData[i].fontSize = parseInt(this.value) || 16;
                            // 同步到数字模式
                            const fontSizeInput1 = document.getElementById(`customFontSize${rowIndex}`);
                            if (fontSizeInput1) fontSizeInput1.value = this.value;
                            updateRealTimePreview();
                            updateCodeStatus();
                            generateGradientCode();
                        });
                    }
                    
                    // 颜色输入事件
                    if (colorInput) {
                        colorInput.addEventListener('input', function(e) {
                            customColorRowsData[i].color = e.target.value;
                            colorSwatch.style.backgroundColor = e.target.value;
                            if (colorCodeInput) {
                                colorCodeInput.value = e.target.value.toUpperCase().replace('#', '');
                            }
                            // 同步到数字模式
                            const colorInput1 = document.getElementById(`customColor${rowIndex}`);
                            const colorSwatch1 = document.getElementById(`customColorSwatch${rowIndex}`);
                            const colorCodeInput1 = document.getElementById(`customColorCode${rowIndex}`);
                            if (colorInput1) colorInput1.value = e.target.value;
                            if (colorSwatch1) colorSwatch1.style.backgroundColor = e.target.value;
                            if (colorCodeInput1) colorCodeInput1.value = e.target.value.toUpperCase().replace('#', '');
                            updateRealTimePreview();
                            updateCodeStatus();
                            generateGradientCode();
                        });
                        
                        colorInput.addEventListener('change', function(e) {
                            customColorRowsData[i].color = e.target.value;
                            colorSwatch.style.backgroundColor = e.target.value;
                            if (colorCodeInput) {
                                colorCodeInput.value = e.target.value.toUpperCase().replace('#', '');
                            }
                            // 同步到数字模式
                            const colorInput1 = document.getElementById(`customColor${rowIndex}`);
                            const colorSwatch1 = document.getElementById(`customColorSwatch${rowIndex}`);
                            const colorCodeInput1 = document.getElementById(`customColorCode${rowIndex}`);
                            if (colorInput1) colorInput1.value = e.target.value;
                            if (colorSwatch1) colorSwatch1.style.backgroundColor = e.target.value;
                            if (colorCodeInput1) colorCodeInput1.value = e.target.value.toUpperCase().replace('#', '');
                            updateRealTimePreview();
                            updateCodeStatus();
                            generateGradientCode();
                        });
                    }
                    
                    // 绑定颜色代码输入框事件
                    if (colorCodeInput) {
                        colorCodeInput.addEventListener('input', function(e) {
                            if (this.value) {
                                let colorValue = this.value;
                                // 过滤掉#符号，只保留字母和数字
                                colorValue = colorValue.replace(/[^0-9A-Fa-f]/g, '');
                                // 限制最大长度为6个字符
                                if (colorValue.length > 6) {
                                    colorValue = colorValue.substring(0, 6);
                                }
                                this.value = colorValue.toUpperCase();
                                
                                // 确保是有效的十六进制颜色
                                if (/^[0-9A-Fa-f]{6}$/.test(colorValue) || /^[0-9A-Fa-f]{3}$/.test(colorValue)) {
                                    const fullColorValue = '#' + colorValue;
                                    customColorRowsData[i].color = fullColorValue;
                                    colorSwatch.style.backgroundColor = fullColorValue;
                                    colorInput.value = fullColorValue;
                                    
                                    // 同步到数字模式
                                    const colorCodeInput1 = document.getElementById(`customColorCode${rowIndex}`);
                                    const colorInput1 = document.getElementById(`customColor${rowIndex}`);
                                    const colorSwatch1 = document.getElementById(`customColorSwatch${rowIndex}`);
                                    if (colorCodeInput1) colorCodeInput1.value = colorValue.toUpperCase();
                                    if (colorInput1) colorInput1.value = fullColorValue;
                                    if (colorSwatch1) colorSwatch1.style.backgroundColor = fullColorValue;
                                    
                                    updateRealTimePreview();
                                    updateCodeStatus();
                                    generateGradientCode();
                                }
                            }
                        });
                        
                        colorCodeInput.addEventListener('blur', function(e) {
                            if (this.value) {
                                let colorValue = this.value;
                                // 过滤掉#符号，只保留字母和数字
                                colorValue = colorValue.replace(/[^0-9A-Fa-f]/g, '');
                                // 限制最大长度为6个字符
                                if (colorValue.length > 6) {
                                    colorValue = colorValue.substring(0, 6);
                                }
                                this.value = colorValue.toUpperCase();
                                
                                // 确保是有效的十六进制颜色
                                if (/^[0-9A-Fa-f]{6}$/.test(colorValue) || /^[0-9A-Fa-f]{3}$/.test(colorValue)) {
                                    const fullColorValue = '#' + colorValue;
                                    customColorRowsData[i].color = fullColorValue;
                                    colorSwatch.style.backgroundColor = fullColorValue;
                                    colorInput.value = fullColorValue;
                                    
                                    // 同步到数字模式
                                    const colorCodeInput1 = document.getElementById(`customColorCode${rowIndex}`);
                                    const colorInput1 = document.getElementById(`customColor${rowIndex}`);
                                    const colorSwatch1 = document.getElementById(`customColorSwatch${rowIndex}`);
                                    if (colorCodeInput1) colorCodeInput1.value = colorValue.toUpperCase();
                                    if (colorInput1) colorInput1.value = fullColorValue;
                                    if (colorSwatch1) colorSwatch1.style.backgroundColor = fullColorValue;
                                    
                                    updateRealTimePreview();
                                    updateCodeStatus();
                                    generateGradientCode();
                                } else {
                                    // 如果无效，恢复原来的值
                                    this.value = customColorRowsData[i].color.toUpperCase();
                                }
                            }
                        });
                    }
                }
            }
            
            // 辅助函数：解析范围字符串为范围数组
            function parseRangeStringToRanges(rangeString) {
                const ranges = [];
                const parts = rangeString.split(/[,，。\s]+/);
                
                parts.forEach(part => {
                    const trimmed = part.trim();
                    if (!trimmed) return;
                    
                    const match = trimmed.match(/(\d+)-(\d+)/);
                    if (match) {
                        let start = parseInt(match[1]);
                        let end = parseInt(match[2]);
                        
                        start = Math.max(1, Math.min(20, start));
                        end = Math.max(1, Math.min(20, end));
                        
                        if (start > end) {
                            [start, end] = [end, start];
                        }
                        
                        ranges.push({ start, end });
                    } else {
                        const num = parseInt(trimmed);
                        if (!isNaN(num)) {
                            let start = Math.max(1, Math.min(20, num));
                            let end = start;
                            ranges.push({ start, end });
                        }
                    }
                });
                
                return ranges;
            }
            
            function generateCustomPreview(text) {
                const textLength = text.length;
                
                const globalFontSize = parseInt(fontSizeInput.value) || 16;
                const globalBold = customGlobalBoldCheckbox.checked;
                const globalItalic = customGlobalItalicCheckbox.checked;
                const globalUnderline = customGlobalUnderlineCheckbox.checked;
                
                let colorMap = new Array(textLength).fill('#FFFFFF');
                let fontSizeMap = new Array(textLength).fill(globalFontSize);
                
                for (let i = 0; i < customColorRowsData.length; i++) {
                    const row = customColorRowsData[i];
                    if (row.enabled && row.range && row.color) {
                        const ranges = parseRanges(row.range, textLength);
                        for (const range of ranges) {
                            const start = Math.max(1, range.start);
                            const end = Math.min(range.end, textLength);
                            for (let j = start; j <= end; j++) {
                                colorMap[j-1] = row.color;
                                fontSizeMap[j-1] = row.fontSize || globalFontSize;
                            }
                        }
                    }
                }
                
                if (customGradientCheckbox.checked) {
                    for (let i = 0; i < customGradientCount; i++) {
                        const gradient = customGradientData[i];
                        if (gradient.range && gradient.startColor && gradient.endColor) {
                            const ranges = parseRanges(gradient.range, textLength);
                            for (const range of ranges) {
                                const rangeLength = range.end - range.start + 1;
                                const gradientColors = interpolateColors(gradient.startColor, gradient.endColor, rangeLength);
                                
                                const start = Math.max(1, range.start);
                                const end = Math.min(range.end, textLength);
                                for (let j = start; j <= end; j++) {
                                    const gradientIndex = j - range.start;
                                    colorMap[j-1] = gradientColors[gradientIndex];
                                }
                            }
                        }
                    }
                }
                
                const boldRanges = customBoldCheckbox.checked ? parseRanges(customBoldInput.value, textLength) : [];
                const italicRanges = customItalicCheckbox.checked ? parseRanges(customItalicInput.value, textLength) : [];
                const underlineRanges = customUnderlineCheckbox.checked ? parseRanges(customUnderlineInput.value, textLength) : [];
                
                const boldMap = createStyleMap(boldRanges, textLength, globalBold);
                const italicMap = createStyleMap(italicRanges, textLength, globalItalic);
                const underlineMap = createStyleMap(underlineRanges, textLength, globalUnderline);
                
                let previewHtml = '';
                for (let i = 0; i < textLength; i++) {
                    const fontSize = fontSizeMap[i] || globalFontSize;
                    const charBold = boldMap[i];
                    const charItalic = italicMap[i];
                    const charUnderline = underlineMap[i];
                    
                    let style = `color: ${colorMap[i]}; font-size: ${fontSize}px;`;
                    if (charBold) style += ' font-weight: bold;';
                    if (charItalic) style += ' font-style: italic;';
                    if (charUnderline) style += ' text-decoration: underline;';
                    
                    previewHtml += `<span style="${style}">${text[i]}</span>`;
                }
                
                return previewHtml;
            }
            
            function generateCustomCode(text) {
                const textLength = text.length;
                
                const globalFontSize = 16;
                const globalBold = customGlobalBoldCheckbox.checked;
                const globalItalic = customGlobalItalicCheckbox.checked;
                const globalUnderline = customGlobalUnderlineCheckbox.checked;
                
                const boldRanges = customBoldCheckbox.checked ? parseRanges(customBoldInput.value, textLength) : [];
                const italicRanges = customItalicCheckbox.checked ? parseRanges(customItalicInput.value, textLength) : [];
                const underlineRanges = customUnderlineCheckbox.checked ? parseRanges(customUnderlineInput.value, textLength) : [];
                
                let colorMap = new Array(textLength).fill('#FFFFFF');
                let fontSizeMap = new Array(textLength).fill(globalFontSize);
                
                for (let i = 0; i < customColorRowsData.length; i++) {
                    const row = customColorRowsData[i];
                    if (row.enabled && row.range && row.color) {
                        const ranges = parseRanges(row.range, textLength);
                        for (const range of ranges) {
                            const start = Math.max(1, range.start);
                            const end = Math.min(range.end, textLength);
                            for (let j = start; j <= end; j++) {
                                colorMap[j-1] = row.color;
                                fontSizeMap[j-1] = row.fontSize || globalFontSize;
                            }
                        }
                    }
                }
                
                if (customGradientCheckbox.checked) {
                    for (let i = 0; i < customGradientCount; i++) {
                        const gradient = customGradientData[i];
                        if (gradient.range && gradient.startColor && gradient.endColor) {
                            const ranges = parseRanges(gradient.range, textLength);
                            for (const range of ranges) {
                                const rangeLength = range.end - range.start + 1;
                                const gradientColors = interpolateColors(gradient.startColor, gradient.endColor, rangeLength);
                                
                                const start = Math.max(1, range.start);
                                const end = Math.min(range.end, textLength);
                                for (let j = start; j <= end; j++) {
                                    const gradientIndex = j - range.start;
                                    colorMap[j-1] = gradientColors[gradientIndex];
                                }
                            }
                        }
                    }
                }
                
                const boldMap = createStyleMap(boldRanges, textLength, globalBold);
                const italicMap = createStyleMap(italicRanges, textLength, globalItalic);
                const underlineMap = createStyleMap(underlineRanges, textLength, globalUnderline);
                
                let gameCode = '';
                let currentFontSize = null;
                let currentBold = false;
                let currentItalic = false;
                let currentUnderline = false;
                let currentSegments = [];
                
                for (let i = 0; i < textLength; i++) {
                    const char = text[i];
                    const charColor = colorMap[i];
                    const charFontSize = fontSizeMap[i];
                    const charBold = boldMap[i];
                    const charItalic = italicMap[i];
                    const charUnderline = underlineMap[i];
                    
                    if (charFontSize !== currentFontSize ||
                        charBold !== currentBold ||
                        charItalic !== currentItalic ||
                        charUnderline !== currentUnderline ||
                        i === 0) {
                        
                        if (currentSegments.length > 0) {
                            gameCode += formatTextSegmentWithColors(currentSegments, currentFontSize, currentBold, currentItalic, currentUnderline, globalFontSize);
                        }
                        
                        currentFontSize = charFontSize;
                        currentBold = charBold;
                        currentItalic = charItalic;
                        currentUnderline = charUnderline;
                        currentSegments = [{ color: charColor, text: char }];
                    } else {
                        if (charColor === currentSegments[currentSegments.length - 1].color) {
                            currentSegments[currentSegments.length - 1].text += char;
                        } else {
                            currentSegments.push({ color: charColor, text: char });
                        }
                    }
                }
                
                if (currentSegments.length > 0) {
                    gameCode += formatTextSegmentWithColors(currentSegments, currentFontSize, currentBold, currentItalic, currentUnderline, globalFontSize);
                }
                
                return gameCode;
            }
            
            function createStyleMap(ranges, textLength, defaultValue) {
                const map = new Array(textLength).fill(defaultValue);
                for (const range of ranges) {
                    const start = Math.max(1, range.start);
                    const end = Math.min(range.end, textLength);
                    for (let i = start; i <= end; i++) {
                        map[i-1] = true;
                    }
                }
                return map;
            }
            
            function formatTextSegment(text, color, fontSize, bold, italic, underline, globalFontSize) {
                let code = '';
                
                if (fontSize !== globalFontSize) {
                    code += `<size=${fontSize}>`;
                }
                
                if (underline) code += '<u>';
                if (italic) code += '<i>';
                if (bold) code += '<b>';
                
                if (color) {
                    code += `<color=${color}>${text}</color>`;
                } else {
                    code += text;
                }
                
                if (bold) code += '</b>';
                if (italic) code += '</i>';
                if (underline) code += '</u>';
                
                if (fontSize !== globalFontSize) {
                    code += '</size>';
                }
                
                return code;
            }
            
            function formatTextSegmentWithColors(segments, fontSize, bold, italic, underline, globalFontSize) {
                let code = '';
                
                if (fontSize !== globalFontSize) {
                    code += `<size=${fontSize}>`;
                }
                
                if (underline) code += '<u>';
                if (italic) code += '<i>';
                if (bold) code += '<b>';
                
                for (const segment of segments) {
                    if (segment.color) {
                        code += `<color=${segment.color}>${segment.text}</color>`;
                    } else {
                        code += segment.text;
                    }
                }
                
                if (bold) code += '</b>';
                if (italic) code += '</i>';
                if (underline) code += '</u>';
                
                if (fontSize !== globalFontSize) {
                    code += '</size>';
                }
                
                return code;
            }
            
            function parseRanges(rangeStr, maxLength) {
                if (!rangeStr.trim()) return [];
                
                const ranges = [];
                const parts = rangeStr.split(/[,，。.\s]+/);
                
                for (const part of parts) {
                    const trimmed = part.trim();
                    if (trimmed.includes('-')) {
                        const [startStr, endStr] = trimmed.split('-');
                        const start = parseInt(startStr.trim());
                        const end = parseInt(endStr.trim());
                        
                        if (!isNaN(start) && !isNaN(end) && start >= 1 && end >= start && start <= maxLength) {
                            ranges.push({
                                start: Math.min(start, maxLength),
                                end: Math.min(end, maxLength)
                            });
                        }
                    } else {
                        const num = parseInt(trimmed);
                        if (!isNaN(num) && num >= 1 && num <= maxLength) {
                            ranges.push({
                                start: num,
                                end: num
                            });
                        }
                    }
                }
                
                return ranges;
            }
            
            function resetFavoriteButton() {
                favoriteBtn.textContent = '☆ 收藏';
                favoriteBtn.classList.remove('favorited');
                document.getElementById('codeCharCount').textContent = '0';
            }
            
            // 多色插值辅助函数
            function interpolateMultiColorsWithColors(steps, colors) {
                if (colors.length < 2) {
                    return new Array(steps).fill(colors[0] || '#2EFFA4');
                }
                
                const colorCount = colors.length;
                const segmentSteps = Math.floor(steps / (colorCount - 1));
                const resultColors = [];
                
                for (let i = 0; i < colorCount - 1; i++) {
                    const startColor = hexToRgb(colors[i]);
                    const endColor = hexToRgb(colors[i + 1]);
                    
                    const currentSteps = (i === colorCount - 2) ? 
                        steps - i * segmentSteps : segmentSteps;
                    
                    for (let j = 0; j < currentSteps; j++) {
                        const ratio = j / currentSteps;
                        const r = Math.round(startColor.r + (endColor.r - startColor.r) * ratio);
                        const g = Math.round(startColor.g + (endColor.g - startColor.g) * ratio);
                        const b = Math.round(startColor.b + (endColor.b - startColor.b) * ratio);
                        resultColors.push(rgbToHex(r, g, b));
                    }
                }
                
                while (resultColors.length < steps) {
                    resultColors.push(resultColors[resultColors.length - 1]);
                }
                
                return resultColors;
            }
            
            // 导入模式选择器初始化
            function initImportModeSelector() {
                importModeButtons.forEach(btn => {
                    btn.addEventListener('click', function() {
                        importModeButtons.forEach(b => b.classList.remove('active'));
                        this.classList.add('active');
                    });
                });
            }
            
            // 示例功能
            function initExamples() {
                for (let i = 1; i <= 3; i++) {
                    const example = examples[i];
                    const textInput = document.getElementById(`example${i}Text`);
                    const preview = document.getElementById(`example${i}Preview`);
                    const codeElement = document.getElementById(`example${i}Code`);
                    
                    if (i < 3) {
                        const originalCode = generateExampleCode(example.originalText, example.colors);
                        codeElement.textContent = originalCode;
                    } else if (i === 3) {
                        // 示例3使用用户指定的代码
                        const userCode = '<size=16><color=#FFFFFF>ﮩ</color><color=#FFDBDB>٨</color><color=#FFB6B6>ـ</color><color=#FF9292>ﮩ</color><color=#FF6D6D>ﮩ</color><color=#FF4949>٨</color><color=#FF2424>ﮩ</color><color=#FF0000>♡</color><color=#FF2020>ﮩ</color><color=#FF4040>٨</color><color=#FF6060>ـ</color><color=#FF8080>ﮩ</color><color=#FF9F9F>ﮩ</color><color=#FFBFBF>٨</color><color=#FFDFDF>ﮩ</color></size>';
                        codeElement.textContent = userCode;
                    }
                    
                    updateExamplePreview(i);
                    
                    if (i < 3) {
                        textInput.addEventListener('input', function() {
                            updateExamplePreview(i);
                        });
                    } else if (i === 3) {
                        // 为示例3生成颜色色块选择器
                        generateExample3ColorPickers();
                    }
                    
                    const button = document.querySelector(`.example-btn[data-example="${i}"]`);
                    button.addEventListener('click', function() {
                        copyExampleCode(i);
                    });
                    
                    codeElement.addEventListener('dblclick', function() {
                        selectAllText(this);
                    });
                }

                for (let i = 1; i <= 3; i++) {
                    const toggleBtn = document.querySelector(`.toggle-example-code-btn[data-example="${i}"]`);
                    const codeBlock = document.getElementById(`example${i}Code`);
                    
                    toggleBtn.addEventListener('click', function() {
                        const isHidden = codeBlock.classList.toggle('hidden');
                        toggleBtn.textContent = isHidden ? '▼' : '▲';
                    });
                    
                    codeBlock.addEventListener('dblclick', function() {
                        selectAllText(this);
                    });
                }
                
                examplesBoldCheckbox.addEventListener('change', function() {
                    for (let i = 1; i <= 3; i++) {
                        updateExamplePreview(i);
                    }
                });
                
                examplesItalicCheckbox.addEventListener('change', function() {
                    for (let i = 1; i <= 3; i++) {
                        updateExamplePreview(i);
                    }
                });
                
                examplesUnderlineCheckbox.addEventListener('change', function() {
                    for (let i = 1; i <= 3; i++) {
                        updateExamplePreview(i);
                    }
                });
            }
            
            function generateExampleCode(text, colors) {
                const fontSize = parseInt(fontSizeInput.value) || 16;
                const isBold = examplesBoldCheckbox.checked;
                const isItalic = examplesItalicCheckbox.checked;
                const isUnderline = examplesUnderlineCheckbox.checked;
                
                let code = '';
                const textLength = text.length;
                const colorCount = colors.length;
                
                for (let i = 0; i < textLength; i++) {
                    const colorIndex = Math.floor((i / textLength) * colorCount);
                    code += `<color=${colors[colorIndex]}>${text[i]}</color>`;
                }
                
                code = formatTextSegment(code, null, fontSize, isBold, isItalic, isUnderline, fontSize);
                
                return code;
            }
            
            function updateExamplePreview(exampleId) {
                const example = examples[exampleId];
                const preview = document.getElementById(`example${exampleId}Preview`);
                const codeElement = document.getElementById(`example${exampleId}Code`);
                
                if (exampleId < 3) {
                    const textInput = document.getElementById(`example${exampleId}Text`);
                    const text = textInput.value;
                    const fontSize = parseInt(fontSizeInput.value) || 16;
                    const isBold = examplesBoldCheckbox.checked;
                    const isItalic = examplesItalicCheckbox.checked;
                    const isUnderline = examplesUnderlineCheckbox.checked;
                    const colors = example.colors;
                    
                    let previewHtml = '';
                    const textLength = text.length;
                    const colorCount = colors.length;
                    
                    for (let i = 0; i < textLength; i++) {
                        const colorIndex = Math.floor((i / textLength) * colorCount);
                        let style = `color: ${colors[colorIndex]}; font-size: ${fontSize}px;`;
                        if (isBold) style += ' font-weight: bold;';
                        if (isItalic) style += ' font-style: italic;';
                        if (isUnderline) style += ' text-decoration: underline;';
                        previewHtml += `<span style="${style}">${text[i]}</span>`;
                    }
                    
                    preview.innerHTML = `<div class="example-preview-content">${previewHtml}</div>`;
                    
                    const code = generateExampleCode(text, colors);
                    codeElement.textContent = code;
                } else if (exampleId === 3) {
                    // 示例3使用用户指定的代码来更新预览
                    const userCode = codeElement.textContent;
                    
                    // 解析用户代码并生成预览
                    let previewHtml = '';
                    const fontSize = parseInt(fontSizeInput.value) || 16;
                    const isBold = examplesBoldCheckbox.checked;
                    const isItalic = examplesItalicCheckbox.checked;
                    const isUnderline = examplesUnderlineCheckbox.checked;
                    
                    // 提取颜色和文本
                    const colorTextMatches = userCode.match(/<color=(#[^>]+)>([^<]+)<\/color>/g);
                    if (colorTextMatches) {
                        colorTextMatches.forEach(match => {
                            const colorMatch = match.match(/<color=(#[^>]+)>/);
                            const textMatch = match.match(/>([^<]+)<\/color>/);
                            
                            if (colorMatch && textMatch) {
                                const color = colorMatch[1];
                                const text = textMatch[1];
                                let style = `color: ${color}; font-size: ${fontSize}px;`;
                                
                                if (isBold) style += ' font-weight: bold;';
                                if (isItalic) style += ' font-style: italic;';
                                if (isUnderline) style += ' text-decoration: underline;';
                                
                                previewHtml += `<span style="${style}">${text}</span>`;
                            }
                        });
                    }
                    
                    preview.innerHTML = `<div class="example-preview-content">${previewHtml}</div>`;
                }
            }
            
            // 为示例3生成颜色色块选择器（只显示3个色块：起始、中间、末尾）
            function generateExample3ColorPickers() {
                const example = examples[3];
                const colorPickersContainer = document.getElementById('example3ColorPickers');
                
                colorPickersContainer.innerHTML = '';
                
                // 只显示3个色块：起始、中间、末尾
                const colorIndices = [0, Math.floor(example.colors.length / 2), example.colors.length - 1];
                
                colorIndices.forEach((index, pickerIndex) => {
                    const color = example.colors[index];
                    const colorPicker = document.createElement('div');
                    colorPicker.className = 'example-color-picker';
                    colorPicker.style.backgroundColor = color;
                    colorPicker.style.width = '30px';
                    colorPicker.style.height = '30px';
                    colorPicker.style.borderRadius = '5px';
                    colorPicker.style.border = '2px solid #2a3a4a';
                    colorPicker.style.cursor = 'pointer';
                    colorPicker.style.marginRight = '10px';
                    colorPicker.style.display = 'inline-block';
                    
                    // 添加标签
                    const label = document.createElement('span');
                    label.style.fontSize = '12px';
                    label.style.color = '#e0e0e0';
                    label.style.marginRight = '15px';
                    label.style.verticalAlign = 'middle';
                    
                    if (pickerIndex === 0) {
                        label.textContent = '起始色';
                    } else if (pickerIndex === 1) {
                        label.textContent = '中间色';
                    } else {
                        label.textContent = '末尾色';
                    }
                    
                    // 创建颜色输入框（隐藏）
                    const colorInput = document.createElement('input');
                    colorInput.type = 'color';
                    colorInput.value = color;
                    colorInput.style.display = 'none';
                    
                    // 点击色块打开颜色选择器
                    colorPicker.addEventListener('click', function() {
                        colorInput.click();
                    });
                    
                    // 颜色变化时更新色块和示例
                    colorInput.addEventListener('input', function() {
                        const newColor = this.value;
                        
                        // 更新对应位置的颜色
                        example.colors[index] = newColor;
                        colorPicker.style.backgroundColor = newColor;
                        
                        // 重新生成整个颜色渐变
                        regenerateExample3Colors();
                        
                        // 更新预览
                        updateExamplePreview(3);
                    });
                    
                    colorPickersContainer.appendChild(label);
                    colorPickersContainer.appendChild(colorPicker);
                    colorPickersContainer.appendChild(colorInput);
                });
            }
            
            // 重新生成示例3的颜色渐变
            function regenerateExample3Colors() {
                const example = examples[3];
                const startColor = example.colors[0];
                const middleColor = example.colors[Math.floor(example.colors.length / 2)];
                const endColor = example.colors[example.colors.length - 1];
                
                // 清空颜色数组
                example.colors = [];
                
                // 生成新的颜色渐变（15个颜色）
                const totalColors = 15;
                const middleIndex = Math.floor(totalColors / 2);
                
                // 从起始色到中间色
                for (let i = 0; i <= middleIndex; i++) {
                    const ratio = i / middleIndex;
                    const color = interpolateColor(startColor, middleColor, ratio);
                    example.colors.push(color);
                }
                
                // 从中间色到末尾色（跳过第一个，避免重复）
                for (let i = 1; i < totalColors - middleIndex; i++) {
                    const ratio = i / (totalColors - middleIndex - 1);
                    const color = interpolateColor(middleColor, endColor, ratio);
                    example.colors.push(color);
                }
                
                // 更新示例3的代码
                updateExample3Code();
            }
            
            // 更新示例3的代码
            function updateExample3Code() {
                const example = examples[3];
                const codeElement = document.getElementById('example3Code');
                const text = 'ﮩ٨ـﮩﮩ٨ﮩ♡ﮩ٨ﮩـﮩ٨ﮩ';
                
                let code = `<size=16>`;
                for (let i = 0; i < text.length; i++) {
                    const color = example.colors[i];
                    code += `<color=${color}>${text[i]}</color>`;
                }
                code += `</size>`;
                
                codeElement.textContent = code;
                updateExamplePreview(3);
            }
            
            // 在两个颜色之间插值
            function interpolateColor(color1, color2, ratio) {
                const r1 = parseInt(color1.substring(1, 3), 16);
                const g1 = parseInt(color1.substring(3, 5), 16);
                const b1 = parseInt(color1.substring(5, 7), 16);
                
                const r2 = parseInt(color2.substring(1, 3), 16);
                const g2 = parseInt(color2.substring(3, 5), 16);
                const b2 = parseInt(color2.substring(5, 7), 16);
                
                const r = Math.round(r1 + (r2 - r1) * ratio);
                const g = Math.round(g1 + (g2 - g1) * ratio);
                const b = Math.round(b1 + (b2 - b1) * ratio);
                
                return `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`;
            }
            
            function copyExampleCode(exampleId) {
                const codeElement = document.getElementById(`example${exampleId}Code`);
                const code = codeElement.textContent;
                
                const textArea = document.createElement("textarea");
                textArea.value = code;
                document.body.appendChild(textArea);
                textArea.select();
                textArea.setSelectionRange(0, 99999);
                
                try {
                    const successful = document.execCommand('copy');
                    if (successful) {
                        showNotification('复制成功！');
                    } else {
                        showNotification('复制失败！', 'error');
                    }
                } catch (err) {
                    console.error('复制失败: ', err);
                    showNotification('复制失败！', 'error');
                }
                
                document.body.removeChild(textArea);
            }
            
            // ========== 游戏装扮品质颜色配置 ==========
            const dressQualityConfig = {
                '白': { color: '#FFFFFF', priority: 0 },
                '蓝': { color: '#3898FF', priority: 1 },
                '紫': { color: '#B873FF', priority: 2 },
                '金': { color: '#FFD700', priority: 3 },
                '红': { color: '#FF3842', priority: 4 }
            };

            // ========== 游戏装扮数据池 ==========
            const dressData = {
                xiaohuang: {          // 小黄 --[头发--脸--衣服]
                    默认:            { hair:'20000002', face:'20000005', cloth:'20000008', quality: '白' },
                    遗失的童话:      { hair:'20000259', face:'20000260', cloth:'20000258', quality: '金' },
                    霓裳踏雪:        { hair:'20000244', face:'20000245', cloth:'20000243', quality: '紫' },
                    青丘一梦:        { hair:'20000218', face:'20000229', cloth:'20000210', quality: '紫' },
                    罗丽:            { hair:'20000285', face:'20000286', cloth:'20000287', quality: '紫' },
                    异色序曲:        { hair:'20000329', face:'20000330', cloth:'20000328', quality: '紫' },
                    呱呱雨衣:        { hair:'20000319', face:'20000319', cloth:'20000317', quality: '紫' },
                    火线先锋:        { hair:'20000211', face:'无', cloth:'20000201', quality: '蓝' },
                    午后卡其:        { hair:'无', face:'无', cloth:'20000204', quality: '白' },
                    淡蓝牛仔:        { hair:'无', face:'无', cloth:'20000205', quality: '白' },
                    青苔绿:          { hair:'无', face:'无', cloth:'200005', quality: '白' },
                    孔雀绿:          { hair:'无', face:'无', cloth:'200015', quality: '白' },
                    宝石红:          { hair:'无', face:'无', cloth:'200016', quality: '白' },
                    牛仔蓝:          { hair:'无', face:'无', cloth:'200017', quality: '白' },
                    素雅白:          { hair:'无', face:'无', cloth:'200018', quality: '白' },
                    后室幸存者:       { hair:'200023', face:'无', cloth:'200024', quality: '蓝' },

                },
                ailisi: {             // 爱丽丝
                    默认:            { hair:'20000010', face:'20000011', cloth:'20000012', quality: '白' },
                    血色中的玛丽:     { hair:'20000233', face:'20000234', cloth:'20000232', quality: '金' },
                    瑞羽衔春:         { hair:'20000251', face:'20000252', cloth:'20000250', quality: '紫' },
                    冰公主:          { hair:'20000278', face:'20000249', cloth:'20000280', quality: '紫' },
                    丝缕哀歌:         { hair:'20000273', face:'20000277', cloth:'20000272', quality: '紫' },
                    甜梦派对:         { hair:'20000339', face:'20000340', cloth:'20000341', quality: '紫' },
                    春日心情:         { hair:'20000212', face:'无', cloth:'20000202', quality: '蓝' },
                    薯牌甜心:         { hair:'20000231', face:'无', cloth:'20000230', quality: '蓝' },
                    宁静青空:         { hair:'20000214', face:'无', cloth:'20000206', quality: '蓝' },
                    纯黑咖啡:         { hair:'20000215', face:'无', cloth:'20000207', quality: '蓝' },
                },
                ling: {               // 零
                    默认:            { hair:'20000013', face:'20000014', cloth:'20000015', quality: '白' },
                    搬开山:          { hair:'20000405', face:'20000406', cloth:'20000407', quality: '紫' },
                    赤炼将军:         { hair:'20000237', face:'20000238', cloth:'20000239', quality: '紫' },
                    青云逸歌:         { hair:'20000265', face:'20000266', cloth:'20000267', quality: '紫' },
                    卡皮巴拉:         { hair:'20000213', face:'无', cloth:'20000203', quality: '蓝' },
                    荒野落日:         { hair:'20000216', face:'无', cloth:'20000208', quality: '蓝' },
                    罗宾汉:           { hair:'20000217', face:'无', cloth:'20000209', quality: '白' },
                },
                anian: {              // 阿念
                    默认:            { hair:'20000502', face:'20000503', cloth:'20000504', quality: '白' },
                    灵昭鹿鸣:         { hair:'20000241', face:'20000242', cloth:'20000240', quality: '紫' },
                    王子与骑士:       { hair:'20000263', face:'20000264', cloth:'20000262', quality: '紫' },
                    迷途僵宝:         { hair:'20000321', face:'20000322', cloth:'20000320', quality: '紫' },
                    丹砂:             { hair:'无', face:'无', cloth:'20000235', quality: '白' },
                    铅灰:             { hair:'无', face:'无', cloth:'20000236', quality: '白' },
                },
                xiaoyao: {            // 逍遥
                    默认:            { hair:'20000601', face:'20000602', cloth:'20000603', quality: '白' },
                    莲华渡:          { hair:'20000333', face:'20000334', cloth:'20000332', quality: '金' },
                    泽引山海:         { hair:'20000248', face:'20000249', cloth:'20000247', quality: '紫' },
                    绣春逍影:         { hair:'20006003', face:'20006004', cloth:'20006002', quality: '紫' },
                    碧落:             { hair:'无', face:'无', cloth:'20000246', quality: '白' },
                    紫气:             { hair:'无', face:'无', cloth:'20000253', quality: '白' },
                },
                weiweian: {           // 微微安
                    默认:            { hair:'20000701', face:'20000702', cloth:'20000703', quality: '白' },
                    仙锋小姐:        { hair:'20000402', face:'20000403', cloth:'20000404', quality: '紫' },
                    黑月挽歌:         { hair:'20000256', face:'20000257', cloth:'20000255', quality: '紫' },
                    圣光之逾:         { hair:'20000275', face:'20000276', cloth:'20000274', quality: '金' },
                    白光莹:          { hair:'20000288', face:'20000289', cloth:'20000290', quality: '紫' },
                    铃兰:            { hair:'无', face:'无', cloth:'20000254', quality: '白' },
                },
                wulinger: {           // 巫灵儿
                    默认:            { hair:'20000801', face:'20000802', cloth:'20000803', quality: '白' },
                    素影瑶光:         { hair:'20000268', face:'20000269', cloth:'20000270', quality: '紫' },
                    镜生遗梦红:       { hair:'20000294', face:'20000295', cloth:'20000296', quality: '红' },
                    镜生遗梦白:       { hair:'20000297', face:'20000298', cloth:'20000299', quality: '红' },
                    镜花辞:           { hair:'20000314', face:'20000315', cloth:'20000316', quality: '紫' },
                    相思引:           { hair:'无', face:'无', cloth:'20000261', quality: '白' },
                },
                lili: {               // 莉莉
                    默认:            { hair:'20000901', face:'20000902', cloth:'20000903', quality: '白' },
                    情公主:           { hair:'20000281', face:'20000282', cloth:'20000283', quality: '紫' },
                    捉妖小师妹:       { hair:'20000324', face:'20000327', cloth:'20000323', quality: '紫' },
                    莓果陷阱:         { hair:'20006008', face:'20006009', cloth:'20006007', quality: '紫' },
                    樱桃果酱:         { hair:'无', face:'无', cloth:'20000271', quality: '白' },
                },
                ailun: {              // 艾伦
                    默认:            { hair:'20001001', face:'20001002', cloth:'20001003', quality: '白' },
                    水王子:          { hair:'20000291', face:'20000292', cloth:'20000293', quality: '紫' },
                    绒绒派对:        { hair:'20000342', face:'20000343', cloth:'20000344', quality: '紫' },
                    夜绯:            { hair:'无', face:'无', cloth:'20000284', quality: '白' },

                },
                aidewa: {             // 爱德华
                    默认:            { hair:'20001101', face:'20001102', cloth:'20001103', quality: '白' },
                    祖母绿:          { hair:'无', face:'无', cloth:'20000335', quality: '白' },
                },
                lan: {             // 兰
                    默认:            { hair:'20001201', face:'20001202', cloth:'20001203', quality: '白' },
                    千夜星谕:        { hair:'20000408', face:'20000409', cloth:'20000410', quality: '紫' },
                    靛月:            { hair:'无', face:'无', cloth:'20000338', quality: '白' },
                },

                yule: {               // 娱乐道具
                    荧光棒红色:      { hair:'100020', quality: '白' },
                    荧光棒桃心:      { hair:'100033', quality: '白' },
                }
            };

            // ========== 装扮排序和渲染工具函数 ==========
            function getDressQualityColor(quality) {
                return dressQualityConfig[quality]?.color || dressQualityConfig['白'].color;
            }

            function getDressQualityPriority(quality) {
                return dressQualityConfig[quality]?.priority || -1;
            }

            function sortDressList(dressList) {
                // 分离原皮和其他装扮
                const originalDress = dressList.filter(item => item.name === '默认');
                const otherDresses = dressList.filter(item => item.name !== '默认');
                
                // 按品质优先级排序（红 > 金 > 紫 > 蓝 > 白）
                otherDresses.sort((a, b) => {
                    return getDressQualityPriority(b.quality) - getDressQualityPriority(a.quality);
                });
                
                // 合并原皮和排序后的装扮
                return [...originalDress, ...otherDresses];
            };
            
            const danData = [
                    { name: '丹炉', code: '100034', inCode: '25054'},
                    { name: '还魂丹', code: '100035', inCode: '25055'},
                    { name: '回气丹', code: '100036', inCode: '25056'},
                    { name: '明目丹', code: '100037', inCode: '25057'},
                    { name: '金刚丹', code: '100038', inCode: '25058'},
                    { name: '回气还魂丹', code: '100039', inCode: '25059'},
                    { name: '回气明目丹', code: '100040', inCode: '25060'},
                    { name: '金刚明目丹', code: '100041', inCode: '25061'},
                    { name: '金刚还魂丹', code: '100042', inCode: '25062'},
                    { name: '明目还魂丹', code: '100043' , inCode: '25063'},
                    { name: '金刚回气丹', code: '100044', inCode: '25064'},
                    { name: '邪祟不侵', code: '100045', inCode: '25065'},
                ];

                const propData = [
                    { name: '简易手电筒', code: '100001', inCode: '25001'},
                    { name: '荧光棒红色', code: '100020', inCode: '25038'},
                    { name: '荧光棒桃心', code: '100033', inCode: '25052'},
                ];
            
            // 游戏装扮功能
            document.querySelector('.dress-character-list').addEventListener('click', e => {
                const item = e.target.closest('.menu-item[data-character]');
                if (!item || !item.dataset.character) return;

                currentCharacter = item.dataset.character;
                const dressInfo = dressData[currentCharacter] || {};
                
                // 转换为可排序的装扮列表
                const dressList = Object.keys(dressInfo).map(name => {
                    return {
                        name: name,
                        quality: dressInfo[name].quality || '白'
                    };
                });
                
                // 按品质排序
                const sortedDressList = sortDressList(dressList);

                const detailTitle = document.getElementById('dressDetailTitle');
                detailTitle.textContent = item.textContent.trim();

                const modeSelect = document.getElementById('dressDetailModeSelect');
                modeSelect.innerHTML = sortedDressList.map(item => {
                    const color = getDressQualityColor(item.quality);
                    return `<option style="color: ${color};">${item.name}</option>`;
                }).join('');
                modeSelect.selectedIndex = 0;

                showSidebarContent('dressDetailMenu');
                loadDressDetail();
            });

            function loadDressDetail() {
                const mode = document.getElementById('dressDetailModeSelect').value;
                const cfg = dressData[currentCharacter] && dressData[currentCharacter][mode]; 
                if (!cfg) return;
                const normalOutput = document.getElementById('normalCharacterOutput');
                const propOutput = document.getElementById('propCharacterOutput');
                const hairInput = document.getElementById('dressDetailHair');
                const faceInput = document.getElementById('dressDetailFace');
                const clothInput = document.getElementById('dressDetailCloth');
                const propInput = document.getElementById('dressDetailProp');

                if (currentCharacter === 'yule') {
                    normalOutput.style.display = 'none';
                    propOutput.style.display = 'block';
                    
                    if (cfg) {
                        propInput.value = cfg.hair;
                    }
                } else {
                    normalOutput.style.display = 'block';
                    propOutput.style.display = 'none';
                    
                    if (cfg) {
                        hairInput.value = cfg.hair;
                        faceInput.value = cfg.face;
                        clothInput.value = cfg.cloth;
                    }
                }
            }

            document.getElementById('dressDetailModeSelect').addEventListener('change', loadDressDetail);

            document.getElementById('dressDetailOutputArea').addEventListener('click', e => {
                if (!e.target.classList.contains('dress-copy')) return;

                const inputId = e.target.dataset.target;
                const val = document.getElementById(inputId).value;
                const button = e.target;

                
                if (val === '无') {
                    showButtonToast(button, '此装扮无代码', '#ff4d4d', '#fff');
                    return;
                }

                const ta = document.createElement('textarea');
                ta.value = val;
                document.body.appendChild(ta);
                ta.select();
                document.execCommand('copy');
                document.body.removeChild(ta);

                showButtonToast(button, '已复制', '#000', '#fff');
            });

            function showButtonToast(button, message, bgColor, textColor) {
                const toast = document.createElement('div');
                toast.textContent = message;
                Object.assign(toast.style, {
                    position: 'absolute',
                    background: bgColor,
                    color: textColor,
                    padding: '4px 8px',
                    borderRadius: '3px',
                    fontSize: '12px',
                    zIndex: 2000,
                    whiteSpace: 'nowrap',
                    bottom: '100%',
                    left: '50%',
                    transform: 'translateX(-50%)',
                    marginBottom: '5px',
                    animation: 'fadeInOut 1.5s ease-in-out'
                });

                button.style.position = 'relative';
                button.appendChild(toast);

                setTimeout(() => {
                    if (button.contains(toast)) {
                        button.removeChild(toast);
                    }
                }, 1500);
            }

            if (!document.querySelector('style[data-toast-animation]')) {
                const style = document.createElement('style');
                style.setAttribute('data-toast-animation', 'true');
                style.textContent = `
                    @keyframes fadeInOut {
                        0% { opacity: 0; transform: translateX(-50%) translateY(10px); }
                        20% { opacity: 1; transform: translateX(-50%) translateY(0); }
                        80% { opacity: 1; transform: translateX(-50%) translateY(0); }
                        100% { opacity: 0; transform: translateX(-50%) translateY(-10px); }
                    }
                `;
                document.head.appendChild(style);
            }

            // 丹药和娱乐道具功能
            function initDanAndPropLists() {
                const danList = document.getElementById('danList');
                if (danList) {
                    renderDanList('out');
                    
                    const danMenu = document.getElementById('danMenu');
                    danMenu.addEventListener('click', function(e) {
                        if (e.target.classList.contains('mode-switch-btn')) {
                            danMenu.querySelectorAll('.mode-switch-btn').forEach(btn => {
                                btn.classList.remove('active');
                            });
                            e.target.classList.add('active');
                            renderDanList(e.target.dataset.mode);
                        }
                    });

                    danList.addEventListener('click', function(e) {
                        if (!e.target.classList.contains('dress-copy')) return;
                        
                        const code = e.target.getAttribute('data-code');
                        const button = e.target;
                        
                        const ta = document.createElement('textarea');
                        ta.value = code;
                        document.body.appendChild(ta);
                        ta.select();
                        document.execCommand('copy');
                        document.body.removeChild(ta);
                        
                        showButtonToast(button, '已复制', '#000', '#fff');
                    });
                }

                const propList = document.getElementById('propList');
                if (propList) {
                    renderPropList('out');
                    
                    const propMenu = document.getElementById('propMenu');
                    propMenu.addEventListener('click', function(e) {
                        if (e.target.classList.contains('mode-switch-btn')) {
                            propMenu.querySelectorAll('.mode-switch-btn').forEach(btn => {
                                btn.classList.remove('active');
                            });
                            e.target.classList.add('active');
                            renderPropList(e.target.dataset.mode);
                        }
                    });

                    propList.addEventListener('click', function(e) {
                        if (!e.target.classList.contains('dress-copy')) return;
                        
                        const code = e.target.getAttribute('data-code');
                        const button = e.target;
                        
                        const ta = document.createElement('textarea');
                        ta.value = code;
                        document.body.appendChild(ta);
                        ta.select();
                        document.execCommand('copy');
                        document.body.removeChild(ta);
                        
                        showButtonToast(button, '已复制', '#000', '#fff');
                    });
                }
            }

            function renderDanList(mode) {
                const danList = document.getElementById('danList');
                if (!danList) return;
                
                danList.innerHTML = '';
                danData.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'dress-line';
                    
                    const code = mode === 'in' ? (item.inCode || item.code) : item.code;
                    
                    div.innerHTML = `
                        <span style="flex: 1; color: #e0e0e0;">${item.name}</span>
                        <span style="color: #2effa4; margin: 0 10px;">${code}</span>
                        <button class="dress-copy" data-code="${code}">复制</button>
                    `;
                    danList.appendChild(div);
                });
            }

            function renderPropList(mode) {
                const propList = document.getElementById('propList');
                if (!propList) return;
                
                propList.innerHTML = '';
                propData.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'dress-line';
                    
                    const code = mode === 'in' ? (item.inCode || item.code) : item.code;
                    
                    div.innerHTML = `
                        <span style="flex: 1; color: #e0e0e0;">${item.name}</span>
                        <span style="color: #2effa4; margin: 0 10px;">${code}</span>
                        <button class="dress-copy" data-code="${code}">复制</button>
                    `;
                    propList.appendChild(div);
                });
            }
            
            // ========== 事件监听器绑定 ==========
            generateBtn.addEventListener('click', function() {
                shouldShowGenerateNotification = true;
                generateGradientCode();
            });
            
            copyBtn.addEventListener('click', copyCode);
            favoriteBtn.addEventListener('click', favoriteCurrent);
            randomBtn.addEventListener('click', randomColors);
            fontSizeInput.addEventListener('input', updateAllPreviews);
            textInput.addEventListener('input', function() {
                resetFavoriteButton();
                updateRealTimePreview();
                updateCodeStatus();
            });
            
            boldCheckbox.addEventListener('change', function() {
                updateAllPreviews();
                updateCodeStatus();
            });
            
            italicCheckbox.addEventListener('change', function() {
                updateAllPreviews();
                updateCodeStatus();
            });
            
            underlineCheckbox.addEventListener('change', function() {
                updateAllPreviews();
                updateCodeStatus();
            });
            
            menuBtn.addEventListener('click', toggleSidebar);
            overlay.addEventListener('click', closeSidebar);
            shareBtn.addEventListener('click', shareTool);
            moreColorsBtn.addEventListener('click', toggleMoreColorsPanel);
            
            moreColorsPanelBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const mode = this.dataset.mode;
                    switchMode(mode);
                });
            });
            
            document.addEventListener('click', function(e) {
                if (!moreColorsBtn.contains(e.target) && !moreColorsPanel.contains(e.target)) {
                    closeMoreColorsPanel();
                }
            });
            
            menuItems.forEach(item => {
                item.addEventListener('click', function() {
                    const target = this.getAttribute('data-target');
                    showSidebarContent(target);
                });
            });
            
            backBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const target = this.getAttribute('data-target');
                    showSidebarContent(target);
                });
            });
            
            clearHistoryBtn.addEventListener('click', clearHistory);
            clearFavoritesBtn.addEventListener('click', clearFavorites);
            importBtn.addEventListener('click', importCode);
            
            codeOutput.addEventListener('dblclick', function() {
                selectAllText(this);
            });

            const toggleBtn = document.getElementById('toggleCodeBtn');
            const codeBlock = document.getElementById('codeOutput');

            toggleBtn.addEventListener('click', () => {
               const isHidden = codeBlock.classList.toggle('hidden');
                toggleBtn.textContent = isHidden ? '▼' : '▲';
            });
            
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'childList' || mutation.type === 'characterData') {
                        updateCodeCharCount();
                        updateCodeStatus();
                    }
                });
            });
            
            observer.observe(codeOutput, {
                childList: true,
                characterData: true,
                subtree: true
            });

            // ========== 初始化函数调用 ==========
            bindColorInputEvents(); 
            updateColorPreview();
            generateGradientCode();
            updateRealTimePreview();
            updateCodeStatus();
            initExamples();
            renderHistory();
            renderFavorites();
            initDanAndPropLists();
            initCustomMode();
            showSidebarContent('mainMenu');
            
            // ========== 悬浮球系统 ==========
            (function createFloatingBallSystem() {
                // 创建主悬浮球元素
                const mainBall = document.createElement('div');
                mainBall.className = 'floating-ball-main';
                mainBall.innerHTML = '双击';
                document.body.appendChild(mainBall);
                
                // 创建两个小悬浮球
                const miniBall1 = document.createElement('div');
                miniBall1.className = 'floating-ball-mini';
                miniBall1.innerHTML = '复制<br>代码';
                miniBall1.title = '当前页面代码生成与复制';
                document.body.appendChild(miniBall1);
                
                const miniBall2 = document.createElement('div');
                miniBall2.className = 'floating-ball-mini';
                miniBall2.innerHTML = '启动<br>小窗';
                miniBall2.title = '启动预览悬浮小窗';
                document.body.appendChild(miniBall2);
                
                // 状态变量
                let isDragging = false;
                let startX, startY;
                let posX, posY;
                let lastClickTime = 0;
                const DOUBLE_CLICK_THRESHOLD = 300;
                let miniBallsVisible = false;
                let isClickOnMainBall = false;
                let expandDirection = 'down';
                
                // 默认位置：左下角（页面加载时总是使用此位置）
                posX = 20;
                posY = window.innerHeight - 80;
                
                // 确保位置在窗口范围内
                const maxX = window.innerWidth - 60;
                const maxY = window.innerHeight - 60;
                posX = Math.max(0, Math.min(posX, maxX));
                posY = Math.max(0, Math.min(posY, maxY));
                
                // 设置初始位置
                mainBall.style.left = `${posX}px`;
                mainBall.style.top = `${posY}px`;
                
                // 页面加载时清除任何保存的位置，确保总是从左下角开始
                localStorage.removeItem('floatingBallPos');
                
                // 初始化展开方向
                function initExpandDirection() {
                    const ballRect = mainBall.getBoundingClientRect();
                    const distanceToBottom = window.innerHeight - ballRect.bottom;
                    if (distanceToBottom < 150) {
                        expandDirection = 'up';
                    } else {
                        expandDirection = 'down';
                    }
                }
                
                // 页面加载完成后初始化展开方向
                window.addEventListener('load', initExpandDirection);
                
                // 更新小悬浮球位置的函数（支持向上/向下展开）
                function updateMiniBallsPosition() {
                    const ballRect = mainBall.getBoundingClientRect();
                    const ballCenterX = ballRect.left + ballRect.width / 2;
                    const ballCenterY = ballRect.top + ballRect.height / 2;
                    
                    const mainBallSize = ballRect.width;
                    const miniBallSize = miniBall1.offsetWidth || 45;
                    
                    const windowWidth = window.innerWidth;
                    let verticalSpacing, miniBallSpacing;
                    
                    if (windowWidth <= 480) {
                        verticalSpacing = 12;
                        miniBallSpacing = 8;
                    } else if (windowWidth <= 768) {
                        verticalSpacing = 14;
                        miniBallSpacing = 9;
                    } else {
                        verticalSpacing = 15;
                        miniBallSpacing = 10;
                    }
                    
                    // 检测展开方向：如果主球距离底部小于150px，则向上展开
                    const distanceToBottom = window.innerHeight - ballRect.bottom;
                    if (distanceToBottom < 150) {
                        expandDirection = 'up';
                    } else {
                        expandDirection = 'down';
                    }
                    
                    let x1, y1, x2, y2;
                    
                    if (expandDirection === 'up') {
                        // 向上展开
                        x1 = ballCenterX - miniBallSize / 2;
                        y1 = ballCenterY - mainBallSize / 2 - verticalSpacing - miniBallSize;
                        x2 = ballCenterX - miniBallSize / 2;
                        y2 = y1 - miniBallSize - miniBallSpacing;
                    } else {
                        // 向下展开
                        x1 = ballCenterX - miniBallSize / 2;
                        y1 = ballCenterY + mainBallSize / 2 + verticalSpacing;
                        x2 = ballCenterX - miniBallSize / 2;
                        y2 = y1 + miniBallSize + miniBallSpacing;
                    }
                    
                    miniBall1.style.left = `${x1}px`;
                    miniBall1.style.top = `${y1}px`;
                    miniBall2.style.left = `${x2}px`;
                    miniBall2.style.top = `${y2}px`;
                }
                
                // 显示小悬浮球的函数
                function showMiniBalls() {
                    if (miniBallsVisible) return;
                    
                    // 在显示前检测并设置展开方向
                    const ballRect = mainBall.getBoundingClientRect();
                    const distanceToBottom = window.innerHeight - ballRect.bottom;
                    const distanceToTop = ballRect.top;
                    
                    // 智能判断展开方向：优先向空间更大的一方展开
                    if (distanceToBottom < 150 && distanceToTop > distanceToBottom) {
                        expandDirection = 'up';
                    } else {
                        expandDirection = 'down';
                    }
                    
                    miniBallsVisible = true;
                    updateMiniBallsPosition();
                    miniBall1.classList.add('visible');
                    miniBall2.classList.add('visible');
                }
                
                // 隐藏小悬浮球的函数
                function hideMiniBalls() {
                    if (!miniBallsVisible) return;
                    miniBallsVisible = false;
                    miniBall1.classList.remove('visible');
                    miniBall2.classList.remove('visible');
                }
                
                // 窗口大小变化时调整位置
                const handleResize = () => {
                    const maxX = window.innerWidth - mainBall.offsetWidth;
                    const maxY = window.innerHeight - mainBall.offsetHeight;
                    posX = Math.min(posX, maxX);
                    posY = Math.min(posY, maxY);
                    mainBall.style.left = `${posX}px`;
                    mainBall.style.top = `${posY}px`;
                    if (miniBallsVisible) {
                        updateMiniBallsPosition();
                    }
                };
                
                window.addEventListener('resize', handleResize);
                
                // 鼠标按下事件
                mainBall.addEventListener('mousedown', (e) => {
                    isClickOnMainBall = true;
                    
                    const rect = mainBall.getBoundingClientRect();
                    startX = e.clientX - rect.left;
                    startY = e.clientY - rect.top;
                    isDragging = false;
                    mainBall.style.cursor = 'grabbing';
                    e.preventDefault();
                });
                
                // 触摸开始事件
                mainBall.addEventListener('touchstart', (e) => {
                    isClickOnMainBall = true;
                    
                    const touch = e.touches[0];
                    const rect = mainBall.getBoundingClientRect();
                    startX = touch.clientX - rect.left;
                    startY = touch.clientY - rect.top;
                    isDragging = false;
                    mainBall.style.cursor = 'grabbing';
                    e.preventDefault();
                });
                
                // 鼠标移动事件
                document.addEventListener('mousemove', (e) => {
                    if (mainBall.style.cursor !== 'grabbing') return;
                    
                    isDragging = true;
                    
                    // 拖动时自动收起小悬浮球
                    if (miniBallsVisible) {
                        hideMiniBalls();
                    }
                    
                    posX = e.clientX - startX;
                    posY = e.clientY - startY;
                    
                    const maxX = window.innerWidth - mainBall.offsetWidth;
                    const maxY = window.innerHeight - mainBall.offsetHeight;
                    posX = Math.max(0, Math.min(posX, maxX));
                    posY = Math.max(0, Math.min(posY, maxY));
                    
                    mainBall.style.left = `${posX}px`;
                    mainBall.style.top = `${posY}px`;
                    
                    if (miniBallsVisible) {
                        requestAnimationFrame(updateMiniBallsPosition);
                    }
                });
                
                // 触摸移动事件
                document.addEventListener('touchmove', (e) => {
                    if (mainBall.style.cursor !== 'grabbing') return;
                    
                    isDragging = true;
                    
                    // 拖动时自动收起小悬浮球
                    if (miniBallsVisible) {
                        hideMiniBalls();
                    }
                    
                    const touch = e.touches[0];
                    posX = touch.clientX - startX;
                    posY = touch.clientY - startY;
                    
                    const maxX = window.innerWidth - mainBall.offsetWidth;
                    const maxY = window.innerHeight - mainBall.offsetHeight;
                    posX = Math.max(0, Math.min(posX, maxX));
                    posY = Math.max(0, Math.min(posY, maxY));
                    
                    mainBall.style.left = `${posX}px`;
                    mainBall.style.top = `${posY}px`;
                    
                    if (miniBallsVisible) {
                        requestAnimationFrame(updateMiniBallsPosition);
                    }
                    e.preventDefault();
                });
                
                // 鼠标释放事件
                document.addEventListener('mouseup', () => {
                    if (mainBall.style.cursor !== 'grabbing') return;
                    
                    mainBall.style.cursor = 'grab';
                    
                    if (isClickOnMainBall) {
                        const currentTime = Date.now();
                        if (currentTime - lastClickTime < DOUBLE_CLICK_THRESHOLD) {
                            showMiniBalls();
                            lastClickTime = 0;
                        } else {
                            lastClickTime = currentTime;
                        }
                    }
                    isClickOnMainBall = false;
                });
                
                // 触摸结束事件
                document.addEventListener('touchend', () => {
                    if (mainBall.style.cursor !== 'grabbing') return;
                    
                    mainBall.style.cursor = 'grab';
                    
                    if (isClickOnMainBall) {
                        const currentTime = Date.now();
                        if (currentTime - lastClickTime < DOUBLE_CLICK_THRESHOLD) {
                            showMiniBalls();
                            lastClickTime = 0;
                        } else {
                            lastClickTime = currentTime;
                        }
                    }
                    isClickOnMainBall = false;
                });
                
                // 点击页面其他区域时隐藏小悬浮球
                document.addEventListener('click', function(e) {
                    if (miniBallsVisible && !mainBall.contains(e.target) && !miniBall1.contains(e.target) && !miniBall2.contains(e.target)) {
                        hideMiniBalls();
                    }
                });
                
                // 小悬浮球1的点击事件 - 生成和复制代码
                miniBall1.addEventListener('click', function() {
                    generateGradientCode();
                    copyCode();
                });
                
                // 小悬浮球2的点击事件 - 切换预览悬浮小窗
                miniBall2.addEventListener('click', function() {
                    toggleFloatingPreview();
                });
                
                // 切换预览悬浮小窗的函数
                function toggleFloatingPreview() {
                    if (typeof isFloatingVisible !== 'undefined' && typeof showFloatingPreview === 'function' && typeof hideFloatingPreview === 'function') {
                        if (isFloatingVisible) {
                            // 预览窗口已显示，关闭它
                            hideFloatingPreview();
                            miniBall2.classList.remove('active');
                        } else {
                            // 预览窗口未显示，显示它
                            // 重置预览窗口的关闭状态
                            floatingPreviewClosed = false;
                            try {
                                sessionStorage.removeItem('floatingPreviewClosed');
                            } catch (e) {
                                console.warn('无法清除sessionStorage:', e);
                            }
                            // 显示预览窗口
                            showFloatingPreview();
                            miniBall2.classList.add('active');
                        }
                    }
                }
                
                // 监听预览窗口的显示/隐藏状态，同步更新小悬浮球状态
                const observer = new MutationObserver(function(mutations) {
                    mutations.forEach(function(mutation) {
                        if (mutation.attributeName === 'class') {
                            if (floatingPreview.classList.contains('visible')) {
                                miniBall2.classList.add('active');
                            } else {
                                miniBall2.classList.remove('active');
                            }
                        }
                    });
                });
                
                if (floatingPreview) {
                    observer.observe(floatingPreview, { attributes: true, attributeFilter: ['class'] });
                }
            })();
            
            // ========== 邮箱复制功能 ==========
            const copyEmailBtn = document.getElementById('copyEmailBtn');
            if (copyEmailBtn) {
                copyEmailBtn.addEventListener('click', function() {
                    // 直接从页面获取邮箱地址文本
                    let email = '';
                    const announcementDiv = this.closest('div[style*="font-size: 14px"]');
                    if (announcementDiv) {
                        const emailSpan = announcementDiv.querySelector('span[style*="color: #2effa4;"]');
                        if (emailSpan) {
                            email = emailSpan.textContent.trim();
                        }
                    }
                    
                    // 如果无法从页面获取，使用硬编码作为备选
                    if (!email) {
                        email = 'mobinsll1024@gmail.com';
                    }
                    
                    // 首选使用现代Clipboard API
                    if (navigator.clipboard && window.isSecureContext) {
                        navigator.clipboard.writeText(email).then(() => {
                            showNotification('邮箱已复制到剪贴板！', 'success');
                        }).catch(err => {
                            console.error('Clipboard API error:', err);
                            fallbackCopyTextToClipboard(email);
                        });
                    } else {
                        // 兼容性回退方案
                        fallbackCopyTextToClipboard(email);
                    }
                });
            }
            
            // 兼容性回退函数
            function fallbackCopyTextToClipboard(text) {
                // 创建临时文本区域
                const textArea = document.createElement('textarea');
                textArea.value = text;
                
                // 确保文本区域不可见但可访问
                textArea.style.position = 'fixed';
                textArea.style.left = '-999999px';
                textArea.style.top = '-999999px';
                document.body.appendChild(textArea);
                
                // 选择并复制文本
                textArea.focus();
                textArea.select();
                
                try {
                    const successful = document.execCommand('copy');
                    if (successful) {
                        showNotification('邮箱已复制到剪贴板！', 'success');
                    } else {
                        showNotification('复制失败，请手动复制邮箱', 'error');
                    }
                } catch (err) {
                    console.error('Fallback copy error:', err);
                    showNotification('复制失败，请手动复制邮箱', 'error');
                }
                
                // 清理临时元素
                document.body.removeChild(textArea);
            }
            
            // ========== 首次访问提醒功能 ==========
            const BUG_FIXED_NOTIFICATION_KEY = 'bug_fixed_notification_shown';
            const showBugFixedNotification = localStorage.getItem(BUG_FIXED_NOTIFICATION_KEY) !== 'true';
            
            if (showBugFixedNotification) {
                // 延迟显示通知，确保页面完全加载
                setTimeout(() => {
                    showNotification('【字体大小无变化bug已修复】', 'success');
                    // 标记通知已显示
                    localStorage.setItem(BUG_FIXED_NOTIFICATION_KEY, 'true');
                }, 1000);
            }
        });
        
        // ========== 预览控制按钮功能 ==========
        document.addEventListener('DOMContentLoaded', function() {
            // 元素获取
            const leftAlignBtn = document.getElementById('leftAlignBtn');
            const centerAlignBtn = document.getElementById('centerAlignBtn');
            const backgroundStyleBtn = document.getElementById('backgroundStyleBtn');
            const backgroundStylePanel = document.getElementById('backgroundStylePanel');
            const backgroundStyleItems = document.querySelectorAll('.dropdown-item');
            const previewSection = document.getElementById('previewSection');
            const previewContent = document.querySelector('.preview-content');
            const previewOutput = document.getElementById('previewOutput');
            
            // 从localStorage读取并应用保存的配置
            try {
                const savedAlign = localStorage.getItem('previewAlign');
                const savedBackgroundStyle = localStorage.getItem('previewBackgroundStyle');
                
                // 应用保存的对齐方向
                if (savedAlign && previewContent && previewOutput) {
                    if (savedAlign === 'left') {
                        previewContent.style.justifyContent = 'flex-start';
                        previewOutput.style.textAlign = 'left';
                    } else if (savedAlign === 'center') {
                        previewContent.style.justifyContent = 'center';
                        previewOutput.style.textAlign = 'center';
                    }
                }
                
                // 应用保存的背景样式
                if (savedBackgroundStyle && previewSection) {
                    previewSection.className = 'preview-section';
                    if (savedBackgroundStyle !== 'default') {
                        previewSection.classList.add(savedBackgroundStyle);
                    }
                    
                    // 更新按钮文本
                    if (backgroundStyleBtn) {
                        const styleNames = {
                            'default': '默认背景',
                            'style1': '虚镜回廊',
                            'style2': '樱落金笺'
                        };
                        backgroundStyleBtn.textContent = styleNames[savedBackgroundStyle] + ' ▼';
                    }
                    
                    // 更新悬浮小窗背景
                    const floatingPreview = document.getElementById('floatingPreview');
                    if (floatingPreview) {
                        const backgroundStyles = {
                            'default': 'linear-gradient(to right, #3E4862, #3A4860)',
                            'style1': 'linear-gradient(to right, #30233F, #482766)',
                            'style2': 'linear-gradient(to right, #8C407A, #A64E8F)'
                        };
                        floatingPreview.style.background = backgroundStyles[savedBackgroundStyle];
                    }
                    
                    // 更新悬浮小窗标题栏背景
                    const floatingPreviewHeader = document.querySelector('.floating-preview-header');
                    if (floatingPreviewHeader) {
                        floatingPreviewHeader.className = 'floating-preview-header';
                        if (savedBackgroundStyle !== 'default') {
                            floatingPreviewHeader.classList.add(savedBackgroundStyle);
                        }
                    }
                }
            } catch (error) {
                console.error('读取localStorage配置失败:', error);
            }
            
            // 左对齐按钮
            if (leftAlignBtn) {
                leftAlignBtn.addEventListener('click', function() {
                    if (previewContent) {
                        previewContent.style.justifyContent = 'flex-start';
                        if (previewOutput) {
                            previewOutput.style.textAlign = 'left';
                        }
                    }
                    // 保存对齐方向到localStorage
                    try {
                        localStorage.setItem('previewAlign', 'left');
                    } catch (error) {
                        console.error('保存对齐方向失败:', error);
                    }
                });
            }
            
            // 居中对齐按钮
            if (centerAlignBtn) {
                centerAlignBtn.addEventListener('click', function() {
                    if (previewContent) {
                        previewContent.style.justifyContent = 'center';
                        if (previewOutput) {
                            previewOutput.style.textAlign = 'center';
                        }
                    }
                    // 保存对齐方向到localStorage
                    try {
                        localStorage.setItem('previewAlign', 'center');
                    } catch (error) {
                        console.error('保存对齐方向失败:', error);
                    }
                });
            }
            
            // 默认按钮下拉菜单
            if (backgroundStyleBtn) {
                backgroundStyleBtn.addEventListener('click', function() {
                    if (backgroundStylePanel) {
                        backgroundStylePanel.classList.toggle('show');
                    }
                });
            }
            
            // 背景样式切换
            backgroundStyleItems.forEach(function(item) {
                item.addEventListener('click', function() {
                    const style = this.getAttribute('data-style');
                    
                    // 移除所有样式类
                    if (previewSection) {
                        previewSection.className = 'preview-section';
                        
                        // 添加选中的样式类
                        if (style !== 'default') {
                            previewSection.classList.add(style);
                        }
                    }
                    
                    // 更新按钮文本
                    if (backgroundStyleBtn) {
                        backgroundStyleBtn.textContent = this.textContent + ' ▼';
                    }
                    
                    // 更新悬浮小窗背景
                    const floatingPreview = document.getElementById('floatingPreview');
                    if (floatingPreview) {
                        const backgroundStyles = {
                            'default': 'linear-gradient(to right, #3E4862, #3A4860)',
                            'style1': 'linear-gradient(to right, #30233F, #482766)',
                            'style2': 'linear-gradient(to right, #8C407A, #A64E8F)'
                        };
                        floatingPreview.style.background = backgroundStyles[style];
                    }
                    
                    // 更新悬浮小窗标题栏背景
                    const floatingPreviewHeader = document.querySelector('.floating-preview-header');
                    if (floatingPreviewHeader) {
                        floatingPreviewHeader.className = 'floating-preview-header';
                        if (style !== 'default') {
                            floatingPreviewHeader.classList.add(style);
                        }
                    }
                    
                    // 保存背景样式到localStorage
                    try {
                        localStorage.setItem('previewBackgroundStyle', style);
                    } catch (error) {
                        console.error('保存背景样式失败:', error);
                    }
                    
                    // 关闭下拉菜单
                    if (backgroundStylePanel) {
                        backgroundStylePanel.classList.remove('show');
                    }
                });
            });
            
            // 点击其他地方关闭下拉菜单
            document.addEventListener('click', function(event) {
                if (!backgroundStyleBtn || !backgroundStylePanel) return;
                
                if (!backgroundStyleBtn.contains(event.target) && !backgroundStylePanel.contains(event.target)) {
                    backgroundStylePanel.classList.remove('show');
                }
            });
        });
    </script>
    
    <style>
        /* 主悬浮球样式 */
    .floating-ball-main {
        position: fixed;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: linear-gradient(135deg, #3898ff, #2d87e6);
        color: white;
        font-size: 14px;
        font-weight: 500;
        line-height: 1.2;
        letter-spacing: 0.5px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: grab;
        user-select: none;
        z-index: 9999;
        box-shadow: 0 8px 24px rgba(56, 152, 255, 0.5), 0 2px 8px rgba(0, 0, 0, 0.15);
        transition: background 0.2s ease, box-shadow 0.2s ease, transform 0.1s ease;
        touch-action: manipulation;
        -webkit-user-drag: none;
        pointer-events: auto;
        text-align: center;
        padding: 0 4px;
    }
    
    .floating-ball-main:hover {
        background: linear-gradient(135deg, #4aa3ff, #3898ff);
        box-shadow: 0 10px 30px rgba(56, 152, 255, 0.6), 0 4px 12px rgba(0, 0, 0, 0.2);
        transform: scale(1.05);
    }
    
    .floating-ball-main:active {
        transform: scale(0.95);
        box-shadow: 0 6px 18px rgba(56, 152, 255, 0.4), 0 2px 6px rgba(0, 0, 0, 0.1);
    }
    
    /* 小悬浮球样式 */
    .floating-ball-mini {
        position: fixed;
        width: 38px;
        height: 38px;
        border-radius: 50%;
        background: linear-gradient(135deg, rgba(56, 152, 255, 0.95), rgba(45, 135, 230, 0.9));
        color: white;
        font-size: 9px;
        font-weight: 500;
        line-height: 1.15;
        letter-spacing: 0.2px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        user-select: none;
        z-index: 9997;
        box-shadow: 0 4px 12px rgba(56, 152, 255, 0.35), 0 2px 6px rgba(0, 0, 0, 0.1);
        opacity: 0;
        transform: scale(0.5);
        transition: opacity 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease, top 0.2s ease, left 0.2s ease;
        pointer-events: none;
        text-align: center;
        padding: 0 3px;
        word-break: break-all;
        word-wrap: break-word;
    }
    
    .floating-ball-mini.visible {
        opacity: 1;
        transform: scale(1);
        pointer-events: auto;
    }
    
    .floating-ball-mini:hover {
        background: linear-gradient(135deg, rgba(74, 163, 255, 1), rgba(56, 152, 255, 0.95));
        box-shadow: 0 6px 18px rgba(56, 152, 255, 0.5), 0 3px 9px rgba(0, 0, 0, 0.15);
        transform: scale(1.1) translateY(-2px);
    }
    
    .floating-ball-mini:active {
        transform: scale(0.95) translateY(0);
        box-shadow: 0 3px 9px rgba(56, 152, 255, 0.3), 0 1px 4px rgba(0, 0, 0, 0.08);
    }
    
    .floating-ball-mini.active {
        background: linear-gradient(135deg, #4caf50, #45a049);
        box-shadow: 0 4px 12px rgba(76, 175, 80, 0.5), 0 2px 6px rgba(0, 0, 0, 0.15);
    }
    
    .floating-ball-mini.active:hover {
        background: linear-gradient(135deg, #5cb860, #4caf50);
        box-shadow: 0 6px 18px rgba(76, 175, 80, 0.6), 0 3px 9px rgba(0, 0, 0, 0.2);
        transform: scale(1.1) translateY(-2px);
    }
    
    /* ========== 公告内容样式 ========== */
    .menu-announcement {
        margin: 20px 15px;
        padding: 15px;
        background-color: #f5f5f5;
        border-radius: 8px;
        border: 1px solid #ddd;
        font-size: 14px;
        line-height: 1.5;
        display: flex;
        flex-direction: column;
        gap: 10px;
    }
    
    .announcement-text {
        color: #333;
        word-wrap: break-word;
    }
    
    .menu-announcement .copy-btn {
        align-self: flex-start;
        padding: 5px 15px;
        background-color: #3898ff;
        color: white;
        border: none;
        border-radius: 4px;
        font-size: 12px;
        cursor: pointer;
        transition: background-color 0.2s ease;
    }
    
    .menu-announcement .copy-btn:hover {
        background-color: #2d87e6;
    }
    
    .menu-announcement .copy-btn:active {
        background-color: #1e6cd7;
    }
    
    /* 响应式设计 */
    @media (max-width: 768px) {
        .floating-ball-main {
            width: 55px;
            height: 55px;
            font-size: 13px;
            font-weight: 500;
            line-height: 1.2;
            letter-spacing: 0.4px;
            padding: 0 3px;
            box-shadow: 0 6px 18px rgba(56, 152, 255, 0.45), 0 2px 6px rgba(0, 0, 0, 0.12);
        }
        
        .floating-ball-main:hover {
            box-shadow: 0 8px 22px rgba(56, 152, 255, 0.55), 0 3px 9px rgba(0, 0, 0, 0.18);
        }
        
        .floating-ball-mini {
            width: 40px;
            height: 40px;
            font-size: 9px;
            font-weight: 500;
            line-height: 1.1;
            letter-spacing: 0.2px;
            padding: 0 2px;
            box-shadow: 0 3px 10px rgba(56, 152, 255, 0.3), 0 2px 5px rgba(0, 0, 0, 0.08);
        }
        
        .floating-ball-mini:hover {
            box-shadow: 0 5px 14px rgba(56, 152, 255, 0.45), 0 3px 7px rgba(0, 0, 0, 0.12);
        }
        
        /* 悬浮预览窗口 - 小屏幕 */
        .floating-preview {
            width: 250px;
            top: 10px;
            right: 10px;
        }
        
        .floating-preview-header {
            padding: 8px 12px;
        }
        
        .floating-preview-title {
            font-size: 12px;
        }
        
        .floating-preview-btn {
            width: 20px !important;
            height: 20px !important;
            min-height: 20px !important;
            font-size: 12px !important;
            line-height: 20px !important;
            text-align: center !important;
        }
        
        .floating-preview-content {
            padding: 10px;
            min-height: 50px;
        }
    }
    
    @media (max-width: 480px) {
        .floating-ball-main {
            width: 50px;
            height: 50px;
            font-size: 12px;
            font-weight: 500;
            line-height: 1.1;
            letter-spacing: 0.3px;
            padding: 0 2px;
            box-shadow: 0 5px 16px rgba(56, 152, 255, 0.4), 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .floating-ball-main:hover {
            box-shadow: 0 7px 20px rgba(56, 152, 255, 0.5), 0 3px 8px rgba(0, 0, 0, 0.15);
        }
        
        .floating-ball-mini {
            width: 35px;
            height: 35px;
            font-size: 8px;
            font-weight: 500;
            line-height: 1.1;
            letter-spacing: 0.2px;
            padding: 0 1px;
            box-shadow: 0 3px 8px rgba(56, 152, 255, 0.25), 0 2px 4px rgba(0, 0, 0, 0.08);
        }
        
        .floating-ball-mini:hover {
            box-shadow: 0 4px 12px rgba(56, 152, 255, 0.4), 0 2px 6px rgba(0, 0, 0, 0.12);
        }
        
        /* 悬浮预览窗口 - 超小屏幕 */
        .floating-preview {
            width: 200px;
            top: 5px;
            right: 5px;
        }
        
        .floating-preview-header {
            padding: 6px 10px;
        }
        
        .floating-preview-title {
            font-size: 11px;
        }
        
        .floating-preview-btn {
            width: 18px !important;
            height: 18px !important;
            min-height: 18px !important;
            font-size: 11px !important;
            line-height: 18px !important;
            text-align: center !important;
        }
        
        .floating-preview-content {
            padding: 8px;
            min-height: 40px;
        }
        
        .resize-handle {
            width: 15px;
            height: 15px;
        }
    }
    </style>
    

</body>
</html>